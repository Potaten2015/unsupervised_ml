(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{BjFu:function(e,t,s){"use strict";s.d(t,"b",(function(){return g})),s.d(t,"c",(function(){return T})),s.d(t,"a",(function(){return M}));var r=s("D57K"),i=s("nsO7"),n=s("Llzl"),o=s("yC9S"),a=s("Fvsw"),m=s("go4a"),l=s("pjml"),d=s("zdqs"),u=s("SoDU"),c=s("fYJU"),h=s("VdDF"),p=s("aHpC"),b=s("zGdY"),f=s("KiLF");const g="ultra.service.termMembership",T="termMembership";function M(e,t=new Date){let s=e.startDate,r=e.endDate;return b.CourseDuration.UseTerm===e.durationType&&e.term&&(s=e.term.startDate,r=e.term.endDate),h.a.isWithinDateRange(t,{start:s,end:r})}let w=class{constructor(e,t,s,r,i,n,a,m,l){this.$q=e,this.context=s,this.CourseModel=r,this.CourseMembershipModel=i,this.TermModel=n,this.UserModel=a,this.ExternalCourseModel=m,this.contextUser=l,o.b.OnRootScope(t,"courseUltraStatusChanged",(e,t,s)=>{this.updateCourseUltraStatus(t,s)})}clear(){this.termsAndMemberships=void 0,this.loadPromise=void 0}getTermsAndMemberships(){return this.loadPromise?this.loadPromise:this.reloadTermsAndMemberships()}filterMemberships(e,t,s){return e&&Array.isArray(e)?e.filter(e=>!e.course.isOrganization===t||!!e.course.isOrganization===s):[]}getCourseMembershipsFromArray(e){return this.filterMemberships(e,!0,!1)}getOrganizationMembershipsFromArray(e){return this.filterMemberships(e,!1,!0)}parseMembershipFromExternalCourse(e){const t=this.CourseMembershipModel.$new();return t.course=this.CourseModel.$new(),t.course.id=e.id,t.course.name=e.title,t.course.description=e.description,t.course.displayName=e.title,t.course.startDate=e.startDate,t.course.endDate=e.endDate,t.course.isAvailable=!0,t.course.durationType=b.CourseDuration.DateRange,t.userId=e.userId,t.isAvailable=!0,t.userHasHidden=e.isHidden,t.courseCardColorIndex=parseInt((e.id||"0").replace(/_1$/,"").replace(/[^\d]/g,""),10),t.course.ui={courseColorClass:m.a(t),isExternal:!0,description:e.description,externalUrl:e.url},t}parseExternalCourseFromMembership(e){const t=this.ExternalCourseModel.$new(e.course.id);return t.id=e.course.id,t.title=e.course.name,t.startDate=e.course.startDate,t.endDate=e.course.endDate,t.userId=e.userId,t.description=e.course.ui.description,t.url=e.course.ui.externalUrl,t.isHidden=e.userHasHidden,t}reloadTermsAndMemberships(){const e=this.$q.defer();this.loadPromise=e.promise,this.termsAndMemberships={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};const t=this.context.getServerTime();return this.$q.all([this.getInternalMembership(),this.getExternalCoursesMembership(),this.updateTermsAndMemberships()]).then(([s,r])=>{this.termsAndMemberships.membershipsByTermId=Object.create(null),this.termsAndMemberships.memberships.splice(0,this.termsAndMemberships.memberships.length),(s=s.filter((e,t,s)=>s.findIndex(t=>e.$pk===t.$pk)===t)).forEach(e=>{this.termsAndMemberships.memberships.push(e)}),r.forEach(e=>{this.termsAndMemberships.memberships.push(e)}),this.associateTermsWithCourses();const n=new u.a(this.TermModel,this.termsAndMemberships.terms);let o=new d.a(n).map(this.termsAndMemberships.memberships,t);(o=this.applyStudentAvailabilityRules(o)).forEach(e=>{const t=t=>{let s=this.termsAndMemberships.membershipsByTermId[t.id];s||(s=this.termsAndMemberships.membershipsByTermId[t.id]={memberships:[]}),s.memberships.push(e.membership)};t(e.term);const s=e.membership.course.term;!s||e.term!==n.currentTerm&&e.term!==n.upcomingTerm||t(s),this.buildTermRelationships(e)}),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach(e=>{const t=this.termsAndMemberships.membershipsByTermId[e];t.memberships=i.sortBy(t.memberships,e=>e.course.name)}),e.resolve(this.termsAndMemberships)}),this.loadPromise}getInternalMembership(){return this.contextUser.getMemberships().then(e=>(e.forEach(e=>{e.course&&(e.course.term&&(e.course.term.id=e.course.term.$pk),e.course.ui={courseColorClass:m.a(e)})}),this.getActiveMemberships(e)))}getActiveMemberships(e){return e.filter(e=>e.course&&e.isAvailable)}getExternalCoursesMembership(){return this.ExternalCourseModel.$search({limit:1e4}).$asPromise().then(e=>e.map(e=>this.parseMembershipFromExternalCourse(e)))}updateTermsAndMemberships(){return this.TermModel.$search().$asPromise().then(e=>{this.termsAndMemberships.terms=i.orderBy(e,["startDate","durationType"],["asc","desc"]);const t=u.a.decorateTerm(new this.TermModel,l.Gb.ConstantTermId.CurrentTerm.toString()),s=u.a.decorateTerm(new this.TermModel,l.Gb.ConstantTermId.UpcomingTerm.toString());this.termsAndMemberships.terms.push(t,s)})}associateTermsWithCourses(){this.termsAndMemberships.memberships.forEach(e=>{e.course.term&&(e.course.term=this.termsAndMemberships.terms.find(t=>t.id===e.course.term.id))})}buildTermRelationships(e){const t=this.termsAndMemberships.termsByTermId[e.term.id];if(e.membership.course.term){if(e.term.id!==e.membership.course.term.id){if(!t)return void(this.termsAndMemberships.termsByTermId[e.term.id]=[e.membership.course.term]);t.indexOf(e.membership.course.term)<0&&t.push(e.membership.course.term)}}else;this.termsAndMemberships.termsByTermId[e.term.id]=i.orderBy(t,["startDate","name"],["desc","asc"])}applyStudentAvailabilityRules(e){return e.filter(e=>(e.membership.isStudentOrGuestMembership()&&e.membership.course.isUndecided()&&(e.membership.course.isAvailable=!1),!0))}getCourseMembership(e){const t=this.findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==t)return this.termsAndMemberships.memberships[t]}findCourseMembership(e,t){return t.findIndex(t=>t.course.id===e)}updateCourseUltraStatus(e,t){let s=this.findCourseMembership(e,this.termsAndMemberships.memberships);-1!==s&&(this.termsAndMemberships.memberships[s].course.ultraStatus=t),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach(r=>{-1!==(s=this.findCourseMembership(e,this.termsAndMemberships.membershipsByTermId[r].memberships))&&(this.termsAndMemberships.membershipsByTermId[r].memberships[s].course.ultraStatus=t)})}filterAssociatedWithTermCourseMembershipsByTerm(e,t){return this.filterAssociatedWithTermCourseMemberships(e).filter(e=>e.course.term.id===t.id)}filterAssociatedWithTermCourseMemberships(e){return e.filter(e=>e.course.term&&!f.a.Continuous.isEqualTo(e.course.term.durationType))}filterAssortedDatesCourseMemberships(e){return e.filter(e=>null==e.course.term||e.course.term&&f.a.Continuous.isEqualTo(e.course.term.durationType))}};w=Object(r.__decorate)([Object(r.__param)(0,Object(p.b)("$q")),Object(r.__param)(1,Object(p.b)("$rootScope")),Object(r.__param)(2,Object(p.b)(a.b)),Object(r.__param)(3,Object(p.b)(l.m.serviceName)),Object(r.__param)(4,Object(p.b)(l.t.serviceName)),Object(r.__param)(5,Object(p.b)(l.Gb.serviceName)),Object(r.__param)(6,Object(p.b)(l.Jb.serviceName)),Object(r.__param)(7,Object(p.b)(l.z.serviceName)),Object(r.__param)(8,Object(p.b)(c.b))],w);class D extends w{}n.module(g,[a.a,l.N]).service(T,w)},SY8P:function(e,t,s){var r=s("Llzl");r.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window","$sce",function(e,t,s){var i=function(t){var s=null,r=[];this.remove=function(t){-1!==r.indexOf(t)&&(r.splice(r.indexOf(t),1),0===r.length&&(e.cancel(s),s=null))},this.add=function(i){-1===r.indexOf(i)&&r.push(i),s||(s=e((function(){var e=r.slice();s=null,r.length=0,e.forEach((function(e){e()}))}),t))}},n=new i(0),o=new i(75);return{restrict:"A",scope:{ngShow:"=",ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"=",ellipsisFallbackFontSize:"@"},compile:function(e,i,a){return function(e,i,a){function m(){var t=e.ngBind||e.ngBindHtml,n=!1;if(s.isEnabled()&&r.isObject(t)&&s.getTrustedHtml(t)&&(n=!0,t=s.getTrustedHtml(t)),t){var o=!e.ngBind&&!!e.ngBindHtml,m=0,d=void 0!==a.ellipsisSymbol?a.ellipsisSymbol:"&hellip;",u=void 0!==e.ellipsisSeparator?a.ellipsisSeparator:" ",c=void 0!==e.ellipsisSeparatorReg&&e.ellipsisSeparatorReg,h=void 0!==e.ellipsisAppend&&""!==e.ellipsisAppend?d+"<span class='angular-ellipsis-append'>"+e.ellipsisAppend+"</span>":d,p=c?t.match(c):t.split(u);if(a.isTruncated=!1,o?i.html(t):i.text(t),void 0!==a.ellipsisFallbackFontSize&&l(i)&&i.css("font-size",a.ellipsisFallbackFontSize),l(i,e.useParent)){var b=p.length,f=e.useParent?function(e){var t=0;return r.forEach(e.parent().children(),(function(s){s!=e[0]&&(t+=s.clientHeight)})),e.parent()[0].clientHeight-t}(i):i[0].clientHeight;for(o?i.html(t+h):i.text(t).html(i.html()+h),i.attr("data-overflowed","true");m<b;m++){var g=p.pop();if(0===p.length&&(p[0]=g.substring(0,Math.min(g.length,5))),o?i.html(p.join(u)+h):i.text(p.join(u)).html(i.html()+h),(e.useParent?i.parent()[0]:i[0]).scrollHeight<f||!1===l(i,e.useParent)){a.isTruncated=!0;break}}d!=h&&void 0!==e.ellipsisAppendClick&&""!==e.ellipsisAppendClick&&i.find("span.angular-ellipsis-append").bind("click",(function(t){e.$apply((function(){e.ellipsisAppendClick.call(e,{event:t})}))})),!n&&s.isEnabled()&&s.trustAsHtml(t)}else i.attr("data-overflowed","false")}}function l(e,t){return(e=t?e.parent():e)[0].scrollHeight>e[0].clientHeight}function d(){a.lastWindowResizeWidth==window.innerWidth&&a.lastWindowResizeHeight==window.innerHeight||m(),a.lastWindowResizeWidth=window.innerWidth,a.lastWindowResizeHeight=window.innerHeight}a.lastWindowResizeTime=0,a.lastWindowResizeWidth=0,a.lastWindowResizeHeight=0,a.lastWindowTimeoutEvent=null,a.isTruncated=!1,e.$watch("ngShow",(function(){n.add(m)})),e.$watch("ngBind",(function(){n.add(m)})),e.$watch("ngBindHtml",(function(){n.add(m)})),e.$watch("ellipsisAppend",(function(){m()})),e.$watch((function(){return 0!=i[0].offsetWidth&&0!=i[0].offsetHeight}),(function(){o.add(m)}));var u=e.$on("dibari:refresh-ellipsis",(function(){n.add(m)}));function c(){o.add(d)}var h=r.element(t);h.bind("resize",c),e.$on("$destroy",(function(){h.unbind("resize",c),n.remove(m),o.remove(d),u&&(u(),u=null)}))}}}}])},SoDU:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r=s("VdDF"),i=s("pjml");class n{constructor(e,t){this.TermModel=e,this.terms=t,this.currentTerm=this.getTerm(i.Gb.ConstantTermId.CurrentTerm.toString()),this.upcomingTerm=this.getTerm(i.Gb.ConstantTermId.UpcomingTerm.toString())}getTerm(e){return this.terms.filter(t=>t.id===e)[0]}static decorateTerm(e,t){return e.id=t,e.ui={type:t},e}createYearTerm(e){const t=e.getFullYear(),s="year-"+t;let r=this.getTerm(s);return r||((r=new this.TermModel).id=s,r.ui={type:"year",year:t},r.startDate=new Date(t,0),this.addTerm(r)),r}addTerm(e){if(e)for(let t=0;t<this.terms.length;t++)if(this.terms[t].startDate>=e.startDate||this.terms[t]===this.currentTerm)return void this.terms.splice(t,0,e)}filterTerm(e){return this.terms.filter(t=>!!i.Gb.TermDuration.DateRange.isEqualTo(t.durationType)&&r.a.isWithinDateRange(e,{start:t.startDate,end:t.endDate}))}}},lGua:function(e,t,s){var r=s("ziER"),i=s("5JeM"),n=new r({id:"icon-small-settings",use:"icon-small-settings-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-settings"><path d="M7.5977 1.5453c.1998-.2709.6048-.2709.8046 0l.9644 1.307a.5.5 0 00.5534.1798l1.5484-.4906c.3209-.1016.6485.1364.651.473l.0119 1.6242a.5001.5001 0 00.342.4707l1.5411.5133c.3193.1064.4445.4916.2486.7653l-.945 1.321a.5002.5002 0 000 .582l.945 1.321c.1959.2737.0707.6589-.2486.7653l-1.5411.5133a.5.5 0 00-.342.4706l-.0119 1.6243c-.0025.3366-.3301.5746-.651.473L9.92 12.9679a.5.5 0 00-.5533.1798l-.9644 1.307c-.1998.2709-.6048.2709-.8046 0l-.9644-1.307a.5.5 0 00-.5534-.1798l-1.5484.4906c-.3209.1016-.6485-.1364-.651-.473l-.012-1.6243a.4999.4999 0 00-.342-.4706l-1.541-.5133c-.3193-.1064-.4445-.4916-.2486-.7653l.945-1.321a.5.5 0 000-.582l-.945-1.321c-.1959-.2737-.0707-.6589.2486-.7653l1.541-.5133a.5.5 0 00.342-.4707l.012-1.6242c.0025-.3366.3301-.5746.651-.473l1.5484.4906a.5.5 0 00.5534-.1798l.9644-1.307z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M10 8c0 1.1046-.8954 2-2 2s-2-.8954-2-2 .8954-2 2-2 2 .8954 2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);e.exports=n},ptBS:function(e,t,s){var r=s("ziER"),i=s("5JeM"),n=new r({id:"icon-medium-messages",use:"icon-medium-messages-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-messages"><path d="M1 4v16h22V4H1z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M1 4l8.4419 7.6744L12 14l2.5581-2.3256L23 4M23 20c-3.3676-3.5207-5.5754-5.3288-8.4418-8.3256M1 20l8.4419-8.3256" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(n);e.exports=n},q1bP:function(e,t,s){s("Llzl");s("SY8P"),e.exports="dibari.angular-ellipsis"},vgq2:function(e,t,s){var r=s("ziER"),i=s("5JeM"),n=new r({id:"icon-medium-discussion",use:"icon-medium-discussion-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-discussion"><path d="M8 21.4025a10.4446 10.4446 0 01-1.75-.8072L1 22l1.4318-5.2034C1.5217 15.2417 1 13.4318 1 11.5 1 5.701 5.701 1 11.5 1c4.5718 0 8.4611 2.9218 9.9025 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M9 16c0 3.866 3.134 7 7 7 1.3878 0 2.6812-.3803 3.7692-1.0769L23 23l-1.0769-3.2308C22.6197 18.6812 23 17.3878 23 16c0-3.866-3.134-7-7-7s-7 3.134-7 7z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><circle cx="13" cy="16" r=".5" /><circle cx="16" cy="16" r=".5" /><circle cx="19" cy="16" r=".5" /></symbol>'});i.add(n);e.exports=n},zdqs:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var r=s("nsO7"),i=s("VdDF"),n=s("pjml"),o=s("zGdY");class a{constructor(e){this.termUtil=e,this.membershipTermMapper=new m(this.termUtil)}getMembershipMapper(){return this.membershipTermMapper}map(e,t){return e.map(e=>({membership:e,term:this.membershipTermMapper.adjustTerm(e,t)}))}}class m{constructor(e){this.termUtil=e}adjustTerm(e,t){const s=this.getCourseDateRange(e);return s.start>t?e.course.ui.term=this.termUtil.upcomingTerm:i.a.isWithinDateRange(t,s)?e.course.ui.term=this.termUtil.currentTerm:e.course.term?e.course.ui.term=e.course.term:e.course.ui.term=this.getTermMappingBasedOnCourseDates(e,s,t),e.course.ui.term}getCourseDateRange(e){let t,s;if(o.CourseDuration.DateRange===e.course.durationType)t=e.course.startDate,s=e.course.endDate;else if(o.CourseDuration.FixedNumDays===e.course.durationType)t=e.enrollmentDate,(s=new Date(e.enrollmentDate.getTime())).setDate(s.getDate()+e.course.numDaysOfUse);else if(o.CourseDuration.UseTerm===e.course.durationType){const r=e.course.term?this.termUtil.getTerm(e.course.term.id):null;r&&(n.Gb.TermDuration.DateRange.isEqualTo(r.durationType)?(t=r.startDate,s=r.endDate):n.Gb.TermDuration.FixedNumDays.isEqualTo(r.durationType)&&(t=e.enrollmentDate,(s=new Date(e.enrollmentDate.getTime())).setDate(s.getDate()+r.daysOfUse)))}return{end:s,start:t}}getTermMappingBasedOnCourseDates(e,t,s){let i=t.start||e.course.term&&e.course.term.startDate;if(!i){if(!(t.end&&s>t.end))return this.termUtil.currentTerm;i=t.end}const n=this.termUtil.filterTerm(i);if(0===n.length)return this.termUtil.createYearTerm(i);if(1===n.length)return n[0];if(n.length>1){const e=r.sortBy(n,["startDate","id"]);return e[e.length-1]}}}}}]);