(window.webpackJsonp=window.webpackJsonp||[]).push([[559,43],{"0/Nk":function(e,s){e.exports='<div class="group-student-self-enroll-directive" bb-load-bundle="components/directives/group/group-student-enrollment">\n  <div ng-if="$ctrl.content.assignedGroups.length > 0">\n    <span ng-if="!$ctrl.isOpenEnrollment()" class="ellipse title">\n      {{$ctrl.content.assignedGroups[0].groupTitle}}\n    </span>\n    <a ng-if="$ctrl.isSelfEnrollment && $ctrl.isOpenEnrollment()" class="self-enroll-link js-self-enroll-link"\n       href="javascript:void(0);" ng-click="$ctrl.openContentEnrollPanel()"\n       analytics-id="components.directives.group-student-enrollment.groupTitle.link">\n      {{$ctrl.content.assignedGroups[0].groupTitle}}\n    </a>\n  </div>\n  <span ng-if="!($ctrl.content.assignedGroups.length > 0) && !$ctrl.isSelfEnrollment" class="ellipse title" bb-translate\n        translate-values="{title: components.directives.group-student-enrollment.unknown}">\n    components.directives.group-student-enrollment.unknown\n  </span>\n  <div ng-if="!($ctrl.content.assignedGroups.length > 0) && $ctrl.isSelfEnrollment">\n    <div ng-if="$ctrl.isOpenEnrollment()">\n      <a href="javascript:void(0);" ng-click="$ctrl.openContentEnrollPanel()" class="self-enroll-link js-self-enroll-link"\n         bb-translate analytics-id="components.directives.group-student-enrollment.self-enroll-to-participate">components.directives.group-student-enrollment.self-enroll-to-participate</a>\n    </div>\n    <div ng-if="$ctrl.isBeforeEnrollment()" class="self-enroll-date" translate-values="{time: $ctrl.selfEnrollGroupInfo.relativeDate}"\n         bb-translate>components.directives.group-student-enrollment.enrollment-starts</div>\n    <div ng-if="$ctrl.isOpenEnrollmentWithEnding()" class="self-enroll-date"\n         ng-class="{\'is-important\': $ctrl.selfEnrollGroupInfo.isEnrollmentDateImportant}"\n         translate-values="{time: $ctrl.selfEnrollGroupInfo.relativeDate}"\n         bb-translate>components.directives.group-student-enrollment.enrollment-closes</div>\n    <div ng-if="$ctrl.isAfterEnrollment()" class="self-enroll-date"\n         bb-translate>components.directives.group-student-enrollment.enrollment-closed</div>\n  </div>\n</div>\n'},"2szi":function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-forward-arrow",use:"icon-medium-forward-arrow-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-forward-arrow"><path d="M13 1l10 11-10 11M23 12H1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},"2tKw":function(e,s){e.exports='<div class="rubric-list" bb-load-bundle="components/directives/rubric/rubric-list">\n  <div class="association-header" ng-if="::$ctrl.enableRubricAssociation">\n    <div class="header-title-container row">\n      <div class="header-title" bb-translate>\n        components.directives.rubric.list.heading\n      </div>\n      <span aria-hidden="true" ng-if="$ctrl.shouldShowNewBadge">\n        <bb-new-feature-badge custom-badge-class="js-rubric-list-new-badge"></bb-new-feature-badge>\n      </span>\n    </div>\n    <div class="header-first-description" bb-translate>\n      components.directives.rubric.list.firstParagraphDescription\n    </div>\n    <div class="header-second-description-holder" ng-if="$ctrl.showCompleteDescription">\n      <div class="header-second-description" bb-translate>\n        components.directives.rubric.list.secondParagraphDescription\n      </div>\n      <a bb-translate-attrs="{\'href\': \'components.directives.rubric.list.linkHref\'}"\n         target="_blank"\n         rel="help"\n         analytics-id="components.directives.rubric.list.learnMoreLink"\n         bb-translate>\n         components.directives.rubric.list.learnMoreLink\n      </a>\n    </div>\n    <div class="toggleDescription">\n      <button class="button--text"\n              type="button"\n              ng-if="!$ctrl.showCompleteDescription"\n              aria-labelledby="rubric-list-show-description"\n              ng-click="$ctrl.toggleDescription()"\n              analytics-id="components.directives.rubric.list.showDescription.button">\n        <span id="rubric-list-show-description" bb-translate>components.directives.rubric.list.showMore</span>\n      </button>\n      <button class="button--text"\n              type="button"\n              ng-if="$ctrl.showCompleteDescription"\n              aria-labelledby="rubric-list-hide-description"\n              ng-click="$ctrl.toggleDescription()"\n              analytics-id="components.directives.rubric.list.hideDescription.button">\n        <span id="rubric-list-hide-description" bb-translate>components.directives.rubric.list.showLess</span>\n      </button>\n    </div>\n  </div>\n  <div class="row collapse js-rubric-create-button-wrapper hide-for-small-only" ng-if="$ctrl.editable">\n    <div class="columns medium-12 large-12">\n      <button class="button button--dashed -full-width rubric-create-button"\n              aria-labelledby="rubric-create-rubric-button"\n              bb-peek-sref="rubric.mode({mode: \'create\'})"\n              type="button"\n              bb-translate\n              analytics-id="components.directives.rubric.list.create.button"\n              ng-class="::$ctrl.enableRubricAssociation ? \'rubric-create-button-association\' : \'rubric-create-button-gradebook\'">\n        <span id="rubric-create-rubric-button" bb-translate>components.directives.rubric.list.create</span>\n      </button>\n    </div>\n  </div>\n\n  <div class="rubric-create-disabled-message" ng-show="!$ctrl.rubrics.length" bb-translate>\n    components.directives.rubric.list.createDisabled\n  </div>\n\n  <div class="rubric-view-message" ng-if="!$ctrl.hasViewAccess" bb-translate>\n    components.directives.rubric.settings.unavailable.view\n  </div>\n\n  <div ng-show="$ctrl.rubrics.length > 0">\n    <div ng-if="::!$ctrl.enableRubricAssociation" class="rubric-list-heading row" bb-translate>\n      components.directives.rubric.list.heading\n    </div>\n\n    <div class="list-container">\n      \x3c!-- Rubric Association --\x3e\n      <div ng-if="::$ctrl.enableRubricAssociation" ng-repeat="rubric in $ctrl.rubrics"\n           class="row element-list-row js-rubric-id-{{rubric.id}} association-enabled">\n        <div class="rubric-list-association-item">\n          <div class="item-left-side">\n            <div ng-if="$ctrl._rubricService.isPointsOrPointsRangeRubric(rubric)">\n              <span class="item-rubric-title"\n                    id="name-rubric-{{::rubric.id}}"\n                    title="{{ rubric.title }}"\n                    aria-hidden="true">\n                {{ rubric.title }}\n              </span>\n              <span class="item-rubric-type"\n                    id="possible-points-{{::rubric.id}}"\n                    aria-hidden="true"\n                    translate-values="{ points: {{$ctrl.getPointsRubricMaxScore(rubric)}} }"\n                    bb-translate>\n                    components.directives.rubric.list.pointsType\n              </span>\n              <div class="item-rubric-checkbox">\n                <input type="checkbox"\n                       id="rubric-list-checkbox-{{::rubric.id}}"\n                       name="rubric-list-checkbox-{{::rubric.id}}"\n                       aria-labelledby="name-rubric-{{::rubric.id}}"\n                       aria-describedby="possible-points-{{::rubric.id}} use-rubric-{{::rubric.id}}"\n                       ng-change="$ctrl.pointsCheckboxTrigger(rubric.id, checked)"\n                       ng-model="checked"\n                       analytics-id="components.directives.rubric.list.input.checkbox"/>\n                <label class="inline-form-label"\n                       id="use-rubric-{{::rubric.id}}"\n                       aria-hidden="true"\n                       for="rubric-list-checkbox-{{::rubric.id}}">\n                  <bb-translate>components.directives.rubric.list.pointsCheckbox</bb-translate>\n                </label>\n              </div>\n            </div>\n            <div ng-if="$ctrl._rubricService.isPercentageOrPercentageRangeRubric(rubric)">\n              <span class="item-rubric-title" title="{{ rubric.title }}" aria-hidden="true">\n                {{ rubric.title }}\n              </span>\n              <span class="item-rubric-type"\n                    aria-hidden="true"\n                    bb-translate>\n                    components.directives.rubric.list.percentageType\n              </span>\n            </div>\n          </div>\n          <div class="item-right-side">\n            <button class="button rubric-item-view-button button--text"\n                    bb-peek-sref="rubric.mode({rubricId: rubric.id, mode: \'edit\'})"\n                    type="button"\n                    aria-labelledby="rubric-add-button-{{rubric.id}}"\n                    analytics-id="components.directives.rubric.list.useRubric.button">\n              <span bb-translate>global.view</span>\n              <span class="sr-only"\n                    id="rubric-add-button-{{rubric.id}}"\n                    bb-translate\n                    translate-values="{title: rubric.title}">\n                    components.directives.rubric.list.viewRubric\n              </span>\n            </button>\n            <button class="button rubric-item-add-button button--text"\n                    type="button"\n                    ng-click="$ctrl.associateRubric(rubric)"\n                    aria-labelledby="rubric-view-button-{{rubric.id}}"\n                    analytics-id="components.directives.rubric.list.viewRubric.button">\n              <span bb-translate>components.directives.rubric.list.add</span>\n              <span class="sr-only"\n                    id="rubric-view-button-{{rubric.id}}"\n                    bb-translate\n                    translate-values="{title: rubric.title}">\n                    components.directives.rubric.list.useRubric\n              </span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Gradebook Settings --\x3e\n      <div ng-if="::!$ctrl.enableRubricAssociation" ng-repeat="rubric in $ctrl.rubrics"\n           class="rubric-list-item row element-list-row js-rubric-id-{{rubric.id}}">\n\n        <button class="rubric-info-button button-anchor super-clear" bb-peek-sref="rubric.mode({rubricId: rubric.id, mode: \'edit\'})"\n                type="button" aria-labelledby="rubric-title-button-{{rubric.id}}" analytics-id="components.directives.rubric.list.viewRubric.button">\n          <div class="rubric-info">\n            <span class="rubric-icon" aria-hidden="true"\n                  bb-translate-attrs="{\'title\': \'components.directives.rubric.list.tooltip.edit\'}">\n              <bb-ui-icon-large-rubric color="primary"></bb-ui-icon-large-rubric>\n            </span>\n            <span class="rubric-title ellipsis" title="{{ rubric.title }}" aria-hidden="true">\n              {{ rubric.title }}\n            </span>\n            <span class="sr-only" id="rubric-title-button-{{rubric.id}}" bb-translate translate-values="{title: rubric.title}">components.directives.rubric.list.viewRubric</span>\n          </div>\n        </button>\n\n        <div bb-foundation-defer>\n          <bb-overflow-menu element-id="{{\'rubric-overflow-\' + rubric.id}}"\n                            menu-items="$ctrl.getOverflowMenuItems(rubric)"\n                            delete-options="$ctrl.getDeleteMenuOption(rubric)"\n                            ng-if="!$ctrl.course.isComplete()"\n                            analytics-id-tag-prefix="components.directives.rubric.list.overflowMenu">\n          </bb-overflow-menu>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},"5Tom":function(e,s,t){"use strict";var i=t("D57K"),n=t("nYZ0"),o=t("fYJU"),a=t("0JpG"),r=t("TnpK"),c=t("0/Nk"),l=t("OI4n"),d=t("yC9S"),u=t("aHpC");t.d(s,"b",(function(){return h})),t.d(s,"a",(function(){return p}));const h="ultra.directives.group.group-student-enrollment";let p=class{constructor(e,s,t,i,n){this.scope=e,this.contentService=s,this.currentUserService=t,this.localize=i,this.ultraState=n,this.isSelfEnrollment=!1}$onInit(){this.render()}async render(){if(this.content.selfEnrollmentGroups&&this.content.selfEnrollmentGroups.length>0){const{locale:e,babelfishFormatter:s}=this.localize.getReactBabelfishParams(this.scope),t=this.content.selfEnrollmentGroups.filter(e=>e.group).map(e=>e.group);this.selfEnrollGroupInfo=await l.getSelfEnrollmentGroupInfo(t,e,s),this.isSelfEnrollment=this.selfEnrollGroupInfo.isSelfEnrollment}else this.isSelfEnrollment=!1}async openContentEnrollPanel(){this.fromView?this.ultraState.current.name.endsWith("discussion.view.with-grading.peek.discussion-details")?(await this.ultraState.leavePeekState(),await this.ultraState.leavePeekState(),await this.ultraState.goPeekState("content-group-enroll",{courseId:this.content.courseId,contentId:this.content.id,fromView:this.fromView})):(await this.ultraState.leavePeekState(),await this.ultraState.goPeekState("content-group-enroll",{courseId:this.content.courseId,contentId:this.content.id,fromView:this.fromView})):await this.ultraState.goPeekState("content-group-enroll",{courseId:this.content.courseId,contentId:this.content.id})}isBeforeEnrollment(){return this.selfEnrollGroupInfo&&"Before"===this.selfEnrollGroupInfo.enrollmentDateState}isOpenEnrollment(){return this.selfEnrollGroupInfo&&"Open"===this.selfEnrollGroupInfo.enrollmentDateState}isOpenEnrollmentWithEnding(){return this.selfEnrollGroupInfo&&"Open"===this.selfEnrollGroupInfo.enrollmentDateState&&null!=this.selfEnrollGroupInfo.relativeDate}isAfterEnrollment(){return this.selfEnrollGroupInfo&&"After"===this.selfEnrollGroupInfo.enrollmentDateState}};p=Object(i.__decorate)([Object(d.a)({moduleName:h,componentName:"bbGroupStudentEnrollment",template:c,bindings:{content:"<",fromView:"@"},requireModules:[n.d,o.a,a.moduleName,r.b]}),Object(i.__param)(0,Object(u.b)("$scope")),Object(i.__param)(1,Object(u.b)(n.f)),Object(i.__param)(2,Object(u.b)(o.b)),Object(i.__param)(3,Object(u.b)(a.serviceName)),Object(i.__param)(4,Object(u.b)(r.d))],p)},"5Yfa":function(e,s,t){"use strict";t.d(s,"a",(function(){return i})),t.d(s,"b",(function(){return n})),t.d(s,"c",(function(){return o})),t.d(s,"d",(function(){return a}));const i="bb-goal-selection-changed",n="bb-goal-alignment-saved",o="bb-goal-alignment-legacy-picker-saved";function a(e){return i+":"+e.getContentIdForGoalAlignment()}},"70Xn":function(e,s){e.exports='<bb-modal class="notification automatic-zero-confirmation" \n          modal-translate-options="modalTranslateOptions"\n          modal-aria-type="alertdialog"\n          analytics-id-tag-prefix="components.directives.pastDueZero">\n  <div name="modal-contents">\n    \x3c!-- Instructions --\x3e\n    <p bb-translate>{{ modalTranslateOptions.instructions.key }}</p>\n  </div>\n  <button name="modal-footer-button-primary" \n          type="button" \n          class="button confirm-ok js-primary-button" \n          ng-click="okAction()" \n          analytics-id="course.grades.pastDue.confirmationNeeded.confirm"\n          bb-translate>\n          course.grades.pastDue.confirmationNeeded.confirm\n  </button>\n  <button name="modal-footer-button-secondary" \n          type="button" \n          class="button button--secondary confirm-cancel js-secondary-button" \n          ng-click="cancelAction()" \n          analytics-id="course.grades.pastDue.confirmationNeeded.cancel"\n          bb-translate>\n          course.grades.pastDue.confirmationNeeded.cancel\n  </button>\n</bb-modal>'},"8MQy":function(e,s,t){"use strict";(function(e){t.d(s,"b",(function(){return T})),t.d(s,"a",(function(){return O}));t("2szi"),t("r+pC");var i=t("nsO7"),n=t("nYZ0"),o=t("X455"),a=t("0JpG"),r=t("k9iv"),c=t("X/qj"),l=t("Cxi4"),d=t("9z7v"),u=t("XlSz"),h=t("pjml"),p=t("u4ux"),m=t("lEL+"),b=t("TnpK"),g=t("IjED"),v=t("g7Mf"),S=t("o5Lu"),f=t("lCpV"),C=t("OaUS"),w=t("SeO5"),D=t("4lp/"),y=t("ZzR9"),k=t("zGdY"),$=t("Y+9S"),P=t("nmzr");const T="ultra.course.engagement.view";class E{constructor(e,s,t,i,n,o,a,c,l,h,p,m,b,g,v,k,$,P,T,E){this.$location=e,this.$rootScope=s,this.$scope=t,this.$state=i,this.$q=n,this.$modal=o,this.$injector=a,this.bbLocalize=c,this.ContentService=l,this.contextCourseMembership=h,this.timeout=p,this.errorModalService=m,this.gradebookPermissionService=b,this.discussionPermission=g,this.ultraState=v,this.CourseModel=k,this.canCreateAllContent=$,this.hasEditAvailabilityPermission=P,this.slideoutPanel=T,this.discussionService=E,this.showDiscussion=!0,this.showParticipants=!1,this.isFromCourseOutline=!1,this.showSpinnerChild=!1,this.editTitle="",this.carousel=Object.create(null),this.carouselInitialSlide=0,this.carouselReady=!1,this.defaultView=f.a.Discussions,this.showGradeOverrideBar=!1,this.inViewContainerForSmallMedium=".engagement-view .in-view-container-for-small-medium",this.SCROLL_DELAY=50,this.openFeedback=e=>{e&&this.ultraState.leavePeekState();const s={isReadOnlyPanel:!0,columnId:this.discussionService.currentDiscussion.gradedColumn.id};this.ultraState.goPeekState("discussion-feedback",s),this.hideDetailsAndInformation=!0},this.$scope.engagementView=this,this.isFromCourseOutline=v.includes("**.course.outline.**"),this.previousState=this.$scope.previousState,this.hideDetailsAndInformation=this.slideoutPanel.isOpen(),this.ultraState.params.view?this.view=this.ultraState.params.view:(this.view=this.defaultView.toString(),this.ultraState.search("view",this.view)),this.isShowParticipants()&&!this.canViewGradesAndParticipation()&&this.errorModalService.openModal({template:r.b,errorHandler:()=>this.$rootScope.$broadcast(D.b)}),this.isNew="create"===this.ultraState.params.contentId,this.isNew?this.discussionService.createDiscussion().then(()=>{this.deregisterStateChange=this.$scope.$on("$stateChangeStart",()=>{this.$rootScope.$broadcast("deleteContent",this.discussionService.hardLinkContent),this.discussionService.softLinkContent&&this.$rootScope.$broadcast("deleteContent",this.discussionService.softLinkContent)})}):this.discussionService.course.contents.$new(this.discussionService.currentContentId).$fetch({expand:"alignedGoals"}).$suppressErrorDialog().$asPromise().catch(e=>{let s=null;if(404===e.$response.status)s={template:C,scope:this.$scope};else{if(403!==e.$response.status)return;s={template:w,scope:this.$scope}}this.$modal.open(s).result.finally(()=>{this.ultraState.go(this.$scope.previousState)})}).then(e=>this.discussionService.loadDiscussion(e)).then(()=>{this.discussionService.loadGroup(),this.editTitle=this.discussionService.hardLinkContent.title,this.notifyMobileApp()}),this.bindInViewContainerScrollForSmallMedium(),this.$scope.$on("bb-grade-input-save",()=>{this.discussionService.column&&this.discussionService.column.summary.$fetch({groupId:this.discussionService.groupId})}),this.$scope.$on(S.b,()=>{this.discussionService.column&&this.discussionService.column.summary.$fetch({groupId:this.discussionService.groupId})}),this.timeout(()=>{this.setupCarousel(this.carousel),this.slickGoToPanelContent(f.a.parse(this.view))},this.$scope),this.$scope.$on(y.a.$locationChangeSuccess,()=>{this.locationChanged()}),this.$scope.$on(d.b,()=>{this.ultraState.go(this.previousState)}),t.$on("bb-gradebook-item-show-spinner-child",(e,s)=>{this.showSpinnerChild=s}),this.$scope.$on("discussion-participant-click",(e,s)=>{this.selectedParticipant=s,this.formatParticipantUserName(s)}),this.$scope.$on("discussion-participant-click-to-view",(e,s)=>{this.selectedParticipant=s,this.formatParticipantUserName(s)}),this.$scope.$on("cancel-participant-to-view",()=>{this.cancelParticipantFilter(!0)}),this.$scope.$on("refresh-participants-count",()=>{E.course&&E.forumId&&this.discussionService.getParticipantCount()}),this.$scope.$on("$stateChangeStart",(e,s,t,i,n)=>{if("base.courses.peek.course.engagement.peek.discussion.view.with-grading"===i.name&&this.editTitle!==this.discussionService.hardLinkContent.title){if(this.isNew&&!this.editTitle.length)return;e.preventDefault(),this.saveContentTitle();const i=this.$scope.$on("ContentTitleUpdate",()=>{this.ultraState.go(s.name,t),i()})}}),this.$scope.$on("$stateChangeSuccess",(e,s,t,i)=>{if(this.slideoutPanel.setSlideoutPanelState(),this.slideoutPanel.isPanelClosing(i.name,s.name))this.hideDetailsAndInformation=!1;else{const e=(s?s.name:"")||"";(e.endsWith(".peek.rubric-view")||e.endsWith(".peek.rubric-evaluation"))&&(this.hideDetailsAndInformation=!0)}}),this.$scope.$on(u.d,(e,s)=>{this.showGradeOverrideBar=s}),this.isNew&&this.notifyMobileApp()}notifyMobileApp(){var e;if(Object($.isInMobileApp)()){const s=Object($.fetchState)(null===(e=this.ultraState.prev)||void 0===e?void 0:e.name),t={showParticipants:this.showParticipantsLink(),showSettings:this.isShowSettings(),showDetail:!this.canEditContent()&&this.isShowSettings()};let i;if(this.isNew){const e={type:$.MessageType.NewDiscussionCreationPanelOpened,status:$.MessageStatus.Success,permission:t,prevState:s};(i=Object($.registerMobileEventHandler)(e)).response.subscribe(e=>this.mobileEventHandlerSubscriber(e))}else{const e={type:$.MessageType.DiscussionOpened,status:$.MessageStatus.Success,contentId:this.discussionService.currentContentId,contentTitle:this.title,contentType:this.discussionService.isGradedDiscussion?$.MobileContentType.GradedDiscussion:$.MobileContentType.Discussion,discussionId:this.discussionService.currentDiscussion.id,discussionGroupId:this.discussionService.forumId,assignedGroupId:this.discussionService.isGroupDiscussion()?this.discussionService.groupId:void 0,permission:t,prevState:s};t.showDetail||t.showParticipants||t.showSettings?(i=Object($.registerMobileEventHandler)(e)).response.subscribe(e=>this.mobileEventHandlerSubscriber(e)):Object($.sendMessageToMobile)(e)}this.$scope.$on("$destroy",()=>{i&&Object($.clearMobileEventHandler)(i.correlationId)})}}mobileEventHandlerSubscriber(e){e.event===$.EventType.GotoParticipants?this.ultraState.goPeekState(P.EngagementRoutes.DISCUSSION_PARTICIPANTS):e.event===$.EventType.GotoSettings?this.ultraState.goPeekState(this.getSettingOrDetailPeekSref()):e.event===$.EventType.GotoDetail&&this.ultraState.goPeekState(P.EngagementRoutes.DISCUSSION_DETAILS)}showOverrideIndicator(){return this.showGradeOverrideBar}saveContent(){this.discussionService.saveContent()}isShowDiscussion(){return f.a.Discussions.isEqualTo(f.a.parse(this.view))}isShowParticipants(){return f.a.Participants.isEqualTo(f.a.parse(this.view))}canViewGradesAndParticipation(){return this.gradebookPermissionService.canView()&&this.gradebookPermissionService.canViewAttempts()}showParticipantsLink(){return!this.isShowParticipants()&&!this.discussionService.hasNoGroups()}clickParticipants(){this.showView(f.a.Participants)}clickDiscussion(){this.showView(f.a.Discussions),this.$scope.$broadcast("refresh-discussion-panel")}setupCarousel(e){e.init(),this.carouselReady=!0}showView(e){this.carouselReady||this.setupCarousel(this.carousel),this.ultraState.search("view",e.toString())}slickGoToPanelContent(e){if(this.carouselReady)switch(e){case f.a.Discussions:this.carousel.slick("slickGoTo",0);break;case f.a.Participants:this.carousel.slick("slickGoTo",1),this.discussionService.refreshParticipationGrade()}}locationChanged(){if(this.ultraState.includes("**.discussion.**")){if(this.$location.search().view?this.view===this.$location.search().view:this.defaultView.isEqualTo(this.view))return;this.view=this.$location.search().view||this.defaultView.toString(),this.slickGoToPanelContent(f.a.parse(this.view))}}changeGroup(e){this.discussionService.groupId!==e.groupId&&(this.discussionService.selectedGroup=e,this.discussionService.groupId=e.groupId,this.discussionService.getParticipantCount(),this.discussionService.column.summary.$fetch({groupId:this.discussionService.groupId}),this.$scope.$broadcast("group-change",this.discussionService.groupId))}get title(){return this.editTitle}set title(e){this.editTitle=e,this.discussionService.currentDiscussion.subject!==e&&(this.discussionService.currentDiscussion.subject=e)}saveContentTitle(){this.isNew?(this.deregisterStateChange(),this.isNew=!1,this.discussionService.persistNew().then(()=>{this.$scope.$apply(()=>{})})):(this.discussionService.hardLinkContent.title=this.editTitle,this.discussionService.saveContent().then(()=>{this.$scope.$broadcast("ContentTitleUpdate",this.discussionService.hardLinkContent.title),this.$rootScope.$broadcast("bb-update-CR-tooltip",this.discussionService.column,this.discussionService.hardLinkContent.title)}),h.v.MessageLifeCycleEnum.Deleted.isEqualTo(this.discussionService.currentDiscussion.lifecycle)||this.discussionService.currentDiscussion.$save(["subject","body"]))}canDeleteContent(){return this.discussionPermission.canDeleteDiscussion(this.discussionService.hardLinkContent,this.discussionService.softLinkContent)}canEditContent(){return this.isNew||(this.discussionService.softLinkContent&&this.discussionService.softLinkContent.permissions?this.discussionService.softLinkContent.canEdit():this.discussionService.hardLinkContent&&this.discussionService.hardLinkContent.canEdit())}canEditAvailability(){return this.isNew&&this.hasEditAvailabilityPermission||(this.discussionService.softLinkContent&&this.discussionService.softLinkContent.permissions?this.discussionService.softLinkContent.canEditAvailability():this.discussionService.hardLinkContent&&this.discussionService.hardLinkContent.canEditAvailability())}deleteDiscussion(){this.canDeleteContent()&&(this.discussionService.softLinkContent&&this.discussionService.softLinkContent.id&&this.ContentService.deleteContent(this.discussionService.softLinkContent),this.ContentService.deleteContent(this.discussionService.hardLinkContent),this.ultraState.go(this.previousState))}visibilityChange(){this.discussionService.hardLinkContent.getVisibilityAsStudent()===k.ContentVisibility.Restricted&&this.ultraState.goPeekState("discussion-settings",{focusEleId:"start-date"})}canSetDiscussion(){return this.canCreateAllContent&&!(this.discussionService.course&&this.discussionService.course.isComplete())}cancelParticipantFilter(e){this.selectedParticipantFormatedUserName=null,this.selectedParticipant=null,e||this.$scope.$broadcast("cancel-participant-filter")}formatParticipantUserName(e){this.bbLocalize.formatUsername(e.data,a.ILocaleUsernameFormat.Short,this.$scope,{noWrap:!0,noEscape:!0}).then(e=>{this.selectedParticipantFormatedUserName=e})}showSlider(){return this.discussionService.isGradedDiscussion&&this.canViewGradesAndParticipation()}localizeParticipationGradeTitle(){return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.engagement.discussionSlick.participationGrade"})}localizeDiscussionTitle(){return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.engagement.discussionSlick.discussion"})}getSettingOrDetailPeekSref(){return this.canSetDiscussion()?P.EngagementRoutes.DISCUSSION_SETTINGS:P.EngagementRoutes.DISCUSSION_DETAILS}getSettingsIcon(){return this.canSetDiscussion()?p.a.Gear.toString():p.a.Info.toString()}getSettingsLabel(){return this.canSetDiscussion()?"components.directives.header.settings":"components.directives.header.details"}isShowSettings(){return this.isShowDiscussion()&&(this.canSetDiscussion()||this.discussionService.isGradedDiscussion||this.hasGoals()||this.canEditAvailability())}hasGoals(){return this.discussionService.alignedGoalsCount>0}bindInViewContainerScrollForSmallMedium(){const s=this.$scope.$watch(()=>!!e(this.inViewContainerForSmallMedium).length,t=>{t&&(e(this.inViewContainerForSmallMedium).on("scroll",i.debounce(()=>{e(window).trigger("checkInView")},this.SCROLL_DELAY)),s())})}}E.$inject=["$location","$rootScope","$scope","$state","$q","$modal","$injector",a.serviceName,n.f,o.d,m.b,r.d,c.b,l.b,b.d,h.m.serviceName,"canCreateAllContent","hasEditAvailabilityPermission",g.b,v.c];class O extends E{}}).call(this,t("5iHu"))},"8sWK":function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-small-groups",use:"icon-small-groups-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-groups"><path d="M12 15s-1-2-4-2M4 15s1-2 4-2M8 13c1.6569 0 3-1.3431 3-3S9.6569 7 8 7s-3 1.3431-3 3 1.3431 3 3 3zM12 5c1.1046 0 2-.8954 2-2s-.8954-2-2-2-2 .8954-2 2 .8954 2 2 2zM1 7s1-2 3-2 3 2 3 2M9 7s1-2 3-2 3 2 3 2M4 5c1.1046 0 2-.8954 2-2s-.8954-2-2-2-2 .8954-2 2 .8954 2 2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},"9z7v":function(e,s,t){"use strict";t.d(s,"c",(function(){return x})),t.d(s,"b",(function(){return A})),t.d(s,"a",(function(){return G}));var i=t("D57K"),n=t("aHpC"),o=t("JfV0"),a=t("bd9L"),r=t("JDQK"),c=t("nYZ0"),l=t("Fvsw"),d=t("Cxi4"),u=t("jhBu"),h=t("Sa5G"),p=t("UD9g"),m=t("VdDF"),b=t("5Yfa"),g=t("oi1r"),v=t("o5Lu"),S=t("0JpG"),f=t("pjml"),C=t("wgY5"),w=t("e6jQ"),D=t("w/V/"),y=t("lEL+"),k=t("TnpK"),$=t("gkef"),P=t("g7Mf"),T=t("ZQFV"),E=t("MoIS"),O=t("lmMM"),I=t("zGdY"),M=t("Lgb/"),L=t("Vq5j");const x="ultra.course.engagement.discussion.settings",A="discussion_deleted";let R=class e{constructor(e,s,t,i,n,o,r,c,l,d,u,p,m,g,v,S,f,C){this.$ngRedux=e,this.$scope=s,this.$rootScope=t,this.bbLocalize=i,this.$modal=n,this.$q=o,this.GradeColumnModel=r,this.ultraState=c,this.context=l,this.ContentService=d,this.discussionPermission=u,this.entitlementService=p,this.GradeService=m,this.timeout=g,this.windowSize=v,this.goalAlignmentPeekStateService=S,this.schemaService=f,this.discussionService=C,this.pointsMaxLength=10,this.canCreateGroups=!1,this.canDeleteGroups=!1,this.canViewGroups=!1,this.canViewGroupsAsAdmin=!1,this.canCreateRubrics=!1,this.isMobile=!1,this.addDiscussionToOutline=!1,this.rubricUpdatedMaxPoints=!1,this.rubricMaxPoints=void 0,this.startDate=null,this.endDate=null,this.settingsSaved=!1,this.delayAutosave=!0,this.canEnableGrade=!1,this.canCreateAllContent=!1,this.isDiscussionGraded=!1,this.hasEditAvailabilityPermission=!1,this.hasEditDueDatePermission=!1,this.isGradeSchemaChanged=!1,this.isGradePointChanged=!1,this.hasComments=!0,this.hasGradingPermission=!1,this.goalAlignedContents=[],this.showGoalsSettings=!1,this.showRubricsSettings=!1,this.hasACLCriteria=()=>!!this.aclCriteria,this.getGroupDisabledReason=()=>{var e,s;if(null===(s=null===(e=this.discussionService)||void 0===e?void 0:e.hardLinkContent)||void 0===s?void 0:s.isGroupContent)return null;let t=null;return this.canCreateGroups?this.hasComments?t="course.engagement.discussionSettings.cannotMakeGroupDiscussion.forDiscussionWithComments":this.hasPostedGrades()?t="course.content.assessment.settings.cannotMakeGroupPosted.Discussion.name":this.hasACLCriteria()&&(t="course.engagement.discussionSettings.cannotMakeGroupDiscussion.forACLCriteria"):t="course.content.additionalToolsInsufficientPrivileges",t},this.subscribeToReduxChanges();const y=this.bbLocalize.getAppLocaleISO();this.getLocaleSettings({locale:y}),this.$scope.discussionSettings=this,this.$scope.isCourseClosed=this.discussionService.course.isClosed,this.canCreateGroups=this.entitlementService.isEntitled(h.o.CreateGroups),this.canDeleteGroups=this.entitlementService.isEntitled(h.o.DeleteGroups),this.canViewGroups=this.entitlementService.isEntitled(h.o.ViewGroups)||this.entitlementService.isEntitled(h.o.ViewGroupsAsAdmin),this.canViewGroupsAsAdmin=this.entitlementService.isEntitled(h.o.ViewGroupsAsAdmin),this.canCreateRubrics=this.entitlementService.isEntitled(h.k.CreateRubrics),this.isFromCalendar=this.ultraState.includes("**.calendar.**"),this.dueDateContainer=`${w.a()}-container-due-date-discussions`,this.isMobile=window.Modernizr.touch&&!this.windowSize.isLargeBreakpoint(),this.focusEleId=c.params.focusEleId,this.panelTitle=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.engagement.discussionSettings.title"}),this.discussionPermission.hasEditAvailabilityPermission(this.discussionService.course.id).then(e=>{this.hasEditAvailabilityPermission=e}),this.discussionPermission.hasEditDueDatePermission(this.discussionService.course.id).then(e=>{this.hasEditDueDatePermission=e}),this.discussionPermission.canCreateAllContent(this.discussionService.course.id).then(e=>{this.canCreateAllContent=e}),this.discussionService.loadDiscussion().then(()=>{this.initiallyLoadedHardContent=this.discussionService.hardLinkContent.$snapshot(),this.getAdaptiveReleaseCriteria(this.discussionService.hardLinkContent),this.isGradedDiscussionInitially=this.discussionService.currentDiscussion.allowGrading,this.isPostFirstInitially=this.discussionService.currentDiscussion.postFirst,this.originGradePossible=this.getOriginalGradePossible(),this.canEnableGrade=this.entitlementService.isEntitled("course.gradebook.MODIFY",this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.courseId||this.discussionService.course.id)&&this.discussionService.currentDiscussion.permissions.enableGradeOnThread,this.initiallyLoadedDiscussion=this.discussionService.currentDiscussion.$snapshot(),this.setCurrentSchema(),this.discussionPermission.hasGradingPermission(this.discussionService.course.id).then(e=>{this.hasGradingPermission=e,this.discussionService.currentDiscussion.gradedColumn&&(this.gradedColumnId=this.discussionService.currentDiscussion.gradedColumn.id,this.originDueDate=this.discussionService.currentDiscussion.gradedColumn.dueDate&&new Date(this.discussionService.currentDiscussion.gradedColumn.dueDate.getTime()),this.dueDatePickerValue=this.discussionService.currentDiscussion.gradedColumn.dueDate&&new Date(this.discussionService.currentDiscussion.gradedColumn.dueDate.getTime()),this.dueTimePickerValue=this.discussionService.currentDiscussion.gradedColumn.dueDate&&new Date(this.discussionService.currentDiscussion.gradedColumn.dueDate.getTime()),this.hasGradingPermission&&(this.GradeService.loadColumnGrades(this.discussionService.currentDiscussion.gradedColumn.id,this.discussionService.course).then(e=>{this.isDiscussionGraded=e.some(e=>e.isGraded())}),this.GradeService.loadRubricAssociation(this.discussionService.currentDiscussion.gradedColumn.id,this.discussionService.course).then(e=>{this.rubric=e})))}),this.addDiscussionToOutline=!!this.discussionService.softLinkContent,this.originAddToOutline=this.addDiscussionToOutline,this.lastAddToOutline=this.addDiscussionToOutline,this.loadCommentAndReplyCount().then(e=>{this.hasComments=!!e}),this.discussionService.refreshParticipationGrade()}),this.registerStateChangedHandler(),this.$scope.$watch("discussionSettings.gradeSchema",(e,s)=>{this.isGradeSchemaChanged=e&&s&&e.scaleType!==s.scaleType,this.isGradeSchemaChanged&&this.gradeSchemaChanged()}),this.$scope.$watch("discussionSettings.discussionService.currentDiscussion.gradedColumn.possible",e=>{e!==this.originGradePossible?this.isGradePointChanged=!0:this.isGradePointChanged=!1}),this.$scope.$watch(()=>this.dueDatePickerValue,e=>{e?this.dueTimePickerValue?(this.dueTimePickerValue.setFullYear(e.getFullYear()),this.dueTimePickerValue.setDate(1),this.dueTimePickerValue.setMonth(e.getMonth()),this.dueTimePickerValue.setDate(e.getDate())):this.dueTimePickerValue=new Date(e.getTime()):this.dueTimePickerValue=null}),this.$scope.$watch(()=>this.dueTimePickerValue,e=>{e&&(this.dueDatePickerValue||(this.dueDatePickerValue=new Date(e.getTime())))}),this.$scope.$on("open-rubric-list-panel",()=>{this.showRubrics()}),this.$scope.$on(D.a,(e,s,t)=>{var i,n,o;this.rubricUpdatedMaxPoints&&(this.rubricUpdatedMaxPoints=!1,Number.isFinite(null===(o=null===(n=null===(i=this.discussionService)||void 0===i?void 0:i.currentDiscussion)||void 0===n?void 0:n.gradedColumn)||void 0===o?void 0:o.possible)&&(this.discussionService.currentDiscussion.gradedColumn.possible=this.rubricMaxPoints),this.points=T.Utils.parseGradeValue(this.rubricMaxPoints))}),this.$scope.$on(D.b,(e,s,t)=>{this.rubric=t&&s?t:null}),this.onViewValueCleared=(e,s)=>{"participant-by-time"===e&&s&&(this.dueDatePickerValue=null)},this.$scope.$on("bb-autosave-browser-restore-data",(e,s)=>{var t;const i=s.baseForm;if(i){if(this.addDiscussionToOutline=i["is-add-discussion-to-outline"].$viewValue,null===(t=this.discussionService.currentDiscussion)||void 0===t?void 0:t.allowGrading){this.discussionService.currentDiscussion.allowGrading=i["is-graded-discussion"].$viewValue;const e=this.isDiscussionGraded;this.updateGradedDiscussionFlag(),this.isDiscussionGraded=e,this.dueDatePickerValue=i["participant-by-date"]&&i["participant-by-date"].$modelValue&&new Date(i["participant-by-date"].$modelValue),this.dueTimePickerValue=i["participant-by-time"]&&i["participant-by-time"].$modelValue&&new Date(i["participant-by-time"].$modelValue),this.gradeSchema=i["grade-schema"]&&i["grade-schema"].$viewValue,this.discussionService.currentDiscussion.gradedColumn.possible=i["point-possible"]&&i["point-possible"].$modelValue}this.$scope.$broadcast(a.b)}});const k=()=>{S.resolveGoalAlignableContents().then(([e,s])=>{0===this.goalAlignedContents.length&&(this.goalAlignedContents=e)})};k(),this.$scope.$on(b.b,k),this.discussionService.course.gradebook.settings.$resolve().$then(e=>{this.isPastDueSettingTurnOn=e.countUnsubmittedWorkAsZero||!1})}subscribeToReduxChanges(){const e=this.$ngRedux.connect(e=>({localeSettings:o.select.locale.getLocaleSettings(e,this.bbLocalize.getAppLocaleISO())}),e=>({getLocaleSettings:s=>e(o.actions.locale.getLocaleSettings(s))}))(this);this.$scope.$on("$destroy",e)}registerStateChangedHandler(){this.unRegisterStateChangedHandler=this.$scope.$on("$stateChangeStart",(e,s,t,i,n)=>{i.name.indexOf("discussion-settings")>-1&&-1===s.name.indexOf("discussion-settings")&&this.confirmCancel(e)})}buildNewGradeColumn(){return this.originDueDate=this.originDueDate||null,this.dueDatePickerValue=C(this.context.getServerTime()).add(1,"d").toDate(),this.dueTimePickerValue=new Date(this.dueDatePickerValue.getTime()),this.points=this.defaultPointPossible.toString(),this.GradeColumnModel.$build({dueDate:new Date(this.dueTimePickerValue.getTime()),possible:this.defaultPointPossible,gradingSchemaId:""})}getAdaptiveReleaseCriteria(e){const s=e&&e.adaptiveReleaseRules;if(s&&s.rules&&s.rules.length){const e=s.rules[0].criteria;this.dateCriteria=e.find(e=>e.type===o.AdaptiveReleaseCriteriaType.Date.toString()),this.dateCriteria&&(this.startDate=m.a.parseStringToDate(this.dateCriteria.start),this.endDate=m.a.parseStringToDate(this.dateCriteria.end)),this.aclCriteria=e.find(e=>e.type===o.AdaptiveReleaseCriteriaType.ACL.toString())}}setCurrentSchema(){const e=[I.SchemaScaleType.Tabular,I.SchemaScaleType.Score,I.SchemaScaleType.Percent];this.schemaService.loadSchemas(this.discussionService.course,e).then(e=>{var s;e.forEach(e=>{e.localizableTitle&&(e.ui.displayTitle=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:e.ui.displayTitleKey}))}),this.gradeSchemas=e;const t=this.gradeSchemas.length;for(let e=0;e<t;e++){const t=this.gradeSchemas[e];if(this.discussionService.currentDiscussion.gradedColumn&&this.discussionService.currentDiscussion.gradedColumn.id&&this.discussionService.currentDiscussion.gradedColumn.gradingSchemaId===t.id){this.gradeSchema=t;break}if(!(null===(s=this.discussionService.currentDiscussion.gradedColumn)||void 0===s?void 0:s.id)&&t.scaleType===I.SchemaScaleType.Score){this.gradeSchema=t;break}}this.originGradeSchema=this.gradeSchema,this.delayAutosave=!1})}save(){return this.shouldDisplayPastDueZero()?(this.$scope.$broadcast(E.a,this.pastDueStatus),this.$q.reject()):this.checkMaxPoints()?this.saveAction():this.$q.reject()}saveAction(){return!this.discussionService.currentDiscussion.allowGrading&&this.isGradedDiscussionInitially?this.openDeleteGradeConfirmationModal():this.patchDiscussion().then(()=>this._persist(!1).then(()=>{this.close()}))}_persist(e=!0){if(!this.validate())return this.$q.when();const s=[];return s.push(this.saveHardLinkContent()),s.push(this.addToCourseOutline()),this.gradeSchemaChanged(),this.discussionService.currentDiscussion.gradedColumn&&(this.dueTimePickerValue?C(this.discussionService.currentDiscussion.gradedColumn.dueDate).isSame(this.dueTimePickerValue)||(this.discussionService.currentDiscussion.gradedColumn.dueDate=new Date(this.dueTimePickerValue.getTime())):this.discussionService.currentDiscussion.gradedColumn.dueDate=null),this.discussionService.hardLinkContent.genericReadOnlyData=this.discussionService.hardLinkContent.genericReadOnlyData||{},this.discussionService.hardLinkContent.genericReadOnlyData.dueDate=(this.discussionService.currentDiscussion.gradedColumn||{}).dueDate,this.discussionService.hardLinkContent.genericReadOnlyData.hasGradeColumn=!!this.discussionService.currentDiscussion.gradedColumn,e&&s.push(this.patchDiscussion()),this.$q.all(s).then(()=>{this.settingsSaved=!0,this.$rootScope.$broadcast("bb-autosave-form",a.a.Saved),this.$scope.$broadcast(a.b),this.$rootScope.$broadcast("content-update",this.discussionService.hardLinkContent),this.discussionService.softLinkContent&&this.discussionService.softLinkContent.id&&this.$rootScope.$broadcast("content-update",this.discussionService.softLinkContent)})}cancel(){if(this.$scope.$broadcast("bb-autosave-interrupt-timer"),this.$scope.$broadcast(a.b),this.settingsSaved){const e=[];return this.discussionService.hardLinkContent.$revert(this.initiallyLoadedHardContent),e.push(this.saveHardLinkContent()),this.addDiscussionToOutline!==this.originAddToOutline&&(this.addDiscussionToOutline=this.originAddToOutline,e.push(this.addToCourseOutline())),this.discussionService.currentDiscussion.$revert(this.initiallyLoadedDiscussion),this.validateDiscussion()&&e.push(this.patchDiscussion()),this.$q.all(e).then(()=>{this.$scope.$emit("bb-autosave-form",a.a.Saved)})}if(this.initiallyLoadedHardContent.adaptiveReleaseRules){const e=this.initiallyLoadedHardContent.adaptiveReleaseRules.startDate,s=this.initiallyLoadedHardContent.adaptiveReleaseRules.endDate;this.discussionService.hardLinkContent.adaptiveReleaseRules.startDate=e?new Date(e):null,this.discussionService.hardLinkContent.adaptiveReleaseRules.endDate=s?new Date(s):null}else this.discussionService.hardLinkContent.adaptiveReleaseRules=null;return this.discussionService.currentDiscussion.$revert(this.initiallyLoadedDiscussion),this.initiallyLoadedHardContent.assignedGroups=this.discussionService.hardLinkContent.assignedGroups,this.initiallyLoadedHardContent.isGroupContent=this.discussionService.hardLinkContent.isGroupContent,this.discussionService.hardLinkContent.$revert(this.initiallyLoadedHardContent),this.$scope.$emit("bb-autosave-form",a.a.Saved),this.$q.when()}confirmCancel(e){this.isSettingFormDirty()?this.$scope.$broadcast("show-confirmation","discussion-settings",e):this.cancelAndLeave()}canCreateGroup(){var e;return this.canCreateGroups&&!(null===(e=this.discussionService.hardLinkContent)||void 0===e?void 0:e.isGroupContent)&&!this.hasComments&&!this.hasPostedGrades()&&!this.hasACLCriteria()}canDeleteGroup(){return!this.hasComments&&!this.$scope.isCourseClosed&&this.canDeleteGroups}isSettingFormDirty(){return this.isAdaptiveReleaseRulesChange()||this.addDiscussionToOutline!==this.originAddToOutline||this.isGradedDiscussionInitially!==this.discussionService.currentDiscussion.allowGrading||this.isPostFirstInitially!==this.discussionService.currentDiscussion.postFirst||this.discussionService.currentDiscussion.allowGrading&&this.isGradeDiscussionOptionsChange()}isGradeDiscussionOptionsChange(){return this.isDueDateChange()||this.originGradeSchema&&this.gradeSchema&&this.originGradeSchema.scaleType!==this.gradeSchema.scaleType||this.isGradePointChanged}isAdaptiveReleaseRulesChange(){return this.initiallyLoadedHardContent.adaptiveReleaseRules&&this.discussionService.hardLinkContent.adaptiveReleaseRules?!(this.isSameDateOrBothNull(this.initiallyLoadedHardContent.adaptiveReleaseRules.startDate,this.discussionService.hardLinkContent.adaptiveReleaseRules.startDate)&&this.isSameDateOrBothNull(this.initiallyLoadedHardContent.adaptiveReleaseRules.endDate,this.discussionService.hardLinkContent.adaptiveReleaseRules.endDate)):!this.initiallyLoadedHardContent.adaptiveReleaseRules!=!this.discussionService.hardLinkContent.adaptiveReleaseRules}isDueDateChange(){return!this.isSameDateOrBothNull(this.originDueDate,this.dueTimePickerValue)}isSameDateOrBothNull(e,s){if(e&&s){const t=new Date(e),i=new Date(s);return t.setSeconds(0,0),i.setSeconds(0,0),C(t).isSame(i)}return!e==!s}hasPostedGrades(){return!!this.discussionService.column&&!!this.discussionService.column.summary&&this.discussionService.column.summary.numPosted>0}cancelAndLeave(){this.cancel().then(()=>{this.close()})}close(){this.unRegisterStateChangedHandler(),this.leavePanel()}leavePanel(){this.ultraState.leavePeekState()}patchDiscussion(){if(!this.canEnableGrade&&!this.hasEditDueDatePermission)return this.$q.when(null);this.discussionService.currentDiscussion.gradedColumn&&(this.discussionService.currentDiscussion.gradedColumn.gradingSchemaId=this.gradeSchema.id,this.dueTimePickerValue?C(this.discussionService.currentDiscussion.gradedColumn.dueDate).isSame(this.dueTimePickerValue)||(this.discussionService.currentDiscussion.gradedColumn.dueDate=new Date(this.dueTimePickerValue.getTime())):this.discussionService.currentDiscussion.gradedColumn.dueDate=null);const{body:e,plaintextDescription:s}=this.discussionService.currentDiscussion;return this.discussionService.currentDiscussion.$patch().$asPromise().then(()=>{this.discussionService.currentDiscussion.body=e,this.discussionService.currentDiscussion.plaintextDescription=s,this.discussionService.currentDiscussion.gradedColumn?(this.originDueDate=this.discussionService.currentDiscussion.gradedColumn.dueDate&&new Date(this.discussionService.currentDiscussion.gradedColumn.dueDate.getTime()),this.$rootScope.$broadcast("bb-update-max-points",this.discussionService.currentDiscussion.gradedColumn)):this.discussionService.column=null,this.$rootScope.$broadcast(r.a),this.discussionService.currentDiscussion.allowGrading&&this.discussionService.currentDiscussion.gradedColumn&&(this.discussionService.refetchColumn().then(e=>{this.$rootScope.$broadcast(v.c,e),this.$scope.$broadcast(D.c,e),this.gradedColumnId=this.discussionService.currentDiscussion.gradedColumn.id}),this.discussionService.refreshParticipationGrade())})}saveHardLinkContent(){return this.discussionService.hardLinkContent.withParams({expand:"assignedGroups,selfEnrollmentGroups.group"}).$patch().$allow(["403"]).$then(e=>{if(this.discussionService.hardLinkContent=e,this.discussionService.softLinkContent&&this.discussionService.softLinkContent.id)return this.discussionService.softLinkContent.applyAvailabilitySettings(this.discussionService.hardLinkContent),this.discussionService.softLinkContent.applyGroupSettings(this.discussionService.hardLinkContent),this.discussionService.softLinkContent.withParams({expand:"assignedGroups,selfEnrollmentGroups.group"}).$patch().$allow(["403"]).$asPromise()}).$asPromise()}setDueDateValidity(s,t){this.$scope.discussionSettingsForm["participant-by-date"].$setValidity(e.INVALID_DUE_DATE_PER_START_END_RANGE_ERROR_KEY,s),this.$scope.discussionSettingsForm["participant-by-time"].$setValidity(e.INVALID_DUE_DATE_PER_START_END_RANGE_ERROR_KEY,t),this.$scope.discussionSettingsForm["participant-by-date"].$valid&&this.$scope.discussionSettingsForm["participant-by-time"].$valid||(this.$scope.discussionSettingsForm["participant-by-date"].$setDirty(),this.$scope.discussionSettingsForm["participant-by-time"].$setDirty(),this.$scope.discussionSettingsForm["participant-by-date"].$setTouched(),this.$scope.discussionSettingsForm["participant-by-time"].$setTouched())}isDueDateValid(){if(!this.$scope.discussionSettingsForm||!this.$scope.discussionSettingsForm["participant-by-date"])return!0;if(this.discussionService.currentDiscussion&&!this.discussionService.currentDiscussion.allowGrading||!this.canEnableGrade||!this.dueTimePickerValue||!this.dueDatePickerValue)return this.setDueDateValidity(!0,!0),!0;const e=new Date(this.dueTimePickerValue.getTime());e.setFullYear(this.dueDatePickerValue.getFullYear()),e.setDate(1),e.setMonth(this.dueDatePickerValue.getMonth()),e.setDate(this.dueDatePickerValue.getDate());const s=!this.dateCriteria||m.a.isWithinDateRange(e,{end:this.endDate,start:this.startDate});let t=!0,i=!0;if(!s){const s=!!this.startDate&&(m.a.isSameDay(this.startDate,e)&&C(e).isBefore(this.startDate)),i=!!this.endDate&&(m.a.isSameDay(this.endDate,e)&&C(e).isAfter(this.endDate));t=!s&&!i}return i=!t||s,this.setDueDateValidity(i,t),s}validate(){return!(!(this.canCreateAllContent||this.hasEditAvailabilityPermission||this.hasEditDueDatePermission)||!this.isDueDateValid())&&this.validateDiscussion()}validateDiscussion(){if(!this.isDueDateValid())return!1;const e=[];return this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.allowGrading&&this.canEnableGrade&&(this.discussionService.currentDiscussion.gradedColumn||e.push(!1),this.isPossiblePointsValid()||e.push(!1),e.push(!!(this.$scope.discussionSettingsForm&&this.$scope.discussionSettingsForm["point-possible"]&&this.$scope.discussionSettingsForm["point-possible"].$valid)||this.discussionService.currentDiscussion.gradedColumn&&void 0!==this.discussionService.currentDiscussion.gradedColumn.possible)),e.indexOf(!1)<0}updatePossiblePoints(){if(this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.gradedColumn){const e=parseFloat(this.points);this.discussionService.currentDiscussion.gradedColumn.possible=Number.isNaN(e)?0:e,this.isPossiblePointsValid()}}isPossiblePointsValid(){return parseFloat(this.points)>=T.Utils.GRADE_MIN_POINTS}gradeSchemaChanged(){this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.gradedColumn&&(this.lastSchemaType||(this.lastSchemaType=this.gradeSchema.scaleType),this.lastNumericScore=this.discussionService.currentDiscussion.gradedColumn.possible,this.discussionService.currentDiscussion.gradedColumn.possible=null!=this.lastNumericScore?this.lastNumericScore:this.defaultPointPossible,this.discussionService.currentDiscussion.gradedColumn.gradingSchemaId=this.gradeSchema.id,this.lastSchemaType=this.gradeSchema.scaleType)}showUpdateVisibility(){return this.discussionService.hardLinkContent.getVisibilityAsStudent()===I.ContentVisibility.Restricted}visibilityRulesChanged(){this.validate()&&(this.$scope.$broadcast("bb-autosave-interrupt-timer"),this.$scope.$broadcast("bb-autosave-save-trigger-debounce"))}updateGradedDiscussionFlag(){this.discussionService.currentDiscussion.allowGrading?(this.discussionService.currentDiscussion.gradedColumn=this.buildNewGradeColumn(),this.originGradedColumn=null):(this.originGradedColumn=this.discussionService.currentDiscussion.gradedColumn,this.discussionService.currentDiscussion.gradedColumn=null)}confirmDeleteGradeDiscussion(){this.modalInstance.close()}cancelDeleteGradedDiscussion(){this.modalInstance.dismiss()}checkMaxPoints(){return!(this.isGradePointChanged&&this.rubric&&!this.shouldShowPossiblePointsMessage())||(this.$scope.$broadcast(O.a,"max-points-updated-having-associated-rubric"),!1)}restoreMaxPoints(){var e,s,t;Number.isFinite(null===(t=null===(s=null===(e=this.discussionService)||void 0===e?void 0:e.currentDiscussion)||void 0===s?void 0:s.gradedColumn)||void 0===t?void 0:t.possible)&&(this.discussionService.currentDiscussion.gradedColumn.possible=this.originGradePossible),this.points=T.Utils.parseGradeValue(this.originGradePossible),this.isGradePointChanged=!1}shouldShowPossiblePointsMessage(){return Number.isFinite(this.rubricMaxPoints)&&parseFloat(this.points)===this.rubricMaxPoints}openDeleteGradeConfirmationModal(){return this.modalInstance=this.$modal.open({template:M,scope:this.$scope,resolve:{translations:[S.serviceName,e=>e.loadBundle("features/course/engagement")]}}),this.modalInstance.result.then(()=>(this.unRegisterStateChangedHandler(),this._persist().then(()=>{this.$rootScope.$broadcast("bb-delete-column",this.originGradedColumn);const e=this.ultraState.current.name,s=e.lastIndexOf(".peek.");-1!==s&&this.ultraState.go(e.substring(0,s),{view:h.l.Discussions})})),()=>{throw this.$scope.$broadcast("bb-autosave-form",a.a.Change),new Error})}openChangeMaxScoreModal(){this.modalInstance=this.$modal.open({template:L,scope:this.$rootScope,resolve:{translations:[S.serviceName,e=>e.loadBundle("features/course/engagement")]}})}showAlertMessage(){return this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.allowGrading&&this.isDiscussionGraded&&this.isGradePointChanged&&!this.isGradeSchemaChanged?this.openChangeMaxScoreModal():null}addToCourseOutline(){if(this.lastAddToOutline!==this.addDiscussionToOutline)return this.lastAddToOutline=this.addDiscussionToOutline,this.addDiscussionToOutline?this.ContentService.makeSoftLinkContentInContentTree(this.discussionService.hardLinkContent,this.discussionService.outlineRoot,this.discussionService.course.id,this.discussionService.outlineRoot.id).then(e=>(this.discussionService.softLinkContent=e,this.discussionService.softLinkContent.applyAvailabilitySettings(this.discussionService.hardLinkContent),this.discussionService.softLinkContent.applyGroupSettings(this.discussionService.hardLinkContent),this.discussionService.softLinkContent.withParams({expand:"assignedGroups,selfEnrollmentGroups.group"}).$save().$asPromise())):(this.discussionService.softLinkContent&&this.discussionService.softLinkContent.id&&(this.$scope.$emit(this.isFromCalendar?"deleteContentFromCalendar":"deleteContent",this.discussionService.softLinkContent),this.discussionService.softLinkContent=null),this.$q.when())}deleteDiscussion(){if(this.canDeleteDiscussion()){const e=[];this.discussionService.softLinkContent&&this.discussionService.softLinkContent.id&&e.push(this.ContentService.deleteContent(this.discussionService.softLinkContent)),e.push(this.ContentService.deleteContent(this.discussionService.hardLinkContent)),this.$q.all(e).then(()=>{this.close(),this.$rootScope.$broadcast(A)})}}canDeleteDiscussion(){return this.discussionPermission.canDeleteDiscussion(this.discussionService.hardLinkContent,this.discussionService.softLinkContent)}canChangePostFirstSetting(){return!this.hasComments&&!this.discussionService.hardLinkContent.isGroupContent}cantChangePostFirstBecauseComments(){return this.hasComments}cantChangePostFirstBecauseGroups(){return!this.hasComments&&this.discussionService.hardLinkContent.isGroupContent}getOriginalGradePossible(){var e,s,t;return Number.isFinite(null===(t=null===(s=null===(e=this.discussionService)||void 0===e?void 0:e.currentDiscussion)||void 0===s?void 0:s.gradedColumn)||void 0===t?void 0:t.possible)?(this.points=this.discussionService.currentDiscussion.gradedColumn.possible.toString(),this.discussionService.currentDiscussion.gradedColumn.possible):(this.points=this.defaultPointPossible.toString(),this.defaultPointPossible)}openGroupDiscussionPanel(){return this.shouldDisplayPastDueZero()?(this.shouldOpenGroupPanel=!0,void this.$scope.$broadcast(E.a,this.pastDueStatus)):this.patchDiscussion().then(()=>{this.ultraState.goPeekState("course-group",{groupCourseId:this.discussionService.course&&this.discussionService.course.id,groupContentId:this.discussionService.currentContentId,groupColumnId:this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.gradedColumn&&this.discussionService.currentDiscussion.gradedColumn.id})})}loadCommentAndReplyCount(){const e=this.$q.defer();if(this.discussionService.hardLinkContent.isGroupContent){let s=[];s=this.discussionService.hardLinkContent.assignedGroups.map(e=>this.discussionService.course.forums.$new(this.discussionService.forumId).counts.$fetch({groupId:e.groupId}).$asPromise().then(e=>e)),this.$q.all(s).then(s=>{let t=0;s.forEach(e=>{t+=e.commentCount+e.replyCount+e.draftCount}),e.resolve(t)})}else this.discussionService.course.forums.$new(this.discussionService.forumId).counts.$fetch().$asPromise().then(s=>{e.resolve(s.commentCount+s.replyCount+s.draftCount)});return e.promise}shouldFocus(e){return this.focusEleId===e}addGoals(){this.ultraState.goPeekState("goal-picker-legacy",{goalAlignableContent:this.discussionService.hardLinkContent})}showGoals(){this.showRubricsSettings=!1,this.showGoalsSettings=!0}hideGoals(){this.showGoalsSettings=!1}showRubrics(){this.showGoalsSettings=!1,this.showRubricsSettings=!0}hideRubrics(){this.showRubricsSettings=!1}isShowingSubpanel(){return this.showGoalsSettings||this.showRubricsSettings}associateRubric(e,s){Number.isFinite(s)&&(this.rubricUpdatedMaxPoints=!0,this.rubricMaxPoints=s),this.$scope.$root.$broadcast("associate-rubric",e,s),this.hideRubrics()}canShowGrading(){return this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.allowGrading&&(this.canEnableGrade||this.hasEditDueDatePermission)}automaticZeroConfirm(){this.originDueDate=this.dueDatePickerValue,this.shouldOpenGroupPanel?this.openGroupDiscussionPanel():this.saveAction()}automaticZeroDismiss(){this.isGradedDiscussionInitially?(this.dueDatePickerValue=this.originDueDate,this.dueTimePickerValue=this.originDueDate&&new Date(this.originDueDate.getTime())||null):(this.dueDatePickerValue=this.discussionService.currentDiscussion.gradedColumn.dueDate&&new Date(this.discussionService.currentDiscussion.gradedColumn.dueDate.getTime()),this.dueTimePickerValue=new Date(this.dueDatePickerValue.getTime()))}isPastDue(e){return!!e&&e<this.context.getServerTime()}shouldDisplayPastDueZero(){return!1!==this.isPastDueSettingTurnOn&&(this.isPastDue(this.originDueDate)&&!this.isPastDue(this.dueTimePickerValue)?this.pastDueStatus="after":!this.isPastDue(this.originDueDate)&&this.isPastDue(this.dueTimePickerValue)?this.pastDueStatus="before":this.pastDueStatus=null,null!==this.pastDueStatus)}get defaultPointPossible(){return T.Utils.GRADE_DEFAULT_POINTS}get maxPointsDecimals(){return T.Utils.GRADE_POINTS_DECIMALS_RULE_1}get maxPossiblePoints(){return T.Utils.GRADE_MAX_POINTS}get minPossiblePoints(){return T.Utils.GRADE_MIN_POINTS}};R.INVALID_DUE_DATE_PER_START_END_RANGE_ERROR_KEY="dueDateNotWithinStartEndRange",R.NUMBER_SMALL_KEY="numberSmall",R=Object(i.__decorate)([Object(i.__param)(0,Object(n.b)("$ngRedux")),Object(i.__param)(1,Object(n.b)("$scope")),Object(i.__param)(2,Object(n.b)("$rootScope")),Object(i.__param)(3,Object(n.b)(S.serviceName)),Object(i.__param)(4,Object(n.b)("$modal")),Object(i.__param)(5,Object(n.b)("$q")),Object(i.__param)(6,Object(n.b)(f.C.serviceName)),Object(i.__param)(7,Object(n.b)(k.d)),Object(i.__param)(8,Object(n.b)(l.b)),Object(i.__param)(9,Object(n.b)(c.f)),Object(i.__param)(10,Object(n.b)(d.b)),Object(i.__param)(11,Object(n.b)(u.b)),Object(i.__param)(12,Object(n.b)(v.i)),Object(i.__param)(13,Object(n.b)(y.b)),Object(i.__param)(14,Object(n.b)($.b)),Object(i.__param)(15,Object(n.b)(p.c)),Object(i.__param)(16,Object(n.b)(g.b)),Object(i.__param)(17,Object(n.b)(P.c))],R);class G extends R{}},BXQP:function(e,s){e.exports='<div class="timestamp" bb-load-bundle="components/directives/duration" ng-cloak bb-cache-compilation="duration-directive">\n  <div ng-if="!duration.needAgo()">\n    <div class="js-split-datetime" ng-if="duration.separateDatetime()">\n      <span class="date" ng-bind="duration.date"></span>\n      <span class="time" ng-bind="duration.time"></span>\n    </div>\n    <bb-datetime ng-if="!duration.separateDatetime()" ng-class="{\'date\':duration.date}" value="date" format="Short"></bb-datetime>\n  </div>\n  <div ng-if="duration.needAgo()"\n       class="js-duration-ago"\n       bb-translate="components.directives.duration.agoText"\n       translate-values="{durationDate: duration.date, durationTime: duration.time}"></div>\n</div>'},BjFu:function(e,s,t){"use strict";t.d(s,"b",(function(){return v})),t.d(s,"c",(function(){return S})),t.d(s,"a",(function(){return f}));var i=t("D57K"),n=t("nsO7"),o=t("Llzl"),a=t("yC9S"),r=t("Fvsw"),c=t("go4a"),l=t("pjml"),d=t("zdqs"),u=t("SoDU"),h=t("fYJU"),p=t("VdDF"),m=t("aHpC"),b=t("zGdY"),g=t("KiLF");const v="ultra.service.termMembership",S="termMembership";function f(e,s=new Date){let t=e.startDate,i=e.endDate;return b.CourseDuration.UseTerm===e.durationType&&e.term&&(t=e.term.startDate,i=e.term.endDate),p.a.isWithinDateRange(s,{start:t,end:i})}let C=class{constructor(e,s,t,i,n,o,r,c,l){this.$q=e,this.context=t,this.CourseModel=i,this.CourseMembershipModel=n,this.TermModel=o,this.UserModel=r,this.ExternalCourseModel=c,this.contextUser=l,a.b.OnRootScope(s,"courseUltraStatusChanged",(e,s,t)=>{this.updateCourseUltraStatus(s,t)})}clear(){this.termsAndMemberships=void 0,this.loadPromise=void 0}getTermsAndMemberships(){return this.loadPromise?this.loadPromise:this.reloadTermsAndMemberships()}filterMemberships(e,s,t){return e&&Array.isArray(e)?e.filter(e=>!e.course.isOrganization===s||!!e.course.isOrganization===t):[]}getCourseMembershipsFromArray(e){return this.filterMemberships(e,!0,!1)}getOrganizationMembershipsFromArray(e){return this.filterMemberships(e,!1,!0)}parseMembershipFromExternalCourse(e){const s=this.CourseMembershipModel.$new();return s.course=this.CourseModel.$new(),s.course.id=e.id,s.course.name=e.title,s.course.description=e.description,s.course.displayName=e.title,s.course.startDate=e.startDate,s.course.endDate=e.endDate,s.course.isAvailable=!0,s.course.durationType=b.CourseDuration.DateRange,s.userId=e.userId,s.isAvailable=!0,s.userHasHidden=e.isHidden,s.courseCardColorIndex=parseInt((e.id||"0").replace(/_1$/,"").replace(/[^\d]/g,""),10),s.course.ui={courseColorClass:c.a(s),isExternal:!0,description:e.description,externalUrl:e.url},s}parseExternalCourseFromMembership(e){const s=this.ExternalCourseModel.$new(e.course.id);return s.id=e.course.id,s.title=e.course.name,s.startDate=e.course.startDate,s.endDate=e.course.endDate,s.userId=e.userId,s.description=e.course.ui.description,s.url=e.course.ui.externalUrl,s.isHidden=e.userHasHidden,s}reloadTermsAndMemberships(){const e=this.$q.defer();this.loadPromise=e.promise,this.termsAndMemberships={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};const s=this.context.getServerTime();return this.$q.all([this.getInternalMembership(),this.getExternalCoursesMembership(),this.updateTermsAndMemberships()]).then(([t,i])=>{this.termsAndMemberships.membershipsByTermId=Object.create(null),this.termsAndMemberships.memberships.splice(0,this.termsAndMemberships.memberships.length),(t=t.filter((e,s,t)=>t.findIndex(s=>e.$pk===s.$pk)===s)).forEach(e=>{this.termsAndMemberships.memberships.push(e)}),i.forEach(e=>{this.termsAndMemberships.memberships.push(e)}),this.associateTermsWithCourses();const o=new u.a(this.TermModel,this.termsAndMemberships.terms);let a=new d.a(o).map(this.termsAndMemberships.memberships,s);(a=this.applyStudentAvailabilityRules(a)).forEach(e=>{const s=s=>{let t=this.termsAndMemberships.membershipsByTermId[s.id];t||(t=this.termsAndMemberships.membershipsByTermId[s.id]={memberships:[]}),t.memberships.push(e.membership)};s(e.term);const t=e.membership.course.term;!t||e.term!==o.currentTerm&&e.term!==o.upcomingTerm||s(t),this.buildTermRelationships(e)}),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach(e=>{const s=this.termsAndMemberships.membershipsByTermId[e];s.memberships=n.sortBy(s.memberships,e=>e.course.name)}),e.resolve(this.termsAndMemberships)}),this.loadPromise}getInternalMembership(){return this.contextUser.getMemberships().then(e=>(e.forEach(e=>{e.course&&(e.course.term&&(e.course.term.id=e.course.term.$pk),e.course.ui={courseColorClass:c.a(e)})}),this.getActiveMemberships(e)))}getActiveMemberships(e){return e.filter(e=>e.course&&e.isAvailable)}getExternalCoursesMembership(){return this.ExternalCourseModel.$search({limit:1e4}).$asPromise().then(e=>e.map(e=>this.parseMembershipFromExternalCourse(e)))}updateTermsAndMemberships(){return this.TermModel.$search().$asPromise().then(e=>{this.termsAndMemberships.terms=n.orderBy(e,["startDate","durationType"],["asc","desc"]);const s=u.a.decorateTerm(new this.TermModel,l.Gb.ConstantTermId.CurrentTerm.toString()),t=u.a.decorateTerm(new this.TermModel,l.Gb.ConstantTermId.UpcomingTerm.toString());this.termsAndMemberships.terms.push(s,t)})}associateTermsWithCourses(){this.termsAndMemberships.memberships.forEach(e=>{e.course.term&&(e.course.term=this.termsAndMemberships.terms.find(s=>s.id===e.course.term.id))})}buildTermRelationships(e){const s=this.termsAndMemberships.termsByTermId[e.term.id];if(e.membership.course.term){if(e.term.id!==e.membership.course.term.id){if(!s)return void(this.termsAndMemberships.termsByTermId[e.term.id]=[e.membership.course.term]);s.indexOf(e.membership.course.term)<0&&s.push(e.membership.course.term)}}else;this.termsAndMemberships.termsByTermId[e.term.id]=n.orderBy(s,["startDate","name"],["desc","asc"])}applyStudentAvailabilityRules(e){return e.filter(e=>(e.membership.isStudentOrGuestMembership()&&e.membership.course.isUndecided()&&(e.membership.course.isAvailable=!1),!0))}getCourseMembership(e){const s=this.findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==s)return this.termsAndMemberships.memberships[s]}findCourseMembership(e,s){return s.findIndex(s=>s.course.id===e)}updateCourseUltraStatus(e,s){let t=this.findCourseMembership(e,this.termsAndMemberships.memberships);-1!==t&&(this.termsAndMemberships.memberships[t].course.ultraStatus=s),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach(i=>{-1!==(t=this.findCourseMembership(e,this.termsAndMemberships.membershipsByTermId[i].memberships))&&(this.termsAndMemberships.membershipsByTermId[i].memberships[t].course.ultraStatus=s)})}filterAssociatedWithTermCourseMembershipsByTerm(e,s){return this.filterAssociatedWithTermCourseMemberships(e).filter(e=>e.course.term.id===s.id)}filterAssociatedWithTermCourseMemberships(e){return e.filter(e=>e.course.term&&!g.a.Continuous.isEqualTo(e.course.term.durationType))}filterAssortedDatesCourseMemberships(e){return e.filter(e=>null==e.course.term||e.course.term&&g.a.Continuous.isEqualTo(e.course.term.durationType))}};C=Object(i.__decorate)([Object(i.__param)(0,Object(m.b)("$q")),Object(i.__param)(1,Object(m.b)("$rootScope")),Object(i.__param)(2,Object(m.b)(r.b)),Object(i.__param)(3,Object(m.b)(l.m.serviceName)),Object(i.__param)(4,Object(m.b)(l.t.serviceName)),Object(i.__param)(5,Object(m.b)(l.Gb.serviceName)),Object(i.__param)(6,Object(m.b)(l.Jb.serviceName)),Object(i.__param)(7,Object(m.b)(l.z.serviceName)),Object(i.__param)(8,Object(m.b)(h.b))],C);class w extends C{}o.module(v,[r.a,l.N]).service(S,C)},D1Wg:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-calendar",use:"icon-medium-calendar-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-calendar"><path d="M4 3H1v20h22V3h-3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M4 1h5v4H4zM15 1h5v4h-5z" /><path d="M1 9h22" stroke-width="2" /><path d="M5 14v-1h2v1H5zM11 14v-1h2v1h-2zM17 14v-1h2v1h-2zM5 19v-1h2v1H5zM11 19v-1h2v1h-2zM17 19v-1h2v1h-2zM9 3h6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},DnAj:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-post-first",use:"icon-medium-post-first-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-post-first"><path d="M23 12c0-6.0751-4.9249-11-11-11S1 5.9249 1 12c0 2.0238.5465 3.9199 1.5 5.5488L1 23l5.5-1.4716a10.926 10.926 0 003.5 1.2902" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M13 16h9v7h-9zM15 16v-4h5v4" /></symbol>'});n.add(o);e.exports=o},Et3n:function(e,s,t){"use strict";t.d(s,"a",(function(){return r}));var i=t("D57K"),n=t("0JpG"),o=t("yC9S"),a=t("dL5/");const r="ultra.directives.group.group-count";let c=class{$onInit(){}isSelfEnrollment(){return!!(this.content.selfEnrollmentGroups&&this.content.selfEnrollmentGroups.length>0)&&this.content.selfEnrollmentGroups.some(e=>e.group&&!e.group.groupSetId)}};c=Object(i.__decorate)([Object(o.a)({moduleName:r,componentName:"bbGroupCount",template:a,bindings:{content:"<"},requireModules:[n.moduleName]})],c)},GGpz:function(e,s,t){"use strict";t.d(s,"a",(function(){return r}));var i=t("Llzl"),n=t("ERkP"),o=t("AuQm"),a=t("1ZbL");const r="ultra.components.directives.new-feature-badge",c={Class:o.NewFeatureBadge,attributes:["customBadgeClass"],renderLocalized:{topLevelTag:n.Fragment}};i.module(r,[]).component("bbNewFeatureBadge",Object(a.a)(c))},GkCm:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-small-main-menu",use:"icon-small-main-menu-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-main-menu"><path d="M1 3h14M15 8H1M1 13h14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},HApu:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-rubric",use:"icon-medium-rubric-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-rubric"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M19 5h4v4h-4zM11 5h4v4h-4zM19 12h4v4h-4zM11 12h4v4h-4zM19 19h4v4h-4zM11 19h4v4h-4zM19 1h4M11 1h4M1 8h4M1 15h4M1 22h4M1 5h6M1 12h6M1 19h6" /></symbol>'});n.add(o);e.exports=o},HdfQ:function(e,s,t){"use strict";t("i1PZ"),t("ja1T");var i=t("5iHu"),n=t("Llzl"),o=t("7/CN"),a=t("H8CZ"),r=t("lEL+"),c=t("0JpG"),l=t("nsO7"),d=t("yC9S");t.d(s,"a",(function(){return u}));const u="bbSlick";class h{constructor(e,s){this.timeout=e,this.localize=s,this.restrict="AE",this.scope={initOnload:"@",data:"=",currentIndex:"=?",accessibility:"@",arrows:"@",asNavFor:"@",autoplay:"@",autoplaySpeed:"@",centerMode:"@",centerPadding:"@",cssEase:"@",dots:"@",draggable:"@",easing:"@",fade:"@",focusOnSelect:"@",disableOffScreenSlides:"&?",hideOffScreenSlides:"&?",infinite:"@",init:"&",initialSlide:"=?",lazyLoad:"@",manualInit:"=",nextArrow:"@",onBeforeChange:"&?",onAfterChange:"&?",onInit:"&?",onReInit:"&?",onUpdate:"&",pauseOnHover:"@",prevArrow:"@",responsive:"=",slickHandle:"=",slide:"@",slidesToShow:"=?",slidesToScroll:"@",speed:"@",swipe:"@",touchMove:"@",touchThreshold:"@",toUpdateSlide:"=",vertical:"@",useCss:"@"},this.link=(e,s,t)=>{let n=!1,r=!1;const c=i(s),u=this.localize;e.$on("slickRefresh",()=>{c.slick("unslick"),c.init=b()}),e.$on("$destroy",()=>{r&&this.timeout(()=>{c.slick("unslick")},e,500)});const h=i(e.prevArrow),p=i(e.nextArrow);function m(e){e.slideCount<=e.options.slidesToShow&&(e.slideCount-1===e.currentSlide&&p.addClass("slick-disabled"),0===e.currentSlide&&h.addClass("slick-disabled")),h.hasClass("slick-disabled")?h.attr("disabled","disabled"):h.removeAttr("disabled"),p.hasClass("slick-disabled")?p.attr("disabled","disabled"):p.removeAttr("disabled")}function b(){s.on("beforeChange",(function(t,i,n,a){e.onBeforeChange&&(e.onBeforeChange({$event:t,$sl:i,$oldIndex:n,$newIndex:a}),e.$apply()),e.hideOffScreenSlides&&e.hideOffScreenSlides()?s.find(".slick-slide").children().show():e.disableOffScreenSlides&&e.disableOffScreenSlides()&&o.i(s.find(".slick-slide"))})),s.on("afterChange",(function(t,i,n){m(i),e.onAfterChange&&e.onAfterChange({$event:t,$sl:i,$newIndex:n});const a=s.find(".slick-slide");if(a.removeAttr("aria-hidden"),e.hideOffScreenSlides&&e.hideOffScreenSlides()?a.not(".slick-active, .slick-current").children().hide():e.disableOffScreenSlides&&e.disableOffScreenSlides()&&o.f(a.not(".slick-active, .slick-current")),!e.$$phase&&!e.$root.$$phase)return e.$apply((function(){return e.currentIndex=n}));e.currentIndex=n})),s.on("init",(function(t,n){e.onInit&&e.onInit(),m(n);const a=s.find(".slick-slide");if(a.removeAttr("aria-hidden"),e.hideOffScreenSlides&&e.hideOffScreenSlides()?a.not(".slick-active, .slick-current").children().hide():e.disableOffScreenSlides&&e.disableOffScreenSlides()&&o.f(a.not(".slick-active, .slick-current")),i(window).trigger("resize"),r=!0,e.toUpdateSlide)return e.toUpdateSlide=!1,n.slideHandler(e.currentIndex,!1,!0)})),e.onReInit&&s.on("reInit",(function(s,t){e.onReInit()})),c.slick({accessibility:"false"!==e.accessibility,arrows:"false"!==e.arrows,asNavFor:e.asNavFor,autoplay:"true"===e.autoplay,autoplaySpeed:null!=e.autoplaySpeed?parseInt(e.autoplaySpeed,10):3e3,centerMode:"true"===e.centerMode,centerPadding:e.centerPadding||"50px",cssEase:e.cssEase||"ease",dots:"true"===e.dots,draggable:"true"===e.draggable,easing:e.easing||"linear",fade:"true"===e.fade,focusOnSelect:"true"===e.focusOnSelect,infinite:"false"!==e.infinite,initialSlide:null!=e.initialSlide?parseInt(e.initialSlide,10):0,lazyLoad:e.lazyLoad||"ondemand",nextArrow:i(e.nextArrow),pauseOnHover:"false"!==e.pauseOnHover,prevArrow:i(e.prevArrow),responsive:e.responsive,rtl:u.isRTL(e),slide:e.slide||"div",slidesToShow:e.slidesToShow,slidesToScroll:null!=e.slidesToScroll?parseInt(e.slidesToScroll,10):1,speed:null!=e.speed?parseInt(e.speed,10):300,swipe:"false"!==e.swipe,touchMove:"false"!==e.touchMove,touchThreshold:e.touchThreshold?parseInt(e.touchThreshold,10):5,useCSS:"false"!==e.useCss,vertical:"true"===e.vertical}),s.find(".slick-list").removeAttr("aria-live");d.b.OnWindow("resize",()=>{c.get(0).slick&&i(window).width()===c.get(0).slick.windowWidth&&c.get(0).slick.setPosition()},e)}const g=()=>{c.get(0).slick&&c.get(0).slick.reinit(),c.slick("unslick"),c.find(".slick-list").remove(),e.onUpdate(),this.timeout(()=>{b(),e.$emit("update-slick-refresh")},e,0,!1)};if(e.slickHandle&&(e.slickHandle=c),e.manualInit)c.init=b,c.refresh=g;else{if(!e.initOnload)return b();n=!1,e.$watch("data",(e,s)=>{null!=e&&(n?g():(b(),n=!0))})}d.b.OnWindow("bb-offcanvas-breakpoint-large bb-offcanvas-breakpoint-medium bb-offcanvas-breakpoint-small",()=>{a.b(i(window),e=>{var s;const t=e.target,i=Object(l.isString)(null==t?void 0:t.className)?null==t?void 0:t.className:(null===(s=null==t?void 0:t.classList)||void 0===s?void 0:s.value)||"";if(!e.data.noTransitions&&-1===i.indexOf("bb-offcanvas-panel"))return!1;c.get(0).slick&&c.get(0).slick.setPosition()})},e)}}}h.$inject=[r.b,c.serviceName],n.module(u,[r.a]).directive("bbSlick",["$injector",e=>e.instantiate(h)])},IjED:function(e,s,t){"use strict";t.d(s,"a",(function(){return r})),t.d(s,"b",(function(){return c}));var i=t("nsO7"),n=t("nbDY"),o=t.n(n),a=t("TnpK");const r="ultra.services.slideoutPanel",c="slideoutPanel";class l extends o.a{}l.RubricEvaluation=new l("rubric-evaluation"),l.RubricView=new l("rubric-view"),l.AssessmentSubmissionFeedback=new l("assessment-submission-feedback"),l.DiscussionFeedback=new l("discussion-feedback");class d{constructor(e){this.ultraState=e,this.slideoutPanelIsOpen=!1,this.getMostRecentPanelState=e=>e.split(".").pop(),this.isPanelClosing=(e,s)=>this._doesStateRequireSlidePanel(this.getMostRecentPanelState(e))&&!this._doesStateRequireSlidePanel(this.getMostRecentPanelState(s)),this.setSlideoutPanelState=()=>{this.slideoutPanelIsOpen=this._doesStateRequireSlidePanel(this.getMostRecentPanelState(this.ultraState.current.name))},this.isOpen=()=>(this.setSlideoutPanelState(),this.slideoutPanelIsOpen),this.setSlideoutPanelState()}isRubricState(){return this.getMostRecentPanelState(this.ultraState.current.name)===l.RubricEvaluation.toString()||this.getMostRecentPanelState(this.ultraState.current.name)===l.RubricView.toString()}_doesStateRequireSlidePanel(e){return i.some(l.getValues(),s=>e===s.toString())}}d.$inject=[a.d];class u extends d{}angular.module(r,[]).service(c,d)},JDQK:function(e,s,t){"use strict";t("8wib"),t("v0wN"),t("sZYy"),t("D1Wg"),t("dcnw"),t("DnAj"),t("HApu"),t("dxd1"),t("KUcz");var i=t("Llzl"),n=t("Qbdf"),o=t("UD9g"),a=t("Cxi4"),r=t("ap1t"),c=t("jhBu"),l=t("8W6D"),d=t("oi1r"),u=t("o5Lu"),h=t("5Yfa"),p=t("Et3n"),m=t("5Tom"),b=t("pjml"),g=t("w/V/"),v=t("lEL+"),S=t("TnpK"),f=t("g7Mf"),C=t("0JpG"),w=t("OTLg"),D=t("fYJU"),y=t("XlSz"),k=t("NdKs"),$=t("Sa5G");t.d(s,"b",(function(){return P})),t.d(s,"a",(function(){return T}));const P="ultra.components.directives.discussion.discussionSettings",T="discussion-settings-saved";class E{constructor(e,s,t,n,o,a,r,c,l,d,u,p,m,b,v,S,f,C,w){this.$q=e,this.$window=s,this.scope=t,this.contextCourse=n,this.gradeService=o,this.discussionPermission=a,this.entitlementService=r,this.timeout=c,this.ultraState=l,this.courseModel=d,this.gradeColumnModel=u,this.userModel=p,this.$sce=m,this.accommodationService=b,this.goalAlignmentPeekStateService=v,this.schemaService=S,this.discussionService=f,this.bbLocalize=C,this.contextUser=w,this.canModifyGradebookContent=!1,this.isGraded=!1,this.canViewGroups=!1,this.canViewGroupsAsAdmin=!1,this.hasEditPermission=!1,this.hasEditAvailabilityPermission=!1,this.hasEditDueDatePermission=!1,this.hasViewContentDesigner=!1,this.hasViewGradesPermission=!1,this.hasAttempt=!1,this.hasFeedback=!1,this.feedbackText="",this.alignedGoalsCount=0,this.isPostFirstDiscussion=!1;const D=this.ultraState.prevParams&&this.ultraState.prevParams.courseId?this.ultraState.prevParams.courseId:this.ultraState.nextParams.courseId,k=this.$q.defer();this.scope.$watch("::discussionSettings.discussionService.currentDiscussion",e=>{e&&(this.refreshSettings(),k.resolve())}),this.canModifyGradebookContent=this.entitlementService.isEntitled("course.gradebook.MODIFY",D),this.canViewGroups=this.entitlementService.isEntitled($.o.ViewGroups,D),this.canViewGroupsAsAdmin=this.entitlementService.isEntitled($.o.ViewGroupsAsAdmin,D),this.hasViewContentDesigner=this.entitlementService.isEntitled("course.content.designer.VIEW",D),this.scope.$on(T,()=>{this.refreshSettings()}),this.accommodationService.forceNewContentAccommodation(f.hardLinkContent),this.accommodation=b.getContentAccommodation(f.hardLinkContent),this.scope.$on("reload-groups",()=>{this.accommodation.refreshGroups()}),this.discussionPermission.canCreateAllContent(D).then(e=>{this.canEditDiscussionSettings=e});const P=this.discussionPermission.hasEditPermission(D);P.then(e=>{this.hasEditPermission=e}),this.discussionPermission.hasEditAvailabilityPermission(D).then(e=>{this.hasEditAvailabilityPermission=e}),this.discussionPermission.hasEditDueDatePermission(D).then(e=>{this.hasEditDueDatePermission=e}),e.all([P,k.promise]).then(()=>{this.isSettingsLoaded=!0,this.timeout(()=>{this.scope.$apply(),i.element(this.$window).trigger("resize")},this.scope)}),this.scope.$watch("::discussionSettings.discussionService.hardLinkContent.id",e=>{e&&this.scope.$on(h.d(f.hardLinkContent),(e,s)=>{f.hardLinkContent.saveAlignedGoals(s)})}),this.discussionService.resolveColumn().then(e=>{e&&(this.gradeColumn=e,this.rubric=e.getAssociatedRubric())}),this.scope.$root.$broadcast(h.b),t.$on(g.a,(e,s,t)=>{var i;this.rubric=t||null,Number.isFinite(null===(i=this.gradeColumn)||void 0===i?void 0:i.possible)&&t&&this.gradeColumn&&(this.gradeColumn.possible=s.possible)}),t.$on("rubric-save",(e,s)=>{this.rubric&&this.rubric.id===s.id&&(this.rubric=s,t.$root.$broadcast(h.b))}),t.$on(y.c,()=>{this.hasAttempt=!0}),t.$on(y.b,()=>{this.hasAttempt=!1})}refreshSettings(){if(null!=this.discussionService.currentDiscussion.postFirst&&(this.isPostFirstDiscussion=this.discussionService.currentDiscussion.postFirst),this.gradeColumn=this.gradeColumnModel.$build(this.discussionService.currentDiscussion.gradedColumn),this.gradeColumn&&this.gradeColumn.courseId){const e=[];e.push(this.schemaService.loadSchemaForColumn(this.gradeColumn).then(e=>{e.localizableTitle&&(e.ui.displayTitle=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:e.ui.displayTitleKey})),this.currentSchema=e}));const s=this.contextCourse.courseId||this.ultraState.params.courseId;this.courseModel.$new(s).users.$find(this.contextUser.userId).$allow(["404"]).$then(t=>{t.id&&(e.push(this.gradeService.loadGrades(s,this.contextUser.userId).then(e=>{for(let t=0;t<e.length;t++){const i=e[t];if(i.columnId===this.gradeColumn.id){this.gradeDetail=i,this.hasAttempt=i.hasAttempts(),this.scope.setRubricGradeDetail&&this.scope.setRubricGradeDetail(this.gradeDetail),this.isGraded=this.gradeDetail.isGraded(),this.courseModel.$new(s).gradebook.columns.$new(i.columnId).grades.$new(i.id).attempts.$fetch({expand:"lastFeedbackAuthor"}).$then(e=>{if(this.gradeDetail.attempts=e,e&&e.length>0){const s=e[0].feedbackToUser?e[0].feedbackToUser.rawText:"";this.feedbackText=this.$sce.trustAsHtml(s.replace(/(.|\s*)(<a )(.|\s*)/g,'$1<a target="_blank" rel="noopener noreferrer" $3')),this.feedbackDate=e[0].modifiedDate,this.feedbackUser=e[0].lastFeedbackAuthor}this.gradeDetail.instructorFeedback&&(this.feedbackText=this.$sce.trustAsHtml(this.gradeDetail.instructorFeedback.rawText.replace(/(.|\s*)(<a )(.|\s*)/g,'$1<a target="_blank" rel="noopener noreferrer" $3'))),this.hasFeedback=0!==this.feedbackText.length});break}}})),this.$q.all(e).then(()=>{this.scope.$root.$broadcast("discussion-settings-loaded")}))})}else this.scope.$root.$broadcast("discussion-settings-loaded");this.accommodationService.refreshAccommodation(this.accommodation)}showSettings(){return this.canEditSettings()||this.discussionService.isGradedDiscussion||this.discussionService.alignedGoalsCount>0||this.discussionService.hardLinkContent.userNeedsToSelfEnrollInGroup()}canEditSettings(){return this.discussionService.hardLinkContent&&(this.canEditDiscussionSettings||this.hasViewContentDesigner||this.hasEditAvailabilityPermission||this.hasEditDueDatePermission||this.canModifyGradebookContent||this.canViewGroups||this.canViewGroupsAsAdmin)&&!(this.discussionService.course&&this.discussionService.course.isComplete())}discussionIsPersisted(){return"create"!==this.discussionService.currentContentId}canEditDueDate(){return this.hasEditPermission||this.hasEditDueDatePermission}canShowFeedbackPanel(){return this.discussionService.isGradedDiscussion&&this.hasFeedback&&this.gradeDetail&&this.gradeDetail.isPosted()}openFeedback(){this.canShowFeedbackPanel()&&this.scope.openFeedback(this.scope.closeCurrentPanel)}openGroupDiscussionPanel(e){this.ultraState.goPeekState("course-group",{groupCourseId:this.contextCourse.courseId||this.ultraState.params.courseId,groupContentId:this.discussionService.hardLinkContent.id,groupColumnId:this.gradeColumn&&this.gradeColumn.id})}openDiscussionSettingsPanel(e,s){this.ultraState.goPeekState("discussion-settings",{contentId:this.discussionService.hardLinkContent.id,focusEleId:s})}hasRubric(){return!!this.rubric}openRubric(e,s){this.rubric&&this.rubric.id&&this.ultraState.goPeekState("discussion-settings.peek.rubric.mode",{rubricId:this.rubric.id,mode:l.a.EDIT.toString()})}showRubric(e,s){this.rubric&&this.rubric.id&&this.ultraState.goPeekState("rubric-view",{columnId:this.gradeColumn.id})}rubricEvaluationIsVisible(){return this.rubric&&this.gradeDetail&&this.gradeDetail.isGraded()&&!this.gradeDetail.isOverrideGrade()}showDueDateException(){return this.discussionService.isGradedDiscussion&&this.accommodation.showAccommodation}hasPastDueZero(){return this.gradeDetail&&this.gradeDetail.isPastDueZero()}showPostFirst(){return this.isPostFirstDiscussion}isAvailable(e){const s=this.scope.getUserCourseAvailabilities&&this.scope.getUserCourseAvailabilities();return s&&s[e.id]}getGroupStudentEnrollmentContent(){return this.discussionService.softLinkContent?this.discussionService.softLinkContent:this.discussionService.hardLinkContent}}E.$inject=["$q","$window","scope",n.e,u.i,a.b,c.b,v.b,S.d,b.m.serviceName,b.C.serviceName,b.Jb.serviceName,"$sce",w.d,o.c,d.b,f.c,C.serviceName,D.b];class O{constructor(e){this.$injector=e,this.restrict="E",this.template=k,this.scope={getUserCourseAvailabilities:"&userCourseAvailabilities",openFeedback:"=",closeCurrentPanel:"<",setRubricGradeDetail:"=?"},this.link=(e,s,t)=>{e.discussionSettings=this.$injector.instantiate(E,{scope:e,element:s,attrs:t})}}}O.$inject=["$injector"],i.module(P,[n.b,a.a,c.a,u.h,b.N,w.c,o.b,d.a,p.a,m.b,r.c,f.b,C.moduleName]).directive("bbDiscussionSettings",["$injector",e=>e.instantiate(O)])},Jygx:function(e,s){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i(e){this.message=e}i.prototype=new Error,i.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var s=String(e).replace(/=+$/,"");if(s.length%4==1)throw new i("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,a=0,r=0,c="";o=s.charAt(r++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o=t.indexOf(o);return c}},KUcz:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-small-feedback-c",use:"icon-small-feedback-c-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-feedback-c"><path d="M15.5.5H.5v12h5L8 15.2l2.5-2.7h5V.5z" fill="#C56FD5" stroke="#A234B5" /><path d="M3 9.5h5m-5-6h10H3zm0 3h10H3z" stroke="#fff" /></symbol>'});n.add(o);e.exports=o},"Lgb/":function(e,s){e.exports='<bb-modal id="notification-modal"\n          class="notification"\n          modal-title-key="course.engagement.discussionSettings.deleteModal.modalTitle"\n          analytics-id-tag-prefix="course.engagement.discussionSettings.deleteModal">\n  <div name="modal-contents">\n    <p bb-translate>course.engagement.discussionSettings.deleteModal.modalContent</p>\n  </div>\n  <button name="modal-footer-button-primary" \n          class="button confirm-ok js-primary-button" \n          ng-click="discussionSettings.confirmDeleteGradeDiscussion()"\n          analytics-id="course.engagement.discussionSettings.deleteModal.confirmButton.button">\n    <span bb-translate>course.engagement.discussionSettings.deleteModal.confirmButton</span>\n  </button>\n  <button name="modal-footer-button-secondary" \n          class="button button--secondary confirm-cancel js-secondary-button" \n          ng-click="discussionSettings.cancelDeleteGradedDiscussion()"\n          analytics-id="course.engagement.discussionSettings.deleteModal.cancelButton.button">\n    <span bb-translate>course.engagement.discussionSettings.deleteModal.cancelButton</span>\n  </button>\n</bb-modal>'},MYrX:function(e,s){e.exports='<div class="rubric-settings" bb-load-bundle="components/directives/rubric/rubric-settings">\n  <div class="rubric-settings-controls" ng-switch="isDisabled() || !rubricSettings.hasRubricPermissions">\n    <div class="tool-icon">\n      <bb-svg-icon size="medium" icon="rubric"></bb-svg-icon>\n    </div>\n    <div ng-switch-when="true">\n      <div class="tool-text no-active-rubric-container">\n        <span class="settings-label" bb-translate>components.directives.rubric.settings.gradingRubric</span>\n        <div class="text toggle-rubric-list permissions-text">\n          <span bb-translate>components.directives.rubric.settings.unavailable.permission</span>\n        </div>\n      </div>\n    </div>\n    <div ng-switch-default>\n      <div class="tool-text no-active-rubric-container" ng-show="!rubricSettings.rubric">\n        <span class="settings-label" bb-translate>components.directives.rubric.settings.useRubric</span>\n        <button class="button button--text toggle-rubric-list settings-link" ng-click="rubricSettings.toggleRubricList()" ng-if="!contentHasQuestions()"\n                bb-translate-attrs="{\'aria-label\':\'components.directives.rubric.settings.addRubric\'}" bb-translate type="button" analytics-id="components.directives.rubric.settings.addRubric">\n          components.directives.rubric.settings.addRubric\n        </button>\n\n        \x3c!-- tabindex added because field is normally interactive. See LRN-118128 --\x3e\n        <div class="text toggle-rubric-list cant-add-rubric-text"\n             ng-if="contentHasQuestions()"\n             ng-switch="rubricSettings.columnIsAssignmentCategory()">\n          <span ng-switch-when="true">\n            <span bb-translate>components.directives.rubric.settings.unavailable.assignment</span>\n          </span>\n          <span ng-switch-default>\n            <span bb-translate>components.directives.rubric.settings.unavailable.assessment</span>\n          </span>\n        </div>\n      </div>\n      <div class="tool-text rubric-item  js-rubric-id-{{ rubricSettings.rubric.id }} large-12 medium-12 small-10 rubric-item--width" ng-show="rubricSettings.rubric">\n        <span class="settings-label rubric-title" bb-translate>\n          components.directives.rubric.settings.gradingRubric\n        </span>\n        <span class="settings-link rubric-title">\n          <a class="rubric-title__text" bb-peek-sref="rubric.mode({rubricId: rubricSettings.rubric.id, mode: \'edit\'})" analytics-id="components.directives.rubric.settings.tooltip.title.link">{{ rubricSettings.rubric.title }}</a>\n        </span>\n      </div>\n      <div ng-if="rubricSettings.rubric">\n        <button ng-if="rubricSettings.hasRubricEvals"\n                bb-confirmation-needed="x-bb-rubric-delete-association"\n                show-type="always"\n                class="remove-active-rubric super-clear svg-icon-button medium"\n                ng-click="rubricSettings.removeActiveRubric($event)" tabindex="0"\n                bb-translate-attrs="{\'aria-label\':\'components.directives.rubric.settings.removeRubric\', \'title\': \'components.directives.rubric.settings.tooltip.remove\'}"\n                type="button" analytics-id="components.directives.rubric.settings.tooltip.remove.button">\n          <bb-svg-icon size="small" icon="trash"></bb-svg-icon>\n        </button>\n        <button ng-if="!rubricSettings.hasRubricEvals"\n                class="remove-active-rubric super-clear svg-icon-button medium js-remove-evaluation"\n                ng-click="rubricSettings.removeActiveRubric($event)" tabindex="0"\n                bb-translate-attrs="{\'aria-label\':\'components.directives.rubric.settings.removeRubric\', \'title\': \'components.directives.rubric.settings.tooltip.remove\'}"\n                type="button" analytics-id="components.directives.rubric.settings.tooltip.remove.button">\n          <bb-svg-icon size="small" icon="trash"></bb-svg-icon>\n        </button>\n      </div>\n      <span class="rubric-extra-info" ng-if="rubricSettings.getPeerGradingInfo() != null">\n        <span class="restriction" ng-if="rubricSettings.getPeerGradingInfo() === \'peerGrading\'" bb-translate>components.directives.rubric.settings.extraInfo.peerGrading</span>\n      </span>\n    </div>\n  </div>\n</div>\n'},MoIS:function(e,s,t){"use strict";var i=t("Llzl"),n=t("0JpG"),o=t("tka7"),a=t("70Xn"),r=t("tmbA");t.d(s,"c",(function(){return c})),t.d(s,"a",(function(){return l})),t.d(s,"b",(function(){return d}));const c="ultraUi.components.directives.grade.pastDueZero",l="bb-past-due-zero-confirmation",d="bb-past-due-zero-settings",u="course.grades.pastDue.confirmationNeeded.";class h{constructor(e,s,t,i,n){this.scope=e,this.element=s,this.attrs=t,this.$modal=i,this.bbLocalize=n,this.scope.$on(l,(e,s)=>{this.displayPastDueConfirmation(s)}),this.scope.$on(d,(e,s)=>{this.isPastZeroAssigned=s,this.displayPastDueConfirmation()})}displayPastDueConfirmation(e){e?this.initModalTranslateOptions(e):this.initModalTranslateOptions();let s=!1;const t=this.scope;this.$modal.open({template:e?a:r,scope:t,resolve:{translations:[n.serviceName,e=>e.loadBundle("course/grades/pastDue/confirmationNeeded")]},controller:["$scope",n.serviceName,function(e,i){e.okAction=()=>{e.$close(),s=!0},e.cancelAction=()=>{e.$close(),s=!1,t.cancelCallback&&t.cancelCallback()}}]}).result.then(()=>{s&&this.scope.confirmCallback&&(this.isPastZeroAssigned?this.scope.confirmCallback():this.scope.confirmCallback({args:{choice:this.scope.modalTranslateOptions.choiceModal}}))},()=>{this.scope.dismissCallback&&this.scope.dismissCallback()})}initModalTranslateOptions(e){if(e)return this.scope.modalTranslateOptions={title:{key:u+"title"},instructions:{key:u+e+".instructions"}};const s=this.isPastZeroAssigned?"assign":"unassign";if(this.scope.modalTranslateOptions={title:{key:u+s+".title"},instructions:{key:u+s+".instructions"},confirm:{key:u+s+".confirm"},cancel:{key:u+s+".cancel"}},!this.isPastZeroAssigned){const e=[{id:"past-due-unassign-retain",name:"pastDueUnassignZero",value:o.a.Retain.toString(),localizedKey:u+"unassign.choices.retain"},{id:"past-due-unassign-delete",name:"pastDueUnassignZero",value:o.a.Delete.toString(),localizedKey:u+"unassign.choices.delete",descriptionKey:u+"unassign.choices.instructions"}];Object.assign(this.scope.modalTranslateOptions,{choices:e,choiceModal:e[0].value})}return this.scope.modalTranslateOptions}}h.$inject=["scope","element","attrs","$modal",n.serviceName];class p{constructor(e){this.$injector=e,this.restrict="E",this.template=a,this.scope={confirmCallback:"&?",cancelCallback:"&?",dismissCallback:"&?"},this.link=(e,s,t)=>{e.pastDueZero=this.$injector.instantiate(h,{scope:e,element:s,attrs:t})}}}p.$inject=["$injector"],i.module(c,[]).directive("bbPastDueZero",["$injector",e=>e.instantiate(p)])},NdKs:function(e,s){e.exports='<div bb-load-bundle="components/directives/discussion-settings"\n     class="full-panel-details"\n     ng-if="::discussionSettings.isSettingsLoaded">\n  <div class="discussion-settings"\n       ng-class="{\'student-details\': !discussionSettings.canEditSettings()}"\n       ng-if="discussionSettings.showSettings()">\n    <div class="full-panel-details-title row collapse">\n      <div class="text-wrapper columns small-10">\n        <h2 bb-translate ng-if="discussionSettings.canEditSettings()">components.directives.discussionSettings.title</h2>\n        <h2 bb-translate ng-if="!discussionSettings.canEditSettings()">components.directives.discussionSettings.discussionDetailsLabel</h2>\n      </div>\n      <div class="button-wrapper columns small-2" ng-if="discussionSettings.canEditSettings() && discussionSettings.discussionIsPersisted()">\n        <a bb-peek-sref="discussion-settings({contentId: discussionSettings.discussionService.currentContentId})"\n           bb-translate-attrs="{\'title\': \'components.directives.discussionSettings.edit\', \'aria-label\': \'components.directives.discussionSettings.edit\'}"\n           class="icon super-clear right button"\n           id="discussion-settings-button"\n           analytics-id="components.directives.discussionSettings.settings.link">\n          <bb-svg-icon icon="settings" size="medium"></bb-svg-icon>\n        </a>\n      </div>\n    </div>\n    <div class="full-panel-details-info discussion-settings-info">\n\n      \x3c!-- Due Date --\x3e\n      <div class="element-card discussion-info-list row"\n           ng-if="discussionSettings.discussionService.isGradedDiscussion">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="calendar" size="medium"></bb-svg-icon>\n        </div>\n        <div id="discussion-due-date-option" class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>components.directives.discussionSettings.participateBy</span>\n          </div>\n          <div ng-if="discussionSettings.canEditDueDate() && discussionSettings.discussionIsPersisted()">\n            <a bb-peek-sref="discussion-settings({contentId: discussionSettings.discussionService.currentContentId, focusEleId: \'participant-by-date\'})"\n               bb-translate\n               ng-if="discussionSettings.gradeColumn.dueDate"\n               translate-values="{datetime: discussionSettings.gradeColumn.dueDate}"\n               analytics-id="components.directives.discussionSettings.dueDateFormat">\n              components.directives.discussionSettings.dueDateFormat\n            </a>\n            <a bb-peek-sref="discussion-settings({contentId: discussionSettings.discussionService.currentContentId, focusEleId: \'participant-by-date\'})"\n               bb-translate\n               ng-if="!discussionSettings.gradeColumn.dueDate"\n               analytics-id="components.directives.discussionSettings.noDueDate">\n              components.directives.discussionSettings.noDueDate\n            </a>\n          </div>\n          <div ng-if="!discussionSettings.canEditDueDate() || !discussionSettings.discussionIsPersisted()">\n            <span bb-translate\n                  ng-if="discussionSettings.gradeColumn.dueDate"\n                  translate-values="{datetime: discussionSettings.gradeColumn.dueDate}">\n              components.directives.discussionSettings.dueDateFormat\n            </span>\n            <span bb-translate\n                  ng-if="!discussionSettings.gradeColumn.dueDate">\n              components.directives.discussionSettings.noDueDate\n            </span>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Grading (editable view) --\x3e\n      <div class="element-card discussion-info-list row" ng-if="discussionSettings.canEditSettings()">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="grade" size="medium"></bb-svg-icon>\n        </div>\n        <div id="discussion-grading-option" class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>components.directives.discussionSettings.grading</span>\n          </div>\n          <div ng-if="!discussionSettings.discussionService.isGradedDiscussion">\n            <a bb-peek-sref="discussion-settings({contentId: discussionSettings.discussionService.currentContentId, focusEleId: \'is-graded-discussion\'})"\n              bb-translate\n              ng-if="discussionSettings.canModifyGradebookContent && discussionSettings.discussionIsPersisted()"\n              ng-disabled="discussionSettings.discussionService.currentContentId == \'create\'"\n              analytics-id="components.directives.discussionSettings.notGradedDiscussion">\n              components.directives.discussionSettings.notGradedDiscussion</a>\n            <span bb-translate\n                  ng-if="!discussionSettings.canModifyGradebookContent || !discussionSettings.discussionIsPersisted()">\n              components.directives.discussionSettings.notGradedDiscussion\n            </span>\n          </div>\n          <div ng-if="discussionSettings.discussionService.isGradedDiscussion">\n            <a bb-peek-sref="discussion-settings({contentId: discussionSettings.discussionService.currentContentId, focusEleId: \'graded-discussion-participants\'})"\n               ng-if="discussionSettings.canModifyGradebookContent && discussionSettings.discussionIsPersisted()"\n               bb-translate analytics-id="{{discussionSettings.currentSchema.ui.displayTitle}}">\n              {{discussionSettings.currentSchema.ui.displayTitle}}\n            </a>\n            <span bb-translate ng-if="!discussionSettings.canModifyGradebookContent || !discussionSettings.discussionIsPersisted()">\n              {{discussionSettings.currentSchema.ui.displayTitle}}\n            </span>\n            <span class="grading-separator" ng-hide="discussionSettings.currentSchema.scaleType === \'TEXT\'">|</span>\n            <a bb-peek-sref="discussion-settings({contentId: discussionSettings.discussionService.currentContentId, focusEleId: \'point-possible\'})"\n              bb-translate\n              ng-if="discussionSettings.canModifyGradebookContent && discussionSettings.discussionIsPersisted()"\n              translate-values="{point: discussionSettings.gradeColumn.possible}"\n              analytics-id="components.directives.discussionSettings.gradeMax.Points.plural">\n              components.directives.discussionSettings.gradeMax.Points.plural\n            </a>\n            <span bb-translate\n                  ng-if="!discussionSettings.canModifyGradebookContent || !discussionSettings.discussionIsPersisted()"\n                  translate-values="{point: discussionSettings.gradeColumn.possible}">\n              components.directives.discussionSettings.gradeMax.Points.plural\n            </span>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Rubrics --\x3e\n      <div class="element-card discussion-info-list row"\n          ng-if="discussionSettings.discussionService.isGradedDiscussion && discussionSettings.hasRubric()">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="rubric" size="medium"></bb-svg-icon>\n        </div>\n        <div class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>components.directives.discussionSettings.rubric</span>\n          </div>\n          <div class="settings-link">\n            <a class="rubric-title"\n                href="javascript:void(0);"\n                ng-click="discussionSettings.openRubric()"\n                ng-if="discussionSettings.canModifyGradebookContent"\n                analytics-id="components.directives.discussionSettings.openRubric.link">\n              {{discussionSettings.rubric.title}}\n            </a>\n            <a class="rubric-title"\n                href="javascript:void(0);"\n                ng-click="discussionSettings.showRubric()"\n                ng-if="!discussionSettings.canModifyGradebookContent"\n                analytics-id="components.directives.discussionSettings.gradedWithRubric.link">\n               <span bb-translate>components.directives.discussionSettings.gradedWithRubric</span>\n            </a>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Goals --\x3e\n      <div class="element-card discussion-info-list row" ng-if="discussionSettings.discussionService.alignedGoalsCount > 0">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="goal" size="medium"></bb-svg-icon>\n        </div>\n        <div class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>course.goal-alignment.goal.header</span>\n          </div>\n          <div>\n            <span class="settings-link js-view-goals">\n              <a bb-peek-sref="no-grade-content-goal-alignment"\n                 bb-translate\n                 href="javascript:void(0);"\n                 translate-values="{number: discussionSettings.discussionService.alignedGoalsCount}"\n                 analytics-id="course.goal-alignment.goal.alignedGoals.plural">\n                course.goal-alignment.goal.alignedGoals.plural\n              </a>\n            </span>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Accommodations --\x3e\n      <div class="element-card discussion-info-list row"\n           ng-if="discussionSettings.showDueDateException() && discussionSettings.canEditSettings()">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="accommodations" size="medium"></bb-svg-icon>\n        </div>\n        <div bb-load-bundle="features/course/content/exceptions/exceptions" class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>course.content.exceptions.settings.label</span>\n          </div>\n          <div>\n            <a bb-peek-sref="view-exceptions({contentId: discussionSettings.discussionService.currentContentId})"\n               bb-translate\n               ng-if="!discussionSettings.accommodation.isGroupContent"\n               translate-values="{number: discussionSettings.accommodation.nInstancesShown}"\n               analytics-id="course.content.exceptions.settings.students.plural">\n              course.content.exceptions.settings.students.plural\n            </a>\n            <a bb-peek-sref="view-exceptions({contentId: discussionSettings.discussionService.currentContentId})"\n               bb-translate\n               ng-if="discussionSettings.accommodation.isGroupContent"\n               translate-values="{number: discussionSettings.accommodation.nInstancesShown}"\n               analytics-id="course.content.exceptions.settings.groups.plural">\n              course.content.exceptions.settings.groups.plural\n            </a>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Post First --\x3e\n      <div class="element-card discussion-info-list row"\n           ng-if="discussionSettings.showPostFirst() && discussionSettings.canEditSettings()">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="post-first" size="medium"></bb-svg-icon>\n        </div>\n        <div class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>components.directives.discussionSettings.postFirst</span>\n          </div>\n          <div>\n            <a href="javascript:void(0);"\n               bb-translate\n               ng-click="discussionSettings.openDiscussionSettingsPanel($event, \'post-first\')"\n               ng-if="discussionSettings.hasEditPermission && discussionSettings.discussionIsPersisted()"\n               analytics-id="components.directives.discussionSettings.postFirstEnabled">\n              components.directives.discussionSettings.postFirstEnabled\n            </a>\n            <span bb-translate\n                  ng-if="!discussionSettings.hasEditPermission || !discussionSettings.discussionIsPersisted()">\n              components.directives.discussionSettings.postFirstEnabled\n            </span>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Groups --\x3e\n      <div class="element-card discussion-info-list row"\n           ng-if="discussionSettings.discussionService.hardLinkContent.userNeedsToSelfEnrollInGroup()">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="groups" size="medium"></bb-svg-icon>\n        </div>\n        <div class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>components.directives.discussionSettings.groupDiscussion</span>\n          </div>\n          <div><bb-group-student-enrollment content="discussionSettings.getGroupStudentEnrollmentContent()"\n                                            from-view="discussion.view.with-grading"></bb-group-student-enrollment></div>\n        </div>\n      </div>\n      <div class="element-card discussion-info-list row"\n           ng-if="discussionSettings.discussionService.hardLinkContent.isGroupContent && (discussionSettings.canViewGroups || discussionSettings.canViewGroupsAsAdmin)">\n        <div class="element-image icon columns small-2">\n          <bb-svg-icon icon="groups" size="medium"></bb-svg-icon>\n        </div>\n        <div class="element-details discussion-info-details columns small-10">\n          <div class="name">\n            <span bb-translate>components.directives.discussionSettings.groupDiscussion</span>\n          </div>\n          <div>\n            <span class="settings-link">\n              <a href="javascript:void(0);"\n                 ng-click="discussionSettings.openGroupDiscussionPanel($event)"\n                 ng-if="discussionSettings.canViewGroupsAsAdmin"\n                 analytics-id="components.directives.discussionSettings.openGroupDiscussionPanel.link">\n                <bb-group-count content="discussionSettings.discussionService.hardLinkContent"></bb-group-count>\n              </a>\n              <span ng-if="!discussionSettings.canViewGroupsAsAdmin">\n                <bb-group-count content="discussionSettings.discussionService.hardLinkContent"></bb-group-count>\n              </span>\n            </span>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Grading (non-editable view) --\x3e\n      <div ng-if="!discussionSettings.canEditSettings()">\n        <div class="grading-card-title" ng-if="discussionSettings.discussionService.isGradedDiscussion">\n          <span bb-translate ng-if="discussionSettings.isGraded" ng-class="{\'alert\': discussionSettings.hasPastDueZero()}">\n            components.directives.discussionSettings.gradeLabel\n          </span>\n          <span bb-translate ng-if="!discussionSettings.isGraded">components.directives.discussionSettings.gradingLabel</span>\n        </div>\n        <div class="alert grading-notice" ng-if="discussionSettings.hasPastDueZero() && !discussionSettings.hasAttempt">\n          <button class="alert-icon-wrapper"\n            bb-tooltip\n            enhanced-tooltip="true"\n            tooltip-position="top"\n            tooltip-center-content="true"\n            tooltip-enable-on-mouse-over-for-all-breakpoints="true"\n            tooltip-enable-on-mouse-leave-for-all-breakpoints="true"\n            bb-translate-attrs="{\'title\': \'components.directives.discussionSettings.pastDueZero.pastDueAndNotParticipated\',\n                                \'aria-label\': \'components.directives.discussionSettings.pastDueZero.infoIcon\'\n                              }"\n            analytics-id="components.directives.discussionSettings.pastDueZero.button">\n            <bb-svg-icon class="alert-icon" icon="attention" size="small" status="alert"></bb-svg-icon>\n          </button>\n          <span class="notice-text" bb-translate>components.directives.discussionSettings.pastDueZero.participateNowToUpdate</span>\n        </div>\n\n        <div ng-if="discussionSettings.discussionService.isGradedDiscussion">\n          <a href="javascript:void(0);" tabindex="0" class="grading-card button feedback-authoring-panel-on"\n             ng-class="{ \'grading-card-clickable\': discussionSettings.canShowFeedbackPanel() }" ng-click="discussionSettings.openFeedback()"\n             analytics-id="components.directives.discussionSettings.openFeedback.link">\n            <div ng-if="discussionSettings.isGraded" class="student-graded">\n              <div class="panel">\n                <div class="row collapse">\n                  <div class="element-card nocontent columns small-9 large-8">\n                    <div class="element-image">\n                      <bb-ui-icon-large-discussion color="primary"></bb-ui-icon-large-discussion>\n                      \x3c!--TODO: Remove this Icon when LRN-175360 is done--\x3e\n                      <bb-svg-icon class="element-feedback-image"\n                                   icon="feedback-c"\n                                   ng-show="discussionSettings.canShowFeedbackPanel()"\n                                   size="small">\n                      </bb-svg-icon>\n                    </div>\n                    <div class="element-details">\n                      <span bb-translate>components.directives.discussionSettings.discussion</span>\n                    </div>\n                  </div>\n                  <div class="student-grade-detail columns small-3 large-4">\n                    <bb-display-grade-pill column="discussionSettings.gradeColumn" grade="discussionSettings.gradeDetail"></bb-display-grade-pill>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class="student-not-graded" ng-if="!discussionSettings.isGraded">\n              <div class="row">\n                <div class="panel columns small-8 grade-info-left">\n                  <span bb-translate>components.directives.discussionSettings.highestScoreLabel</span>\n                </div>\n                <div class="panel columns small-4 highest-score"\n                     ng-show="discussionSettings.currentSchema"\n                     ng-switch="discussionSettings.currentSchema.scaleType">\n                  <span bb-translate ng-switch-when="SCORE" translate-values="{score: discussionSettings.gradeColumn.possible}">\n                    components.directives.discussionSettings.highestScore.plural\n                  </span>\n                  <span ng-switch-when="TABULAR">\n                    <span>{{discussionSettings.currentSchema.symbols[0].symbol}}</span>\n                  </span>\n                  <span ng-switch-when="PERCENT">\n                    <span bb-translate translate-values="{percentage: 100}">global.percent</span>\n                  </span>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        \x3c!-- grading info end--\x3e\n      </div>\n\n    </div>\n  </div>\n</div>\n'},OaUS:function(e,s){e.exports='<bb-modal id="notification-modal-deleted"\n          class="notification engagement-deleted"\n          modal-title-key="course.engagement.engagementDeleted.title"\n          analytics-id-tag-prefix="course.engagement.engagementDeleted">\n  <div name="modal-contents" tabindex="0">\n    <p bb-translate>course.engagement.engagementDeleted.description</p>\n  </div>\n  <button name="modal-footer-button-primary" \n          class="button dismiss-button js-primary-button" \n          ng-click="$parent.$dismiss()" \n          bb-translate\n          analytics-id="course.engagement.engagementDeleted.okButton">\n    course.engagement.engagementDeleted.okButton\n  </button>\n</bb-modal>'},OsJo:function(e,s,t){"use strict";t.d(s,"a",(function(){return i}));class i{static insertElement(e,s,t,i){const n=`lr_${s}_scope`,o=`lr_${s}_element`;return e&&!e[n]&&(e[n]=e.$new(),t(e[n],s=>{e[o]=s,i.append(e[o])}),e.$applyAsync()),{childScope:e[n],childElement:e[o]}}static removeElement(e,s){const t=`lr_${s}_scope`,i=`lr_${s}_element`;e&&e[t]&&(e[i].remove(),delete e[i],e[t].$destroy(),delete e[t],e.$applyAsync())}}},P2BA:function(e,s,t){},SoDU:function(e,s,t){"use strict";t.d(s,"a",(function(){return o}));var i=t("VdDF"),n=t("pjml");class o{constructor(e,s){this.TermModel=e,this.terms=s,this.currentTerm=this.getTerm(n.Gb.ConstantTermId.CurrentTerm.toString()),this.upcomingTerm=this.getTerm(n.Gb.ConstantTermId.UpcomingTerm.toString())}getTerm(e){return this.terms.filter(s=>s.id===e)[0]}static decorateTerm(e,s){return e.id=s,e.ui={type:s},e}createYearTerm(e){const s=e.getFullYear(),t="year-"+s;let i=this.getTerm(t);return i||((i=new this.TermModel).id=t,i.ui={type:"year",year:s},i.startDate=new Date(s,0),this.addTerm(i)),i}addTerm(e){if(e)for(let s=0;s<this.terms.length;s++)if(this.terms[s].startDate>=e.startDate||this.terms[s]===this.currentTerm)return void this.terms.splice(s,0,e)}filterTerm(e){return this.terms.filter(s=>!!n.Gb.TermDuration.DateRange.isEqualTo(s.durationType)&&i.a.isWithinDateRange(e,{start:s.startDate,end:s.endDate}))}}},U2yg:function(e,s){e.exports='<div bb-load-bundle="components/directives/content-navigator" class="content-navigator-container" ng-if="$ctrl.shouldShowNavigator()" >\n  <div class="content-navigator-pre">\n    <a ng-click="$ctrl.navigate(\'previous\')"\n       translate-attrs-values="{contentItem: $ctrl.sibling.previous.title}"\n       bb-translate-attrs="{\'aria-label\': \'components.directives.content-navigator.previous-content-item\'}"\n       ng-if="$ctrl.sibling.previous"\n       href="javascript:void(0);"\n       ng-disabled="!$ctrl.sibling.previous.canEdit() && $ctrl.sibling.previous.isConditionalReleaseLocked()"\n       analytics-id="components.directives.content.content-navigator.previous.link"\n    >\n      <bb-svg-icon icon="back-arrow" size="medium"></bb-svg-icon>\n      <span ng-if="!$ctrl.content.isTest() && !$ctrl.content.isGradedScorm()" class="ellipse" title="{{::$ctrl.sibling.previous.title}}">{{$ctrl.sibling.previous.title}}</span>\n\n      <div ng-if="!$ctrl.sibling.previous.canEdit() && $ctrl.sibling.previous.isConditionalReleaseLocked()"\n           bb-complex-tooltip\n           enhanced-tooltip="true"\n           tooltip-position="bottom"\n           tooltip-open-on-activation="true"\n           tooltip-disable-on-mouse-over="true"\n           tooltip-scope="$ctrl.cr.previous.tooltipScope"\n           tooltip-template="{{::$ctrl.cr.previous.getConditionalReleaseComplexTooltipTemplate()}}"\n           tabindex="0" onclick="return false;">\n        <bb-svg-icon size="small" icon="lock"></bb-svg-icon>\n        <span class="sr-only">{{::$ctrl.cr.previous.tooltips}}</span>\n      </div>\n    </a>\n  </div>\n\n  <div class="content-navigator-next">\n    <a ng-click="$ctrl.navigate(\'next\')"\n       translate-attrs-values="{contentItem: $ctrl.sibling.next.title}"\n       bb-translate-attrs="{\'aria-label\': \'components.directives.content-navigator.next-content-item\'}"\n       ng-if="$ctrl.sibling.next"\n       href="javascript:void(0);"\n       ng-disabled="!$ctrl.sibling.next.canEdit() && $ctrl.sibling.next.isConditionalReleaseLocked()"\n       analytics-id="components.directives.content.content-navigator.previous.link"\n    >\n      <div ng-if="!$ctrl.sibling.next.canEdit() && $ctrl.sibling.next.isConditionalReleaseLocked()"\n           bb-complex-tooltip\n           enhanced-tooltip="true"\n           tooltip-position="bottom"\n           tooltip-open-on-activation="true"\n           tooltip-disable-on-mouse-over="true"\n           tooltip-scope="$ctrl.cr.next.tooltipScope"\n           tooltip-template="{{::$ctrl.cr.next.getConditionalReleaseComplexTooltipTemplate()}}"\n           tabindex="0" onclick="return false;">\n        <bb-svg-icon size="small" icon="lock"></bb-svg-icon>\n        <span class="sr-only">{{::$ctrl.cr.next.tooltips}}</span>\n      </div>\n\n      <span ng-if="!$ctrl.content.isTest() && !$ctrl.content.isGradedScorm()" class="ellipse" title="{{::$ctrl.sibling.next.title}}">{{$ctrl.sibling.next.title}}</span>\n      <bb-svg-icon icon="forward-arrow" size="medium"></bb-svg-icon>\n    </a>\n  </div>\n</div>\n'},UsDD:function(e,s,t){"use strict";t.d(s,"a",(function(){return o}));var i=t("zYa8"),n=t("fewm");const o="ultra.components.directives.bbUiIcon.large.Rubric";Object(i.a)(n.a,o,"bbUiIconLargeRubric")},Vq5j:function(e,s){e.exports='<bb-modal id="notification-modal" class="notification" \n          modal-title-key="course.engagement.discussionSettings.changeMaxScoreMoal.modalTitle"\n          analytics-id-tag-prefix="course.engagement.discussionSettings.changeMaxScoreMoal">\n  <div name="modal-contents">\n    <p bb-translate>course.engagement.discussionSettings.changeMaxScoreMoal.modalContent</p>\n  </div>\n  <button name="modal-footer-button-primary" \n          class="button confirm-ok js-primary-button" \n          ng-click="$parent.$dismiss()"\n          analytics-id="course.engagement.discussionSettings.changeMaxScoreMoal.okButton.button">\n    <span bb-translate>course.engagement.discussionSettings.changeMaxScoreMoal.okButton</span>\n  </button>\n</bb-modal>'},WSu0:function(e,s,t){"use strict";var i=t("aY38");function n(e){this.message=e}n.prototype=new Error,n.prototype.name="InvalidTokenError",e.exports=function(e,s){if("string"!=typeof e)throw new n("Invalid token specified");var t=!0===(s=s||{}).header?0:1;try{return JSON.parse(i(e.split(".")[t]))}catch(e){throw new n("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=n},X6r5:function(e,s,t){"use strict";var i=t("D57K"),n=(t("smDF"),t("dV61"),t("Ybms"),t("nsO7")),o=t("Sa5G"),a=t("jhBu"),r=t("8W6D"),c=t("pjml"),l=t("0JpG"),d=t("TnpK"),u=t("gkef"),h=t("5KgE"),p=t("p7NW"),m=t("g66W"),b=t("zGdY"),g=t("aHpC"),v=t("UsDD"),S=t("GGpz"),f=t("ZQFV"),C=t("yC9S"),w=t("2tKw");t.d(s,"a",(function(){return D}));const D="ultra.components.directives.rubric.rubricList";let y=class{constructor(e,s,t,i,n,o,a,r,c,l){this.element=e,this.$rootScope=s,this.$scope=t,this.CourseModel=i,this.bbLocalize=n,this.ultraState=o,this.windowSize=a,this.entitlements=r,this.firstTimeHelper=c,this._rubricService=l,this.enableRubricAssociation=!1,this.editable=!1,this.hasViewAccess=!1,this.showCompleteDescription=!1,this.rubricIdList=[],this.contextArea="rubrics",this.shouldShowNewBadge=!1,t.rubricList=this}$onInit(){const e={sort:"title(asc)",limit:1e3,expand:"columnHeaders,rows"};this.CourseModel.$new(this.course.id).rubrics.$fetch(e).$allow(["403"]).$asPromise().then(e=>this.handleRubricResponse(e)),this.destroyRubricSaveListener=this.$rootScope.$on("rubric-save",(s,t)=>{this.course.rubrics.$refresh(e).$allow(["403"]).$asPromise().then(e=>this.handleRubricResponse(e))}),this.entitlements.hasCourseEntitlement(o.k.ViewRubrics,this.course.id).then(e=>{this.hasViewAccess=e}),this.setShouldShowBadge()}handleRubricResponse(e){403!==e.$response.status&&(this.rubrics=e)}$onDestroy(){if(this.destroyRubricSaveListener(),this.shouldShowNewBadge){const e=Object(m.a)("NEW_BADGE_COMPONENT_KEY",h.a);this.firstTimeHelper.hide(e)}}getOverflowMenuItems(e){return[{icon:"duplicate",labelKey:"components.directives.rubric.list.tooltip.duplicate",show:()=>e.permissions&&e.permissions.edit&&!this.windowSize.isSmallBreakpoint(),onClick:this.copyRubric.bind(this,e),ariaLabel:()=>this.bbLocalize.translateSync({locale:this.course.getLocale()||this.bbLocalize.getAppLocale(),key:"components.directives.rubric.list.copyRubric",params:{title:e.title},noWrap:!0})}]}getDeleteMenuOption(e){const s=(e.readOnly||e.associated)&&e.canDelete(),t=s?"components.directives.rubric.list.deleteInUseRubric.title":"components.directives.rubric.list.deleteRubric.title",i=s?"components.directives.rubric.list.deleteInUseRubric.instructions":"components.directives.rubric.list.deleteRubric.instructions",n=s?"components.directives.rubric.list.deleteInUseRubric.label":"components.directives.rubric.list.deleteRubric.label";return{show:()=>e.canDelete(),onClick:this.deleteRubric.bind(this,e,s),confirmationOptions:{titleKey:t,instructionsKey:i},ariaLabel:()=>this.bbLocalize.translateSync({locale:this.course.getLocale()||this.bbLocalize.getAppLocale(),key:n,params:{title:e.title},noWrap:!0})}}setShouldShowBadge(){const e=this.element.closest(".bb-offcanvas-panel").attr("data-base-state-name"),s=Object(m.a)("NEW_BADGE_COMPONENT_KEY",h.a);this.firstTimeHelper.shouldShow(s,e,!1).then(e=>{this.shouldShowNewBadge=e})}pointsCheckboxTrigger(e,s){s?this.rubricIdList.push(e):this.rubricIdList.splice(this.rubricIdList.indexOf(e),1)}associateRubric(e){if(this.rubricAssociationHandler&&this.rubricIdList.includes(e.id)){const s=this.getPointsRubricMaxScore(e),t=Math.min(f.Utils.GRADE_MAX_POINTS,s);this.rubricAssociationHandler({rubric:e,maxPoints:t})}else this.rubricAssociationHandler&&this.rubricAssociationHandler({rubric:e})}toggleDescription(){this.showCompleteDescription=!this.showCompleteDescription}getPointsRubricMaxScore(e){if(null==e.rows||this._rubricService.isPercentageOrPercentageRangeRubric(e))return 0;const s=e.rubricType===b.RubricType.POINTS?b.RubricType.POINTS:b.RubricType.POINTS_RANGE;e.rows.forEach((e,t)=>{this.setMaxRowPoints(e,s)});const t=e.rows.filter(e=>n.isFinite(e.rowPoints)).reduce((e,s)=>e+s.rowPoints,0);return parseFloat(f.Utils.parseGradeValue(t))}setMaxRowPoints(e,s){if(n.isFinite(e.rowPoints)||null==e.cells)return;let t=0;e.cells.forEach(e=>{const i=s===b.RubricType.POINTS?e.numericPoints:e.endPointRange;void 0!==i&&!Number.isNaN(i)&&i>t&&(t=i)}),e.rowPoints=t}copyRubric(e){this.ultraState.goPeekState("rubric.mode",{rubricId:e.id,mode:r.a.COPY.toString()})}deleteRubric(e,s){s?e.withParams({cascade:!0}).$destroy():e.$destroy()}};y=Object(i.__decorate)([Object(C.a)({moduleName:D,componentName:"bbRubricList",template:w,bindings:{course:"<",enableRubricAssociation:"<?",rubricAssociationHandler:"&?",editable:"<?"},requireModules:[d.b,u.a,v.a,S.a,p.f]}),Object(i.__param)(0,Object(g.b)("$element")),Object(i.__param)(1,Object(g.b)("$rootScope")),Object(i.__param)(2,Object(g.b)("$scope")),Object(i.__param)(3,Object(g.b)(c.m.serviceName)),Object(i.__param)(4,Object(g.b)(l.serviceName)),Object(i.__param)(5,Object(g.b)(d.d)),Object(i.__param)(6,Object(g.b)(u.b)),Object(i.__param)(7,Object(g.b)(a.b)),Object(i.__param)(8,Object(g.b)(h.c)),Object(i.__param)(9,Object(g.b)(p.g))],y)},X8JP:function(e,s,t){"use strict";t.d(s,"a",(function(){return o})),t.d(s,"b",(function(){return a}));var i=t("Vsv2"),n=t("pjml");const o="ultraUi.components.services.cloudDrive.rteCloudStorageIntegrationModal",a="RteCloudStorageIntegrationService",r=e=>e.account+"|"+e.id;class c{constructor(e,s,t){this.$q=e,this.cloudDriveService=s,this.CloudDriveModel=t}initialize(){return this.cloudDriveService.isCloudServiceAvailable().then(e=>this.isCloudServiceAvailable=e)}openFilePicker(e){return this.cloudDriveService.cloudDriveStorage.openFilePicker(e,!0).then(e=>{if(e){const s=[];return e.forEach(t=>{const i=r(t),n=this.CloudDriveModel.$new("CloudStorageIntegration").contents.$new(i).$fetch({accessToken:e[0].bearer_token.key}).$asPromise();s.push(n)}),this.$q.all(s).then(s=>s.map(s=>({id:s.id,cloudStorageIntegrationAccessToken:e[0].bearer_token.key,name:s.name,size:s.size,type:s.type,updatedTime:s.updatedTime,webLocation:s.webLocation})))}return this.$q.reject()})}getModalCallback(e){return()=>this.cloudDriveService.cloudDriveStorage?this.openFilePicker(e):this.cloudDriveService.initializeCloudDrive().then(()=>this.openFilePicker(e))}}c.$inject=["$q",i.b,n.h.serviceName],angular.module(o,[i.a]).service(a,c)},XlSz:function(e,s,t){"use strict";(function(e){t.d(s,"e",(function(){return f})),t.d(s,"d",(function(){return C})),t.d(s,"c",(function(){return w})),t.d(s,"b",(function(){return D})),t.d(s,"a",(function(){return y}));var i=t("D57K"),n=t("nsO7"),o=t("GbAM"),a=t("x8kk"),r=t("zGdY"),c=t("PSJS"),l=t("nYZ0"),d=t("Qbdf"),u=t("0JpG"),h=t("lEL+"),p=t("TnpK"),m=t("g7Mf"),b=t("fYJU"),g=t("aHpC"),v=t("yC9S"),S=t("+4Px");const f="ultra.directive.discussion.controller",C="show-override-bar",w="reply-discussion-event",D="remove-all-attempt-event";let y=class{constructor(s,t,i,o,l,d,u,h,p,m,b){this.$scope=s,this.$rootScope=t,this.$q=i,this.$ngRedux=o,this.ultraState=l,this.contextCourse=d,this.ContentService=u,this.bbLocalize=h,this.timeout=p,this.discussionService=m,this.contextUser=b,this.participantTopCount=5,this.isDraftOnly=!1,this.isFromCourseOutline=!1,this.isFromDiscussion=!1,this.isFromStream=!1,this.currentCommentsNum=10,this.currentReplyStatus={},this.totalCommentCount=-1,this.showCommentCount=0,this.participantByDate=new Date,this.infiniteContainerObj={panelContentContainer:".discussion-container .panel-content",panelWrapContainer:".discussion-container .panel-wrap"},this.groupDiscussionParams={},this.userCourseAvailabilities={},this.setRubricGradeDetail=e=>{this.discussionService.resolveColumn().then(s=>{this.showGradeOverrideBar=!!(s&&s.hasRubricAssociation()&&e&&e.isGraded()&&e.isOverrideGrade()),this.$scope.$emit(C,this.showGradeOverrideBar)})},s.discussionController=this,this.loginUser=this.contextUser.userModel,this.courseId=d.courseId?d.courseId:l.params.courseId,this.isFromCourseOutline=l.includes("**.course.outline.**"),this.isFromDiscussion=l.includes("**.engagement.**"),this.isFromStream=l.includes("**.recentActivity.**"),this.isCurrentDiscussionEditing=!1,this.isCourseComplete=!0,this.isCoursePrivate=!0,this.previousState=l.prev.name,this.infiniteContainer=this.infiniteContainerObj.panelWrapContainer,this.userCourseAvailabilities=m.userCourseAvailabilities,this.$scope.$on("ContentTitleUpdate",(e,s)=>{this.discussionService.currentDiscussion&&this.discussionService.currentDiscussion.subject!==s&&(this.discussionService.currentDiscussion.subject=s,this.saveSubject())}),this.$scope.$on("discussion-participant-click",(e,s,t=!1)=>{this.clickParticipant(s,t)}),this.$scope.$on("load-participants",(e,s,t)=>{this.course=s||this.course,this.currentForumId=t||this.currentForumId,this.course&&this.currentForumId&&(this._loadParticipants(),this._loadAuthor(),this.searchParam&&this.searchParam.searchParticipantValue&&this.searchParam.searchParticipantValue.length>=1&&this.discussionService.queryParticipants(this.currentForumId,this.participants.paging.count,this.searchParam.searchParticipantValue).then(e=>{this.searchParam.searchParticipants=e}))}),this.$scope.$on("refresh-discussion-page",(e,s,t,i,n)=>{n||this.discussionService.hardLinkContent;this.course=s,this.currentForumId=t,i&&(this.discussionService.groupId=i),this.refreshPage()}),this.$scope.$on("cancel-participant-filter",()=>{this.cancelParticipantFilter()});const g=()=>{"auto"===e(this.infiniteContainerObj.panelContentContainer).css("overflow-y")?this.infiniteContainer=this.infiniteContainerObj.panelContentContainer:this.infiniteContainer=this.infiniteContainerObj.panelWrapContainer};g(),v.b.OnWindow("resize",g,s),s.$on("discussion-group-content-update",(e,s)=>{m.hardLinkContent.applyGroupSettings(s),m.softLinkContent&&m.softLinkContent.id&&m.softLinkContent.applyGroupSettings(m.hardLinkContent)}),s.$on(a.a,(e,s,t,i=!1)=>{var o,a;const c=Object(n.find)(this.participants,e=>e.data.id===this.loginUser.id);c&&(i?c.draftCount+=1:s?c.topLevelReplyCount+=1:c.secondLevelReplyCount+=1),(null===(o=this.author)||void 0===o?void 0:o.data.id)===this.loginUser.id&&(i?this.author.draftCount+=1:s?this.author.topLevelReplyCount+=1:this.author.secondLevelReplyCount+=1),this.loginUser.canCreate()||this.$scope.$broadcast(w),this.discussionService.softLinkContent&&(null===(a=this.discussionService.softLinkContent.permissions)||void 0===a?void 0:a.canHaveReviewState)&&this.discussionService.softLinkContent.inSequence&&this.discussionService.softLinkContent.updateState(r.ContentReviewState.Completed),this.discussionService.currentDiscussion.gradedColumn&&this.$scope.$root.$broadcast("bb-assessment-attempt-save",null,this.discussionService.currentDiscussion.gradedColumn.id,this.discussionService.isGroupDiscussion())});const S=(e,s)=>{var t;const i=Object(n.find)(this.participants,s=>s.data.id===e.user.id);if(i){c.MessageLifeCycleEnum.Drafted.isEqualTo(e.lifecycle)?i.draftCount-=1:s?i.topLevelReplyCount-=1:i.secondLevelReplyCount-=1,i.data.canCreate()||0!==i.topLevelReplyCount||0!==i.secondLevelReplyCount||this.$scope.$broadcast(D)}if((null===(t=this.author)||void 0===t?void 0:t.data.id)===e.user.id){c.MessageLifeCycleEnum.Drafted.isEqualTo(e.lifecycle)?this.author.draftCount-=1:s?this.author.topLevelReplyCount-=1:this.author.secondLevelReplyCount-=1,this.author.data.canCreate()||0!==this.author.topLevelReplyCount||0!==this.author.secondLevelReplyCount||this.$scope.$broadcast(D)}e.replies&&e.replies.forEach(e=>S(e,!1))};s.$on(a.b,(e,s,t,i)=>{S(i,s)}),s.$on(a.e,(e,s,t,i,o,a=!1)=>{var r;if(!o){if(a){const e=Object(n.find)(this.participants,e=>e.data.id===i.user.id);e&&(e.draftCount-=1,s?e.topLevelReplyCount+=1:e.secondLevelReplyCount+=1),(null===(r=this.author)||void 0===r?void 0:r.data.id)===i.user.id&&(this.author.draftCount-=1,s?this.author.topLevelReplyCount+=1:this.author.secondLevelReplyCount+=1)}return}const c=Object(n.find)(this.participants,e=>e.data.id===i.user.id);c&&(s?c.topLevelReplyCount-=1:c.secondLevelReplyCount-=1),this.author.data.id===i.user.id&&(s?this.author.topLevelReplyCount-=1:this.author.secondLevelReplyCount-=1)})}saveSubject(){this.discussionService.currentDiscussion&&!this.ContentService.isEmpty(this.discussionService.currentDiscussion.subject)&&(this.groupDiscussionParams=this.discussionService.hardLinkContent&&this.discussionService.hardLinkContent.isGroupContent?{groupId:this.discussionService.groupId}:{},c.MessageLifeCycleEnum.Deleted.isEqualTo(this.discussionService.currentDiscussion.lifecycle)||this.discussionService.currentDiscussion.withParams(this.groupDiscussionParams).$save(["subject"]))}createIntersectionObserverRootOptions(){return{root:e("div[intersection-observer-root-flag]").get(0),rootMargin:"60px 60px 60px 60px"}}refreshPage(){this.$scope.$broadcast("refresh-discussion-panel"),this.$scope.$broadcast("load-participants")}deletePost(){if(this.deleteEmptyForum()){const e=this.isFromDiscussion||this.isFromCourseOutline;return this.discussionService.softLinkContent&&this.discussionService.softLinkContent.id&&this.$rootScope.$broadcast("deleteContent",this.discussionService.softLinkContent,e),this.discussionService.currentDiscussion.gradedColumn&&this.discussionService.currentDiscussion.gradedColumn.id&&this.$rootScope.$broadcast("bb-delete-column",this.discussionService.currentDiscussion.gradedColumn),this.$rootScope.$broadcast("deleteContent",this.discussionService.hardLinkContent,e),this.isFromStream?this.ultraState.goCurrentBasePage():this.isFromCourseOutline?this.ultraState.go("base.courses.peek.course.outline"):this.ultraState.go(this.previousState),this.$q.when(null)}return this.discussionService.currentDiscussion.withParams({cascade:!1,groupId:this.discussionService.groupId}).$destroy().$then(()=>{this.discussionService.hardLinkContent&&(this.discussionService.hardLinkContent.description=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.content.initial.post.is.deleted"})),this.discussionService.softLinkContent&&(this.discussionService.softLinkContent.description=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.content.initial.post.is.deleted"})),this._softDeleteHandler(this.discussionService.currentDiscussion,!0)}).$asPromise()}cancelFilter(){this.selectedParticipant&&(this.$scope.$broadcast("cancel-participant"),this.selectedParticipant.ui.isClicked=!1,this.selectedParticipant=null,this.isDraftOnly=!1,this.filteredComments=null)}clickParticipant(e,s=!1){const t=this.isDraftOnly!==s;!this.selectedParticipant||e.data.id!==this.selectedParticipant.data.id||t?(this.clickParticipantScrollToElement=".discussion-comments",this.selectedParticipant&&(this.selectedParticipant.ui.isClicked=!1),e.ui.isClicked=!0,this.selectedParticipant=e,this.isDraftOnly=s,this.formatParticipantUserName(e),this.$scope.$broadcast("click-participant",e,s),this.$scope.$emit("discussion-participant-click-to-view",e)):this.cancelParticipantFilter()}clickParticipantDraftLink(e,s){this.clickParticipant(e,!0),s.stopPropagation()}clickParticipantKeyboard(e,s){return this.$scope.$broadcast("clickParticipantKeyboard",e)}participantKeyboardEvent(e,s){(s.which||s.keyCode)!==S.t||this.hasNoParticipation(e)||this.clickParticipant(e),s.stopPropagation()}getParticipantDataSource(){let e;if(this.searchParam&&this.searchParam.searchParticipantValue&&this.searchParam.searchParticipantValue.length>=1?e=this.searchParam.searchParticipants:(this.searchParam&&(this.searchParam.searchParticipants=null),e=this.participants),!Object(n.get)(e,"[0].userId"))return e;const s=e.map(e=>e.userId);return this.contextCourse.usersCache.hit(s)?e:void 0}formatParticipantUserName(e){this.bbLocalize.formatUsername(e.data,u.ILocaleUsernameFormat.Short,this.$scope,{noWrap:!0,noEscape:!0}).then(e=>{this.selectedParticipantFormatedUserName=e})}setFocusLabel(){this.$scope.$broadcast("setFocusLabel",{})}cancelParticipantFilter(){this.selectedParticipant&&this.$scope.$emit("cancel-participant-to-view"),this.cancelFilter()}_loadParticipants(){!this.discussionService.hasNoGroups()||this.discussionService.isOpenFromConversation()?this.discussionService.queryParticipants(this.currentForumId,this.participantTopCount).then(e=>{if(this.participants=e,this.selectedParticipant){let e=!1;if(this.participants.forEach(s=>{s.data.id===this.selectedParticipant.data.id&&(s.ui.isClicked=!0,this.selectedParticipant=s,e=!0)}),e){this.selectedParticipant.topLevelReplyCount+this.selectedParticipant.secondLevelReplyCount===0&&this.cancelParticipantFilter()}else this.cancelFilter()}}):this.participants=null}async _loadAuthor(){if(this.author=null,!this.discussionService.currentDiscussion.userId)return;const e=await this.discussionService.queryParticipant(this.currentForumId,this.discussionService.currentDiscussion.userId);if(this.author=e,this.selectedParticipant){let e=!1;if(this.author.data.id===this.selectedParticipant.data.id&&(this.author.ui.isClicked=!0,this.selectedParticipant=this.author,e=!0),e){this.selectedParticipant.topLevelReplyCount+this.selectedParticipant.secondLevelReplyCount===0&&this.cancelParticipantFilter()}else this.cancelFilter()}}shouldDisplayAuthorInfo(){return null!=this.author}showMoreParticipants(){this.participantTopCount+=100,this.discussionService.queryParticipants(this.currentForumId,this.participantTopCount,void 0,!0).then(e=>{this.selectedParticipant&&e&&e.forEach(e=>{this.selectedParticipant.data.id===e.data.id&&(this.selectedParticipant=e,e.ui.isClicked=!0)}),this.participants=e})}searchParticipants(){if(this.searchParam&&this.searchParam.searchParticipantValue&&this.searchParam.searchParticipantValue.length>=1){const e=this.searchParam.searchParticipantValue;this.timeout.cancel(this.searchParam.delayedSearch),this.searchParam.delayedSearch=this.timeout(()=>{e===this.searchParam.searchParticipantValue&&(this.searchParam.isSearchListShown=!0,this.searchParam.searchParticipants=null,this.searchParam.recentSearchValue=e,this.discussionService.queryParticipants(this.currentForumId,this.participants.paging.count,e).then(e=>{this.searchParam.searchParticipants=e,this.setSearchResultsAlert(this.searchParam.searchParticipants.length>0)}),this.cancelParticipantFilter())},this.$scope,1e3)}else this.searchParam&&(this.searchParam.recentSearchValue="",this.searchParam.isSearchListShown=!1,this.searchParam.searchParticipants=null,this.cancelParticipantFilter())}setSearchResultsAlert(e){const s=e?"course.engagement.edit.searchParticipantsResultsFound":"course.engagement.edit.searchParticipantsNoResult",t=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:s,noWrap:!0,noEscape:!0});this.$rootScope.$broadcast(o.a,t)}_softDeleteHandler(e,s){e.$fetch().$then(e=>{if(c.MessageLifeCycleEnum.Deleted.isEqualTo(e.lifecycle)){const t=s?"course.engagement.edit.commentDeleted":"course.engagement.edit.replyDeleted";e.lastUpdateUser=this.getAnonymousUpdateUser(e),this.bbLocalize.formatUsername(e.lastUpdateUser,u.ILocaleUsernameFormat.Short,this.$scope,{noWrap:!0,noEscape:!0}).then(s=>{e.body.rawText=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:t,params:{localizedUserName:s}})})}})}getAnonymousUpdateUser(e){return e.lastUpdateUserId===this.loginUser.id?this.loginUser:e.user}cancelPostEditing(){this.discussionService.currentDiscussion.ui=this.discussionService.currentDiscussion.ui||{},this.isCurrentDiscussionEditing=!1}savePost(){this.discussionService.savePost()}deleteEmptyForum(){const e=this.discussionService.softLinkContent&&this.discussionService.softLinkContent.permissions?this.discussionService.softLinkContent.canDelete():this.discussionService.hardLinkContent&&this.discussionService.hardLinkContent.canDelete();this.totalCommentCount=this.discussionService.currentDiscussion.ui.count;const s=this.discussionService.isGroupDiscussion()?this.totalCommentAndReplyCountOfAllGroups>0:this.totalCommentCount>0;return e&&!s}canSeeParticipantCounts(){return!this.discussionService.currentDiscussion.postFirst||this.discussionService.currentDiscussion.postFirst&&!!this.discussionService.currentDiscussion.replies.find(e=>!c.MessageLifeCycleEnum.Drafted.isEqualTo(e.lifecycle))||this.isDraftOnly}hasNoParticipation(e){return e.topLevelReplyCount+e.secondLevelReplyCount+(e.draftCount||0)===0}isLoginUser(e){return this.loginUser.id===e.data.id}isParticipantTheAuthor(e){return this.discussionService.currentDiscussion.userId===e.data.id}isAvailable(e){return this.userCourseAvailabilities[e.id]}get participantListInitialLength(){return 5}isNonClassConversationGroup(){return this.participants.paging&&this.discussionService.hardLinkContent.isGroupContent&&"default"!==this.discussionService.selectedGroup.groupId}isClassConversationGroup(){return this.discussionService.hardLinkContent.isGroupContent&&this.participants.paging&&"default"===this.discussionService.selectedGroup.groupId}hasMultipleParticipants(){return this.participants.length>1}isSelfEnrollmentGroupSelected(){return this.discussionService.hardLinkContent.selfEnrollmentGroups.findIndex(e=>e.groupId===this.discussionService.selectedGroup.groupId)>-1}isGroupContent(){return this.discussionService.hardLinkContent.isGroupContent}};y=Object(i.__decorate)([Object(i.__param)(0,Object(g.b)("$scope")),Object(i.__param)(1,Object(g.b)("$rootScope")),Object(i.__param)(2,Object(g.b)("$q")),Object(i.__param)(3,Object(g.b)("$ngRedux")),Object(i.__param)(4,Object(g.b)(p.d)),Object(i.__param)(5,Object(g.b)(d.e)),Object(i.__param)(6,Object(g.b)(l.f)),Object(i.__param)(7,Object(g.b)(u.serviceName)),Object(i.__param)(8,Object(g.b)(h.b)),Object(i.__param)(9,Object(g.b)(m.c)),Object(i.__param)(10,Object(g.b)(b.b))],y);class k extends y{}}).call(this,t("5iHu"))},Ybms:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-small-duplicate",use:"icon-small-duplicate-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-duplicate"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M1 4h11v11H1z" /><path d="M12 12h3V1H4v3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},aTRN:function(e,s,t){"use strict";var i=t("D57K"),n=t("pjml"),o=t("aHpC"),a=t("4GL6"),r=t("0JpG"),c=t("oi1r"),l=t("TnpK"),d=t("Qbdf"),u=t("X455"),h=t("zGdY"),p=t("JfV0"),m=t("nsO7");const b="performance",g="date";let v=class{constructor(e,s,t,i,n,o,a){this.localizeService=e,this.schemaService=s,this.courseModel=t,this.contextCourse=i,this.contextCourseMembership=n,this.scope=a,this.isPerformanceConditionInvalid=!1,this.role=Object(m.memoize)(()=>this.contextCourseMembership.courseMembership&&this.contextCourseMembership.courseMembership.isActAsInstructorMembership()?"instructor":"student"),this.courseId=i.courseId?i.courseId:o.params.courseId}getConditions(e,s,t){var i,n;this.content=e;const o=null===(i=e.adaptiveReleaseRules)||void 0===i?void 0:i.rules;if((null==o?void 0:o.length)||e.isForcedSequenceModule())if((null===(n=null==o?void 0:o[0])||void 0===n?void 0:n.criteria)&&(this.allCriteria=o[0].criteria),this.getACLCriteria()?this.setACLCondition():this.aclToolTips=null,this.getPerformanceCriteria()?this.setPerformanceCondition(s,t):this.performanceToolTips=null,this.getDateCriteria()?this.setDateCondition():this.dateToolTips=null,!this.contextCourseMembership.courseMembership.isActAsInstructorMembership()&&e.isForcedSequenceItem()){const s=0===e.position?"components.directives.content-item-base.conditionalRelease.student-forced-sequence-first-item-tooltip":"components.directives.content-item-base.conditionalRelease.student-forced-sequence-item-tooltip";this.forcedSequenceTips=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:s,noWrap:!0,noEscape:!0}),this.updateTooltipScope()}else this.forcedSequenceTips=null}getConditionDescription(){const e=!!this.getACLCriteria(),s=!!this.getPerformanceCriteria(),t=!!this.getDateCriteria(),i=[[e,this.contextCourse.course.isOrganization?"organization-membership":"course-membership"],[t,g],[s,b]].filter(e=>!!e[0]).map(e=>`components.directives.content-item-base.conditionalRelease.conditionDescriptions.${e[1]}`);if(0===i.length)return;const n=this.localizeService.getLocale(this.scope),o=i.map((e,s)=>this.localizeService.translateSync({locale:n,key:`${e}${0===s?"-capitalized":""}`}));return this.localizeService.formatItemsSync(o,o.length,null,this.scope,!1,{noWrap:!0})}getPerformanceCriteria(){return this.getCriteriaByType(p.AdaptiveReleaseCriteriaType.Grade.toString())||this.getCriteriaByType(p.AdaptiveReleaseCriteriaType.GradePercentage.toString())}getDateCriteria(){return this.getCriteriaByType(p.AdaptiveReleaseCriteriaType.Date.toString())}getACLCriteria(){return this.getCriteriaByType(p.AdaptiveReleaseCriteriaType.ACL.toString())}getCriteriaByType(e){return this.allCriteria&&this.allCriteria.find(s=>s.type===e)}setPerformanceCondition(e,s){this.gradeCriteria=this.getPerformanceCriteria();let t=this.gradeCriteria&&this.gradeCriteria.minScore;const i=this.gradeCriteria&&this.gradeCriteria.maxScore,n=this.gradeCriteria&&this.gradeCriteria.gradeColumnId;let o="",a="";if(!n||s){const e=`components.directives.content-item-base.conditionalRelease.${this.role()}-missing-column-error`;return this.performanceToolTips=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:e,noWrap:!0,noEscape:!0}),this.isPerformanceConditionInvalid=!0,void this.updateTooltipScope()}this.courseModel.$new(this.courseId||this.content.courseId).gradebook.columns.$find(n).$allow([403]).$then(s=>{if(s.$response&&403===s.$response.status)return this.performanceToolTips=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:"components.directives.content-item-base.conditionalRelease.student-missing-column-error",noWrap:!0,noEscape:!0}),this.isPerformanceConditionInvalid=!0,void this.updateTooltipScope();let n=`components.directives.content-item-base.conditionalRelease.${this.role()}-lock-tooltip`;n+=void 0===i?"-common":t===i?"-equal":"-custom";const r=e||s&&s.columnName;this.schemaService.loadSchemas(this.courseId).then(e=>{const c=e&&e.find(e=>e.id===s.gradingSchemaId)||{};this.gradeCriteria&&"Grade_Range"===this.gradeCriteria.type&&(void 0===i&&c.scaleType!==h.SchemaScaleType.Score&&c.scaleType!==h.SchemaScaleType.Complete||(o=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),params:{score:t||0},key:"components.directives.content-item-base.conditionalRelease.point.plural",noWrap:!0,noEscape:!0}),a=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),params:{score:i||s.possible},key:"components.directives.content-item-base.conditionalRelease.point.plural",noWrap:!0,noEscape:!0}))),this.gradeCriteria&&"Grade_Range_Percentage"===this.gradeCriteria.type&&(void 0!==i||c.scaleType===h.SchemaScaleType.Percent?(o=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),params:{score:t||0},key:"components.directives.content-item-base.conditionalRelease.percentage",noWrap:!0,noEscape:!0}),a=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),params:{score:i||s.possible},key:"components.directives.content-item-base.conditionalRelease.percentage",noWrap:!0,noEscape:!0})):c.scaleType===h.SchemaScaleType.Tabular&&(c.symbols.sort((e,s)=>e.absoluteTranslation-s.absoluteTranslation),c.symbols.forEach(e=>{e.absoluteTranslation>=t&&(t=e.symbol,o=t)}))),this.getPerformanceToolTips(n,o,a,r)})})}setDateCondition(){if(this.dateCriteria=this.getDateCriteria(),this.dateCriteria){let e=null;this.dateCriteria.start&&this.dateCriteria.end?e="both":this.dateCriteria.start?e="showon":this.dateCriteria.end&&(e="hideafter");const s=`components.directives.content-item-base.conditionalRelease.${this.role()}-${e}-date-tooltip`;this.dateToolTips=e&&this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:s,params:{showon:new Date(this.dateCriteria.start),hideafter:new Date(this.dateCriteria.end)},noWrap:!0,noEscape:!0}),this.updateTooltipScope()}}setACLCondition(){this.aclCriteria=this.getACLCriteria(),this.aclCriteria&&(this.aclToolTips=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:"components.directives.content-item-base.conditionalRelease.acl-tooltip",noWrap:!0,noEscape:!0}),this.updateTooltipScope())}getPerformanceToolTips(e,s,t,i,n=""){this.performanceToolTips=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:e,params:{minScore:s,maxScore:t,title:i},noWrap:!0,noEscape:!0}),this.isPerformanceConditionInvalid=!1,this.updateTooltipScope()}updateTooltipScope(){angular.isUndefined(this.tooltipScope)&&(this.tooltipScope=this.scope.$new(!0)),this.tooltipScope.items=[],this.aclToolTips&&this.tooltipScope.items.push(this.aclToolTips),this.performanceToolTips&&(this.tooltipScope.items.push(this.performanceToolTips),this.isPerformanceConditionInvalid)?this.tooltips=this.performanceToolTips:(this.dateToolTips&&this.tooltipScope.items.push(this.dateToolTips),this.forcedSequenceTips&&this.tooltipScope.items.push(this.forcedSequenceTips),this.tooltips=this.tooltipScope.items.join(" "))}getConditionalReleaseComplexTooltipTemplate(){return a.a("conditional-release-tooltip")}};v=Object(i.__decorate)([Object(i.__param)(0,Object(o.b)(r.serviceName)),Object(i.__param)(1,Object(o.b)(c.b)),Object(i.__param)(2,Object(o.b)(n.m.serviceName)),Object(i.__param)(3,Object(o.b)(d.e)),Object(i.__param)(4,Object(o.b)(u.d)),Object(i.__param)(5,Object(o.b)(l.d)),Object(i.__param)(6,Object(o.b)("scope"))],v),s.a=v},aY38:function(e,s,t){var i=t("Jygx");e.exports=function(e){var s=e.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(i(e).replace(/(.)/g,(function(e,s){var t=s.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t})))}(s)}catch(e){return i(s)}}},ap1t:function(e,s,t){"use strict";var i=t("D57K"),n=t("Llzl"),o=t("en1n"),a=t("0JpG"),r=t("Fvsw"),c=t("X/qj"),l=t("yMoE"),d=t("pjml"),u=t("TnpK"),h=t("g66W"),p=t("fYJU"),m=t("ooAF"),b=t("nmzr"),g=t("zGdY"),v=t("aHpC");t.d(s,"c",(function(){return S})),t.d(s,"b",(function(){return f})),t.d(s,"a",(function(){return C}));const S="ultra.components.directives.grade.displayGradePill",f="--",C="na";let w=class{constructor(e,s,t,i,n,a,r,c,d){this.$injector=e,this.$sce=s,this.scope=t,this.element=i,this.bbLocalize=n,this.context=a,this.ultraState=r,this.gradebookPermissionService=c,this.contextUser=d,this.colorCss="";const u=this.scope.column()&&this.scope.column().courseId;this.bundlePromise=n.loadBundle("components/directives/grade/display-grade"),this.canViewGradebook=this.hasViewGradebook(u),this.isStudent=d.userModel.isStudent(),this.canViewGrades=this.hasViewGrades(u),this.canViewGrades?(this.scope.$watch("::column()",e=>{if(e){this.scope.$watchGroup(["attempt()","grade()"],()=>{const e=this.scope.attempt&&this.scope.attempt(),s=this.scope.grade&&this.scope.grade(),t=this.gradeDisplayItem=this.$injector.instantiate(l.a,{gradeDetail:s,scope:this.scope});t.init(this.scope.column()).then(()=>{let i;this.schema=t.schema,this.schema&&(this.scaleType=t.schema.scaleType),e?i=e.displayGrade:s&&this.schema&&(i=s.displayGrade),t.displayGrade=i,this.setFullDisplayValue()})})}}),this.scope.$watch(()=>o.g(),()=>{this.displayValue&&this.setFullDisplayValue()})):(this.displayValue=f,this.colorCss=C)}hasViewGradebook(e){return this.gradebookPermissionService.canView(e)}hasViewGrades(e){return this.isStudent||this.gradebookPermissionService.canViewGrades(e)}shouldShowPendingForGrade(){const e=this.scope.grade;return e&&e()&&!e().isPosted()&&e().hasAttempts()}shouldShowPendingForAttempt(){const e=this.scope.attempt;return e&&e()&&e().isNeedsGrading()}shouldRenderInlineRubric(){const e=this.scope.grade;return this.rubricEvaluationIsComplete()||this.shouldShowPendingForGrade()||this.shouldShowPendingForAttempt()||e().isPastDueZero()}setNoSubmitView(){this.schema&&this.scaleType&&(this.scaleType===g.SchemaScaleType.Percent?this.displayValue=f+" %":this.scaleType===g.SchemaScaleType.Score?this.bundlePromise.then(()=>{this.displayValue=f+this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.grade.display-grade.total",params:{total:this.scope.grade&&this.scope.grade()&&this.scope.grade().pointsPossible||this.scope.column().possible},noWrap:!0})}):this.displayValue=f)}setFullDisplayValue(){this.displayValue=this.gradeDisplayItem&&this.gradeDisplayItem.displayValue,this.gradeDisplayItem.displayValue?(this.shouldShowPossiblePoints()?this.bundlePromise.then(()=>{this.displayValue=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.grade.display-grade.score",params:{grade:this.gradeDisplayItem.displayValue,possible:this.scope.grade&&this.scope.grade().pointsPossible||this.scope.column().possible},noWrap:!0,noEscape:!0})}):this.displayValue=this.gradeDisplayItem.displayValue,this.colorCss=this.gradeDisplayItem.getGradeColor()):this.isStudent&&(this.shouldShowPendingForGrade()||this.shouldShowPendingForAttempt())?(this.colorCss=`${C} pending`,this.bundlePromise.then(()=>{this.displayValue=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.grade.display-grade.pending-grade",noWrap:!0})})):(this.colorCss=this.isStudent?`${C} no-attempt`:"",this.setNoSubmitView())}get cursorClass(){return this.scope.cursor?`cursor-${this.scope.cursor}`:""}shouldShowPossiblePoints(){return!this.isSmallBP()&&this.gradeDisplayItem&&this.gradeDisplayItem.shouldShowTotalPoints()}isSmallBP(){return o.a.Small.isEqualTo(o.f())}shouldShowRubricButton(){var e,s,t;return!(this.scope.hideRubricIcon||!this.scope.column()||!this.scope.column().hasRubricAssociation())&&(!(!this.scope.column().isDiscussion()&&!this.scope.column().isJournal())||(null!=this.scope.attempt||!(!this.scope.column().isSingleAttempt()||g.AttemptStatus.InProgress===(null===(t=null===(s=null===(e=this.scope.grade())||void 0===e?void 0:e.ui)||void 0===s?void 0:s.attempt)||void 0===t?void 0:t.status))))}rubricEvaluationIsComplete(){const e=this.scope.column();if(e&&e.hasRubricAssociation()){const s=this.scope.attempt?this.scope.attempt():this.scope.grade().ui.attempt;return e.getRubricAssociation().isWithEvaluations&&(s&&s.isCompleted()||e.isDiscussion()||e.isJournal())}return!1}openRubricEvaluation(e){if(this.scope.disableRubricEvalClick&&this.scope.disableRubricEvalClick())return;e.stopPropagation();const s=this.getRubricStateRef();this.ultraState.current.name.endsWith("peek.assessment-submission-feedback")&&this.ultraState.leavePeekState(this.ultraState.current.name),this.ultraState.goPeekState(s.state,s.args)}getRubricStateRef(){let e,s;(this.scope.grade||this.scope.attempt)&&(e=this.scope.attempt?this.scope.attempt().id:null,this.scope.grade&&this.scope.grade().ui&&this.scope.grade().ui.attempt&&this.scope.grade().ui.attempt.id&&(e=this.scope.grade().ui.attempt.id||this.scope.grade().ui.attempt.groupAttemptId),s=this.scope.attempt?this.scope.attempt().groupId:null,this.scope.grade&&this.scope.grade().ui.groupAttempt&&(s=this.scope.grade().ui.groupAttempt.groupId));const t={state:"",args:{attemptId:e||null,columnId:this.scope.column().id||null,contentId:this.scope.column().contentId||null,courseId:this.scope.column().courseId}};let i="inline-rubric";if(this.scope.isManualStatusPosted||this.gradeDisplayItem.displayValue&&"0"!==this.gradeDisplayItem.displayValue||this.scope.isExternalSubmission||this.scope.column().isCollectExternalSubmissions()||(i=this.shouldRenderInlineRubric()?"inline-rubric":"peek.rubric-view"),this.canViewGradebook||this.scope.column().isDiscussion()||this.scope.column().isJournal()){const e=this.rubricEvaluationIsComplete()?"rubric-evaluation":"rubric-view";t.args.groupId=s||null,t.args.userId=this.scope.grade&&this.scope.grade().user&&(this.scope.grade().user.$pk||this.scope.grade().user.id)||null,t.state=e,this.scope.column().isJournal()&&(t.state=this.rubricEvaluationIsComplete()?b.JournalRoutes.JOURNAL_VIEW_WITH_PARTICIPATION_AND_RUBRIC_EVALUATION:b.JournalRoutes.JOURNAL_VIEW_WITH_PARTICIPATION_AND_RUBRIC_VIEW)}else t.args.groupId=s||null,t.state=`${b.AssessmentRoutes.ASSESSMENT_ATTEMPT_REVIEW}.${i}`;return h.e(this.ultraState.current.name,".peek.course.grades")&&(this.scope.column().isCollectExternalSubmissions()?(t.state=`${b.AssessmentRoutes.ASSESSMENT_ATTEMPT_REVIEW}.inline-rubric`,t.args.skipTransitionEvents=!0):t.state="assessment.overview"),t}};w=Object(i.__decorate)([Object(i.__param)(0,Object(v.b)("$injector")),Object(i.__param)(1,Object(v.b)("$sce")),Object(i.__param)(2,Object(v.b)("scope")),Object(i.__param)(3,Object(v.b)("element")),Object(i.__param)(4,Object(v.b)(a.serviceName)),Object(i.__param)(5,Object(v.b)(r.b)),Object(i.__param)(6,Object(v.b)(u.d)),Object(i.__param)(7,Object(v.b)(c.b)),Object(i.__param)(8,Object(v.b)(p.b))],w);class D{constructor(e){this.$injector=e,this.restrict="E",this.template=m,this.scope={attempt:"&?",column:"&",disableRubricEvalClick:"&?",grade:"&?",isManualStatusPosted:"<?",cursor:"@?",hideRubricIcon:"=?",isExternalSubmission:"=?",rubricStateOverride:"@?"},this.link=(e,s)=>{if(!e.attempt&&!e.grade)throw new Error("An attempt or grade must be included on scope");if(e.attempt&&e.grade)throw new Error("An attempt or grade should be included on scope, not both");if(!e.column)throw new Error("A column must be included on scope");e.displayGradePill=this.$injector.instantiate(w,{scope:e,element:s})}}}D.$inject=["$injector"],n.module(S,[d.N,c.a]).directive("bbDisplayGradePill",["$injector",e=>e.instantiate(D)])},cnCq:function(e,s){e.exports='<div bb-first-time-container class="discussion-container engagement-view">\n  \x3c!-- in-view-container is for discussion message read/unread --\x3e\n  <div class="panel-wrap students-infinite-scroll-wrap in-view-container-for-large" in-view-container intersection-observer-root-flag>\n    <div ng-if="engagementView.selectedParticipantFormatedUserName && engagementView.isShowDiscussion()"\n         class="participant-notification-bar hide-for-large-up"\n         bb-foundation-wait="discussionController.selectedParticipantFormatedUserName">\n      <div class="participant-selected-info">\n        <div class="participant-avatar">\n          <bb-avatar user="engagementView.selectedParticipant.data" auto-update="true"></bb-avatar>\n        </div>\n        <div class="participant-details" bb-translate="course.engagement.participantCommentsFilterMessage"\n             translate-values="{userName: engagementView.selectedParticipantFormatedUserName}">\n        </div>\n        <div class="cancel-filter-button">\n          <button class="icon-circle-x clear"\n                  ng-click="engagementView.cancelParticipantFilter()"\n                  bb-translate-attrs="{\'aria-label\':\'course.engagement.cancelClickParticipant\'}"\n                  analytics-id="course.engagement.cancelClickParticipant.button">\n          </button>\n        </div>\n      </div>\n    </div>\n    <header class="color-selection-live-mode black-panel-header">\n      <div class="black-header-contents">\n        <button class="left-off-canvas-toggle menu-toggle standard-button dark-background"\n                type="button"\n                analytics-id="course.content.menu.button">\n          <bb-svg-icon size="small" icon="main-menu"></bb-svg-icon>\n          <span class="sr-only" bb-translate>course.content.menu</span>\n        </button>\n        <h1 class="panel-title" bb-translate="course.engagement.edit.pageTitle"></h1>\n        <a class="standard-button dark-background"\n           ng-if="!engagementView.canEditContent() && engagementView.isShowSettings()"\n           bb-peek-sref="discussion-details"\n           bb-translate-attrs="{\'title\':\'components.directives.header.details\', \'aria-label\':\'components.directives.header.details\'}"\n           analytics-id="course.engagement.discussionDetails.link">\n          <bb-svg-icon class="themed-background-primary-medium-down" size="small" icon="information"></bb-svg-icon>\n        </a>\n        <a class="standard-button dark-background"\n           ng-if="engagementView.showParticipantsLink()"\n           ui-sref-active="active"\n           bb-peek-sref="discussion-participants"\n           bb-translate-attrs="{\'aria-label\':\'components.directives.header.participants\'}"\n           analytics-id="course.engagement.discussionParticipants.link">\n          <bb-svg-icon class="themed-background-primary-medium-down" ng-if="!content.isGroupContent" size="small" icon="people"></bb-svg-icon>\n          <bb-svg-icon class="themed-background-primary-medium-down" ng-if="content.isGroupContent" size="small" icon="groups"></bb-svg-icon>\n        </a>\n        <a class="standard-button dark-background"\n           ng-if="engagementView.isShowSettings()"\n           bb-peek-sref="{{engagementView.getSettingOrDetailPeekSref()}}"\n           bb-translate-attrs="{\'aria-label\':\'{{::engagementView.getSettingsLabel()}}\'}"\n           analytics-id="course.engagement.discussionSettings.link">\n          <bb-svg-icon class="themed-background-primary-medium-down" size="small" icon="settings"></bb-svg-icon>\n        </a>\n      </div>\n    </header>\n    <section class="panel-content in-view-container-for-small-medium">\n      \x3c!-- engineer need add real logic here, show-settings/show-participants --\x3e\n      <bb-panel-header\n        content="engagementView.discussionService.hardLinkContent"\n        localization-key="x-bb-forumlink"\n        panel-title="engagementView.title"\n        show-course="true"\n        show-delete="false"\n        show-visibility="engagementView.canEditAvailability()"\n        can-edit="engagementView.canEditContent()"\n        onchange-func-visibility="engagementView.visibilityChange()"\n        ondelete-func="engagementView.deleteDiscussion()"\n        max-length="250"\n        onblur-func-title="engagementView.saveContentTitle()"\n        onblur-func-visibility="engagementView.saveContent()"\n        has-slider="engagementView.showSlider()"\n        auto-title="true"\n        show-settings="::engagementView.isShowSettings()"\n        settings-peek-ref="{{engagementView.getSettingOrDetailPeekSref()}}"\n        settings-icon="{{::engagementView.getSettingsIcon()}}"\n        settings-label="{{::engagementView.getSettingsLabel()}}"\n        show-participants="!engagementView.isShowParticipants()"\n        filter-title-tags="true"\n        show-empty-title-reminder="true"></bb-panel-header>\n      <bb-content-navigator content="engagementView.discussionService.softLinkContent"></bb-content-navigator>\n\n      <div ng-show="engagementView.showSlider()" class="panel-content-slide-toggle" ng-class="{\'has-no-groups\': engagementView.discussionService.hasNoGroups()}">\n        <div class="panel-content-left-trigger"\n             ng-class="{\'active\': engagementView.isShowDiscussion(),\'text-center\': engagementView.isShowDiscussion()}"\n             ng-disabled="engagementView.isShowDiscussion()">\n          <a href="javascript:void(0);"\n             id="discussion-panel"\n             class="discussion-panel"\n             ng-click="engagementView.clickDiscussion()"\n             tabindex="{{engagementView.isShowDiscussion() ? -1 : 0}}"\n             bb-translate-attrs="{\'aria-label\':\'course.engagement.discussionSlick.discussion\'}"\n             role="link"\n             analytics-id="course.engagement.discussionSlick.discussion.link">\n            <bb-svg-icon size="medium" icon="back-arrow" aria-role="presentation" class="hide-on-active"></bb-svg-icon>\n            <span class="page-title" bb-translate>course.engagement.discussionSlick.discussion</span>\n          </a>\n        </div>\n        <div class="panel-content-right-trigger"\n             ng-class="{\'active\': engagementView.isShowParticipants(),\'text-center\': engagementView.isShowParticipants(), \'is-group-discussion\': engagementView.discussionService.hasGroups() }"\n             ng-disabled="engagementView.isShowParticipants()">\n          <a href="javascript:void(0);"\n             id="participant-grade-panel"\n             class="participant-grade-panel"\n             ng-click="engagementView.clickParticipants()"\n             tabindex="{{engagementView.isShowParticipants() ? -1 : 0}}"\n             bb-translate-attrs="{\'aria-label\':\'course.engagement.discussionSlick.participationGrade\'}"\n             role="link"\n             analytics-id="course.engagement.discussionSlick.participationGrade.link">\n            <span class="page-title" bb-translate>course.engagement.discussionSlick.participationGrade</span>\n            <div class="participants-groups-filter" ng-if="engagementView.discussionService.hasGroups()">\n              <div role="button" class="filter-wrap select-wrapper" bb-foundation-defer>\n                <div data-dropdown="participants-group-discussion-filter" class="group-name" tabindex="0">\n                  <span class="ellipse" title="{{engagementView.discussionService.selectedGroup.name}}">{{engagementView.discussionService.selectedGroup.name}}</span>\n                </div>\n                <bb-dropdown list-id="participants-group-discussion-filter"\n                             list-kind="filter"\n                             item-list="engagementView.discussionService.assignedGroupsFiltersArray"\n                             click-function="engagementView.changeGroup(item)"\n                             analytics-id-tag-prefix="course.engagement.discussion-slick.assignedGroupsFilter">\n                </bb-dropdown>\n              </div>\n            </div>\n            <bb-svg-icon size="medium" icon="forward-arrow" aria-role="presentation" class="hide-on-active"></bb-svg-icon>\n          </a>\n        </div>\n\n        <div ng-class="{active: engagementView.isShowParticipants()}"\n             class="collapsible-row grade-column-stat-headers off-canvas-overlay three-buttons">\n          <div ng-if="engagementView.isShowParticipants() && engagementView.discussionService.column.seemsAttemptBased() && engagementView.discussionService.column.summary.numEligibleToBeGraded > 0"\n               class="row submission-list-row submission-border-removal">\n            <div class="columns medium-offset-4 medium-3 small-4">\n              <span class="stat js-engagement-students-participating"\n                    ng-if="engagementView.discussionService.column.summary.$resolved"\n                    bb-translate="course.engagement.grade.counts.studentsParticipating.plural"\n                    translate-values="{submittedCount: engagementView.discussionService.participantCount, totalCount: engagementView.discussionService.column.summary.numEligibleToBeGraded}">\n              </span>\n            </div>\n            <div class="columns medium-3 small-4">\n              <span class="stat js-engagement-participation-to-grade"\n                    ng-if="engagementView.discussionService.column.summary.$resolved"\n                    bb-translate="course.engagement.grade.counts.participationToGrade.plural"\n                    translate-values="{gradeCount: engagementView.discussionService.column.summary.numStudentsNeedsGrading}">\n              </span>\n            </div>\n            <div class="columns medium-2 small-4 end">\n              <span class="stat js-engagement-grades-to-post" tabindex="-1"\n                    ng-if="engagementView.discussionService.column.summary.$resolved"\n                    bb-translate="course.engagement.grade.counts.gradesToPost.plural"\n                    translate-values="{postCount: engagementView.discussionService.column.summary.totalNumberOfGradesToPost()}">\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <div ng-if="engagementView.discussionService.column.isOffline()" class="collapsible-row grade-column-stat-headers off-canvas-overlay three-buttons active">\n          <div class="row offline-alignment">\n            <div class="columns hide-for-small-only small-8 medium-3">&nbsp;</div>\n            <div class="columns small-12 medium-2 right-align-on-small">\n                <span class="stat"\n                      ng-if="engagementView.discussionService.column.summary.$resolved"\n                      bb-translate="course.engagement.grade.counts.participationToGrade.plural"\n                      translate-values="{gradeCount: engagementView.discussionService.column.summary.numStudentsNeedsGrading}">\n                </span>\n            </div>\n            <div class="columns medium-5 hide-for-small-only">&nbsp;</div>\n            <div class="columns medium-4 small-3 small-collapse end">&nbsp;</div>\n          </div>\n        </div>\n      </div>\n\n      <div class="discussion-grade-override override-notification"\n           ng-if="engagementView.showOverrideIndicator()"\n           ng-class="{\'discussion-details-hidden\': engagementView.hideDetailsAndInformation}"\n           bb-translate>\n        <span>course.engagement.overrideNotification.discussionMessage</span>\n      </div>\n\n      <div class="panel-content-inner" ng-class="{\'has-slider\': engagementView.showSlider()}">\n        <div bb-slick manual-init="true"\n             slick-handle="engagementView.carousel"\n             initial-slide="engagementView.carouselInitialSlide"\n             infinite="false"\n             prev-arrow="panel-content-left-trigger"\n             next-arrow="panel-content-right-trigger"\n             slides-to-show="1"\n             slides-to-scroll="1"\n             accessibility="false"\n             swipe="false">\n          <div class="panel-content-left" ui-view="engagement-edit@"></div>\n\n          <div ng-show="engagementView.showSlider()" class="panel-content-right">\n            <div ng-if="engagementView.showSlider()" ng-show="engagementView.isShowParticipants()" ui-view="engagement-grade@"></div>\n          </div>\n\n        </div>\n      </div>\n\n      \x3c!--</bb-slick>--\x3e\n    </section>\n    <div ui-view="discussion-peek@"></div>\n  </div>\n  <div class="spinner bb-secondary-color-2" ng-if="engagementView.showSpinnerChild" aria-hidden="true"></div>\n</div>\n'},"d3l/":function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-small-people",use:"icon-small-people-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-people"><path d="M6.5 10C7.8807 10 9 8.8807 9 7.5S7.8807 5 6.5 5 4 6.1193 4 7.5 5.1193 10 6.5 10zM12 15c0-2.5-2.2288-5-5.5-5S1 12.5 1 15M11.5 6C12.8807 6 14 4.8807 14 3.5S12.8807 1 11.5 1 9 2.1193 9 3.5 10.1193 6 11.5 6zM15 9c0-1-1.5-3-3-3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},"dL5/":function(e,s){e.exports='<span class="group-count-directive" bb-load-bundle="components/directives/group/group-count">\n  <bb-translate translate-values="{number: $ctrl.content.assignedGroups.length}"\n                ng-if="!$ctrl.isSelfEnrollment()">components.directives.group-count.groups.plural</bb-translate>\n  <bb-translate translate-values="{number: $ctrl.content.assignedGroups.length}"\n                ng-if="$ctrl.isSelfEnrollment()">components.directives.group-count.groups.selfEnroll.plural</bb-translate>\n</span>\n'},dcnw:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-grade",use:"icon-medium-grade-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-grade"><path d="M21 11V1H3v22h8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M17.5 12l1.2348 3.8004h3.996l-3.2328 2.3488 1.2348 3.8004L17.5 19.6008l-3.2328 2.3488 1.2348-3.8004-3.2328-2.3488h3.996L17.5 12zM7 5h8M7 9h10M7 13h3M7 17h2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},dxd1:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-accommodations",use:"icon-medium-accommodations-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-accommodations"><path d="M3 23V1h18v22l-9-6-9 6zM7 6h10M7 9h10M7 12h10" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},ftvW:function(e,s,t){"use strict";var i=t("D57K"),n=(t("r+pC"),t("2szi"),t("lwNT"),t("yC9S")),o=t("nYZ0"),a=t("Qbdf"),r=t("X455"),c=t("TnpK"),l=t("aTRN"),d=t("Is+C"),u=t("pjml"),h=t("Q/M7"),p=t("U2yg"),m=t("zGdY"),b=t("nmzr"),g=t("Htol");t.d(s,"a",(function(){return v}));const v="ultra.components.directives.content.contentNavigator";let S=class{constructor(e,s,t,i,n,o,a,r){this.scope=e,this.$state=s,this.timeout=t,this.contentService=i,this.contextCourse=n,this.contextCourseMembership=o,this.$injector=a,this.scormService=r,this.sibling={next:null,previous:null},this.cr={next:null,previous:null}}$onChanges(){this.init()}isStudent(){return this.contextCourseMembership.isStudentMembership()}init(){this.content&&this.isStudent()&&1!==this.content.depth&&this.$state.includes("**.outline.**")&&(this.scope.content=this.content,this.getLearningModuleContent().then(e=>{e.isLearningModule()&&(this.learningModuleContent=e,this.scope.$on(g.b,(e,s,t)=>{t===m.ContentReviewState.Completed&&this.getSibling("next")}),this.getSibling("next"),this.getSibling("previous"))}))}getSibling(e){this.content.getSibling(e,this.learningModuleContent.id).then(s=>{s&&(this.sibling[e]=s,this.cr[e]=this.$injector.instantiate(l.a,{scope:this.scope}),this.cr[e].getConditions(s))})}getLearningModuleContent(){const e=this.contextCourse.course,s=this.contentService.findRootNode(e,u.p.ContentRootNode.ROOT),t=i=>this.contentService.getParentFolder(i.parentId,e.id,s).$asPromise().then(e=>e.isRoot()?i:t(e));return t(this.content)}shouldShowNavigator(){return this.isStudent()&&(!!this.sibling.next||!!this.sibling.previous)}navigate(e){if(!this.sibling[e].canEdit()&&this.sibling[e].isConditionalReleaseLocked())return;const s=this.$state.current.name.split("."),t=s.length-s.lastIndexOf("peek")-1,i=this.sibling[e],n=`content-navigator-transition-${i.isTest()?"peek":"full"}`;this.$state.go("^.".repeat(t)+n).then(this.timeout).then(()=>{if(i.isDiscussionInOutline()){const e=i.contentDetail[u.p.ContentHandler.CourseLink.toString()].linkSourceId;this.$state.go("^.discussion.view.with-grading",{contentId:e})}else if(i.isTest())this.$state.go("^.assessment.overview",{contentId:i.id});else if(i.isDocument())this.$state.go(`^.${b.ContentRoutes.DOCUMENT}`,{id:i.id});else if(i.isJournal())this.$state.go(`^.${b.Routes.Journal.JOURNAL_VIEW_WITH_PARTICIPATION}`,{contentId:i.id});else if(i.isPlaceHolderContent())this.$state.go("^.content-navigator-placeholder",{contentId:i.id});else if(i.isScorm())if(i.getAssociatedGradingColumn())this.$state.go("^.scorm-overview.student",{contentId:i.id});else{let e=h.c(this.scormService.getLaunchLinkFromContent(i));e=h.a(e,"from_ultra","true"),this.$state.go("^.scorm-launch-frame",{toolHref:e,contentId:i.id})}})}};S.$inject=["$scope",c.d,"$timeout",o.f,a.e,r.d,"$injector",d.c],S=Object(i.__decorate)([Object(n.a)({moduleName:v,componentName:"bbContentNavigator",template:p,bindings:{content:"<"},requireModules:[o.d,a.b,r.a,c.b,d.b]})],S)},h7qX:function(e,s,t){"use strict";(function(e){t.d(s,"d",(function(){return o})),t.d(s,"a",(function(){return a})),t.d(s,"b",(function(){return r})),t.d(s,"c",(function(){return c}));var i=t("Llzl"),n=t("nsO7");const o="ultra.components.directives.intersectionObserverRoot",a="intersection-observer-target-id",r="intersectionObserverTargetId";class c{constructor(e,s=i.noop,t=i.noop){this.element=e,this.inCallback=s,this.outCallback=t}getId(){return this.element.attr(a)}in(){this.inCallback()}out(){this.outCallback()}toElement(){return this.element.get(0)}}class l{constructor(s){this.targets=new Map,this.intersectionObserver=new IntersectionObserver(s=>{s.forEach(s=>{const t=this.targets.get(e(s.target).attr(a));t&&(s.isIntersecting?t.in():t.out())})},s)}observe(e){const s=e.getId();n.isEmpty(s)||(this.unobserve(s),this.targets.set(s,e),this.intersectionObserver.observe(e.toElement()))}unobserve(e){if(n.isEmpty(e))return;const s=this.targets.get(e);s&&(this.intersectionObserver.unobserve(s.toElement()),this.targets.delete(e))}disconnect(){this.intersectionObserver.disconnect(),this.targets.clear()}}class d{constructor(e,s){this.$scope=e,this.$element=s;const t=(e.rootOptions||(()=>({root:s.get(0),rootMargin:"0px 0px 0px 0px"})))();this.observer=new l(t),e.$on("$destroy",()=>this.unregisterAll())}registerTarget(e){this.observer.observe(e)}unregisterTarget(e){this.observer.unobserve(e.getId())}unregisterAll(){this.observer.disconnect()}}d.$inject=["$scope","$element"];class u{constructor(){this.restrict="A",this.scope={rootOptions:"&?"},this.controller=d}}i.module(o,[]).directive("bbIntersectionObserverRoot",["$injector",e=>e.instantiate(u)])}).call(this,t("5iHu"))},jbaE:function(e,s,t){"use strict";(function(e){t.d(s,"a",(function(){return f}));var i=t("D57K"),n=(t("ph44"),t("vhkR")),o=t("cs5G"),a=t("Llzl"),r=t("Fvsw"),c=t("Qbdf"),l=t("0JpG"),d=t("X8JP"),u=t("TnpK"),h=t("5MwF"),p=t("kBJj"),m=t("Q/M7"),b=t("pjml"),g=t("Y+9S"),v=t("aHpC"),S=t("jbsW");const f="ultraUi.components.directives.editor.richTextEditor";let C=class{constructor(e,s,t,i,n,o,a,r,c,l,d,u,h,p){this.$q=e,this.$scope=s,this.element=t,this.attrs=i,this.controllers=n,this.bbEditorFactory=o,this.bbLocalize=a,this.bbContext=r,this.ltiService=c,this.CloudStorageIntegrationModalService=l,this.AnnotationsModel=d,this.contextCourse=u,this.allyService=h,this.ultraState=p;const m=this.$scope.$watch("pluginOptions",e=>{e&&(m(),this.initEditor())});this.reactAllyService=this.allyService.getReactService(this.$scope),s.$on("$destroy",()=>{s.editor&&s.editor.destroy()})}initEditor(){let e=null,s=!1,t=null;const i=this.controllers.ngModel,n=i.$setPristine.bind(i);i.$viewChangeListeners.push(()=>{s||n()}),i.$setPristine=()=>{n(),t&&t(i.$modelValue)};const o=e=>{this.$scope.editor&&this.$scope.editor.update(e)};this.$scope.$watch(()=>i.$modelValue,s=>{s!==e&&o({bbml:s})}),this.$scope.$watchGroup(["isDisabled","isReadOnly","isToolbarHidden","allyIndexMap"],([e,s,t,i])=>{this.$scope.editor&&o({isDisabled:e,isReadOnly:s,isToolbarHidden:t,ally:{service:this.reactAllyService,indexMap:i}})});const a=(e,s)=>void 0!==e?e:s,r=e=>{this.$scope.fileLocation=e.data?e.data.fileLocation:e.fileLocation,this.$scope.webLocation=e.data?e.data.webLocation:e.webLocation},c=n=>{var o,a;s=n.isDirty,t=n.setPristine;const r=n.toBbML();e=r,i.$setViewValue(r),null===(a=(o=this.$scope).onChange)||void 0===a||a.call(o)},l={placeholderText:this.bbLocalize.translate({locale:this.bbLocalize.getLocale(this.$scope),key:this.$scope.placeholder})};this.$scope.pluginOptions&&this.$scope.pluginOptions.attachment&&(l.cloudStorageIntegration=this.CloudStorageIntegrationModalService.initialize()),this.$q.all(l).then(e=>{const s=[Object(p.customClass)()],{locale:t,babelfishInstance:n,babelfishFormatter:o,isRtl:l}=this.bbLocalize.getReactBabelfishParams(this.$scope);if(this.$scope.pluginOptions){!1!==this.$scope.pluginOptions.link&&s.push(Object(p.link)()),!1!==this.$scope.pluginOptions.image&&s.push(Object(p.image)()),!1!==this.$scope.pluginOptions.video&&s.push(Object(p.video)()),this.$scope.pluginOptions.math&&s.push(Object(p.math)({apiBasePath:Object(m.c)(h.a.apiBasePath),courseId:this.contextCourse.courseId,xsrfToken:this.bbContext.xsrfToken})),this.$scope.pluginOptions.attachment&&s.push(Object(p.insertLocalFile)({apiBasePath:Object(m.c)(h.a.apiBasePath),xsrfToken:this.bbContext.xsrfToken,webLocation:this.$scope.webLocation||"",fileLocation:this.$scope.fileLocation||"",onUploadSuccess:r,buttonId:Object(g.isInMobileApp)()?"insertFile":""}));let e=!0;!1===this.$scope.pluginOptions.youtubeVideo&&(e=!1),e&&s.push(Object(p.insertYoutubeVideo)({apiBasePath:Object(m.c)(h.a.apiBasePath),getEmbedSrc:this.ltiService.configureAndInitInlineLaunch.bind(this.ltiService),xsrfToken:this.bbContext.xsrfToken,courseId:this.contextCourse.courseId})),this.$scope.pluginOptions.demoMashup&&s.push(Object(p.demoMashup)()),this.$scope.pluginOptions.attachment&&this.CloudStorageIntegrationModalService.isCloudServiceAvailable&&!Object(g.isInMobileApp)()&&s.push(Object(p.insertCloudStorageIntegrationFile)({openCloudStorageIntegrationModal:this.CloudStorageIntegrationModalService.getModalCallback(this.$scope),apiBasePath:Object(m.c)(h.a.apiBasePath),xsrfToken:this.bbContext.xsrfToken,webLocation:this.$scope.webLocation||"",fileLocation:this.$scope.fileLocation||""})),this.$scope.pluginOptions.contentMarket&&s.push(Object(p.contentMarket)({apiBasePath:Object(m.c)(h.a.apiBasePath),getEmbedSrc:this.ltiService.configureAndInitInlineLaunch.bind(this.ltiService),noInsert:this.$scope.contentMarketIsReadOnly,openContentMarket:this.ltiService.getOpenContentMarketConf(this.$scope),xsrfToken:this.bbContext.xsrfToken}))}let d=this.$scope.rootContentId;!d&&this.ultraState&&this.ultraState.getCurrentResolvedValues&&this.ultraState.getCurrentResolvedValues().currentContent&&(d=this.ultraState.getCurrentResolvedValues().currentContent.id);const u={bbml:i.$modelValue||"",isDisabled:a(this.$scope.isDisabled,!1),isReadOnly:a(this.$scope.isReadOnly,!1),isToolbarHidden:a(this.$scope.isToolbarHidden,!1),isRtl:l,locale:t,babelfishInstance:n,babelfishFormatInstance:o,onChange:c,placeholder:e.placeholderText,plugins:s,editorId:this.$scope.editorId,ariaLabelledBy:this.$scope.editorAriaLabelledBy,ariaDescribedBy:this.$scope.editorAriaDescribedBy,onDownloadWithAnnotations:this.getOnDownloadWithAnnotations(),showWordCount:this.$scope.showWordCount,ally:{service:this.reactAllyService,indexMap:this.$scope.allyIndexMap||new Map},rootContentId:d,...this.$scope.onFocus?{onFocus:()=>this.$scope.$applyAsync(this.$scope.onFocus)}:null,...this.$scope.onBlur?{onBlur:()=>this.$scope.$applyAsync(this.$scope.onBlur)}:null,...h.a.unitTesting?{mockLocalize:Object(S.getLocalizeMock)()}:null};this.$scope.onBlur&&i.$setTouched(),this.$scope.editor=this.bbEditorFactory(this.element[0],u)})}getOnDownloadWithAnnotations(){return s=>{const t=!!s.groupAttemptFileId,i=s.attemptFileId||s.groupAttemptFileId,n={systemInfo:this.bbContext.getSystemInfo().$asPromise(),annotations:this.AnnotationsModel.downloadWithAnnotations(i,t,this.contextCourse.courseId).$asPromise()};return this.$q.all(n).then(s=>{const t=s.systemInfo.annotationRendererUrl;if(!(t&&t.length>0))throw new Error("Annotation Service url is not defined.");{const i=e("#annotationIframe");null!==i&&i.remove();const n=e("#annotationForm");null!==n&&n.remove();const o=e(document.createElement("iframe"));o.attr("src","about:blank"),o.attr("id","annotationIframe"),o.attr("name","annotationIframe"),o.css("display","none");const a=e(document.createElement("form"));a.attr("target","annotationIframe"),a.attr("method","POST"),a.attr("action",t+"/annotation/token"),a.attr("id","annotationForm"),a.attr("name","annotationForm");const r=e(document.createElement("input"));r.attr("type","hidden"),r.attr("name","jwt"),r.attr("value",s.annotations.jwt),r.appendTo(a);const c=e("body");a.appendTo(c),o.appendTo(c),a.submit()}})}}};C=Object(i.__decorate)([Object(i.__param)(0,Object(v.b)("$q")),Object(i.__param)(1,Object(v.b)("scope")),Object(i.__param)(2,Object(v.b)("element")),Object(i.__param)(3,Object(v.b)("attrs")),Object(i.__param)(4,Object(v.b)("controllers")),Object(i.__param)(5,Object(v.b)("BbEditorFactory")),Object(i.__param)(6,Object(v.b)(l.serviceName)),Object(i.__param)(7,Object(v.b)(r.b)),Object(i.__param)(8,Object(v.b)(n.b)),Object(i.__param)(9,Object(v.b)(d.b)),Object(i.__param)(10,Object(v.b)(b.c.serviceName)),Object(i.__param)(11,Object(v.b)(c.e)),Object(i.__param)(12,Object(v.b)(o.b)),Object(i.__param)(13,Object(v.b)(u.d))],C);class w{constructor(e){this.$injector=e,this.link=(e,s,t,i)=>{s.addClass("rich-text-editor"),e.richTextEditor=this.$injector.instantiate(C,{scope:e,element:s,attrs:t,controllers:i})},this.require={ngModel:"ngModel"},this.restrict="E",this.scope={contentMarketIsReadOnly:"<?",fileLocation:"=?",isDisabled:"<?",isReadOnly:"<?",isToolbarHidden:"<?",onChange:"<?",onBlur:"&?",onFocus:"&?",placeholder:"@?editorPlaceholderKey",pluginOptions:"<?",webLocation:"=?",editorId:"@?",editorAriaLabelledBy:"@?",editorAriaDescribedBy:"@?",showWordCount:"<?",allyIndexMap:"=?",rootContentId:"@?"}}}w.$inject=["$injector"],a.module(f,[l.moduleName,r.a,d.a,n.a,o.a]).value("BbEditorFactory",p.BbEditorFactory).directive("bbRichTextEditor",["$injector",e=>e.instantiate(w)])}).call(this,t("5iHu"))},jmkQ:function(e,s,t){"use strict";t.d(s,"a",(function(){return a}));var i=t("Llzl"),n=t("nsO7"),o=t("h7qX");const a="ultra.components.directives.intersectionObserverTarget";class r{constructor(){this.require="^^bbIntersectionObserverRoot",this.restrict="A",this.scope={[o.b]:"@",inCallback:"&?",outCallback:"&?"},this.link=(e,s,t,i)=>{n.isEmpty(e[o.b])||(s.attr(o.a,e[o.b]),e.target=new o.c(s,e.inCallback,e.outCallback),i.registerTarget(e.target),e.$on("$destroy",()=>{i.unregisterTarget(e.target)}))}}}i.module(a,[]).directive("bbIntersectionObserverTarget",["$injector",e=>e.instantiate(r)])},k6nO:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-trash",use:"icon-medium-trash-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-trash"><path d="M3.5 7h17M3 4l2 19h14l2-19M8 4V1h8v3M2 4h20M8 10l1 10M12 10v10M16 10l-1 10" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},lGua:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-small-settings",use:"icon-small-settings-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-settings"><path d="M7.5977 1.5453c.1998-.2709.6048-.2709.8046 0l.9644 1.307a.5.5 0 00.5534.1798l1.5484-.4906c.3209-.1016.6485.1364.651.473l.0119 1.6242a.5001.5001 0 00.342.4707l1.5411.5133c.3193.1064.4445.4916.2486.7653l-.945 1.321a.5002.5002 0 000 .582l.945 1.321c.1959.2737.0707.6589-.2486.7653l-1.5411.5133a.5.5 0 00-.342.4706l-.0119 1.6243c-.0025.3366-.3301.5746-.651.473L9.92 12.9679a.5.5 0 00-.5533.1798l-.9644 1.307c-.1998.2709-.6048.2709-.8046 0l-.9644-1.307a.5.5 0 00-.5534-.1798l-1.5484.4906c-.3209.1016-.6485-.1364-.651-.473l-.012-1.6243a.4999.4999 0 00-.342-.4706l-1.541-.5133c-.3193-.1064-.4445-.4916-.2486-.7653l.945-1.321a.5.5 0 000-.582l-.945-1.321c-.1959-.2737-.0707-.6589.2486-.7653l1.541-.5133a.5.5 0 00.342-.4707l.012-1.6242c.0025-.3366.3301-.5746.651-.473l1.5484.4906a.5.5 0 00.5534-.1798l.9644-1.307z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M10 8c0 1.1046-.8954 2-2 2s-2-.8954-2-2 .8954-2 2-2 2 .8954 2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},lwNT:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-small-lock",use:"icon-small-lock-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-lock"><path d="M3 8h10v7H3V8zM5 8V4c0-1.5 1-3 3-3m0 0c.5 0-.5 0 0 0zm0 0c2 0 3 1.5 3 3v4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},ooAF:function(e,s){e.exports='<div class="grade-color">\n    <div class="wrapping-input-style readonly pill-style {{displayGradePill.colorCss}} {{displayGradePill.cursorClass}}">\n      <div ng-if="!displayGradePill.shouldShowRubricButton()">\n        <span class="grade-input-display grade-ellipsis"><bdi>{{displayGradePill.displayValue}}</bdi></span>\n      </div>\n      <div ng-if="displayGradePill.shouldShowRubricButton()">\n        <a ng-click="displayGradePill.openRubricEvaluation($event)"\n           ng-class="{\'disable-click\': !!disableRubricEvalClick()}"\n           class="grade-rubric-detail"\n           aria-disabled="{{!!disableRubricEvalClick()}}"\n           href=""\n           analytics-id="components.directives.grade.gradePill.showRubric.link">\n          <bb-svg-icon size="small" icon="rubric"></bb-svg-icon>\n          <span class="grade-input-display ready grade-ellipsis">{{displayGradePill.displayValue}}</span>\n        </a>\n      </div>\n    </div>\n</div>\n'},pSe1:function(e,s){e.exports='<bb-usercard usercard-show="avatar"\n  user="::message.user"\n  course-id="{{::courseId}}"\n  can-send-message="::messageControl.canSendMessageInUserCard()"\n  course-role="::messageControl.scope.courseRole"\n  auto-update="false"\n  inactive="!messageControl.isAvailable()">\n</bb-usercard>\n'},ph44:function(e,s,t){},"r+pC":function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-back-arrow",use:"icon-medium-back-arrow-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-back-arrow"><path d="M11 23L1 12 11 1M1 12h22" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},r133:function(e,s,t){"use strict";t.d(s,"a",(function(){return c})),t.d(s,"b",(function(){return l}));var i=t("Llzl"),n=t("Fvsw"),o=t("0JpG"),a=t("0+Qs"),r=t("BXQP");const c="ultra.directives.bbDuration",l="refresh.relative.dates";class d{constructor(e,s,t,i){this.scope=e,this.bbContext=s,this.bbLocalize=t,this.interval=i,this.date="",this.time="",this.lessThanOneDay=!1;const n=e.$watch("date",()=>{this._localizeRelativeDate(),e.autoUpdate&&!e.autoUpdate()&&e.date&&n()});e.$on(l,()=>{this._localizeRelativeDate()}),this.interval(()=>{this._localizeRelativeDate()},this.scope,d.DEFAULT_REFRESH_INTERVAL)}needAgo(){return!!(this.scope.hasAgo&&this.scope.hasAgo()&&this.lessThanOneDay)}separateDatetime(){return!(!this.scope.separateDatetime||!this.scope.separateDatetime())}_localizeRelativeDate(){if(this.scope.date){let e={},s=new Date;const t=this.scope.isRelativeToServerDate&&this.scope.isRelativeToServerDate();(null==t||t)&&(e={relativeTo:this.bbContext.getServerTime()},s=this.bbContext.getServerTime());const i=s.getTime()-this.scope.date.getTime();if(i>=6e4&&this.scope.date.setSeconds(30),this.lessThanOneDay=i<=864e5,this.needAgo()||this.separateDatetime()){const s=this.bbLocalize.getFormatEnum(o.ILocaleDateFormat,this.scope.dateFormat)||o.ILocaleDateFormat.Short;this.bbLocalize.formatDuration(this.scope.date,this.scope,e,s).then(e=>{this.date=e.date||"",this.time=e.time||""})}}}}d.DEFAULT_REFRESH_INTERVAL=18e4,d.$inject=["scope",n.b,o.serviceName,a.b];class u{constructor(e){this.$injector=e,this.restrict="E",this.replace=!0,this.template=r,this.scope={date:"=",autoUpdate:"&?",isRelativeToServerDate:"&?",dateFormat:"@?",hasAgo:"&?",separateDatetime:"&?"},this.link=e=>{e.duration=this.$injector.instantiate(d,{scope:e})}}}u.$inject=["$injector"],i.module(c,[n.a,o.moduleName,a.a]).directive("bbDuration",["$injector",e=>e.instantiate(u)])},sZYy:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-goal",use:"icon-medium-goal-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-goal"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M1 1h22v4H1zM6 20h12v3H6z" /><path d="M10 14v6M14 14v6" stroke-width="2" /><path d="M4 5c0 6 3 9 8 9s8-3 8-9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M4 8H1c0 9.5 9 9 9 9M20 8h3c0 9.5-9 9-9 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},smDF:function(e,s,t){var i=t("ziER"),n=t("5JeM"),o=new i({id:"icon-medium-add-circle",use:"icon-medium-add-circle-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-add-circle"><circle cx="12" cy="12" r="11" stroke-width="2" /><path d="M12 7v10M7 12h10" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(o);e.exports=o},tZxt:function(e,s){e.exports='<div bb-load-bundle="components/directives/discussion"\n  bb-intersection-observer-target intersection-observer-target-id="{{::messageMode === \'view\' ? \'message\' + message.id : \'\'}}"\n                                  in-callback="inCallback()"\n                                  out-callback="outCallback()">\n  <div class="reply-form comments"\n      in-view="messageControl.updateMessageStatus($inview, message)"\n      in-view-options="{ debounce: 2000 }"\n      tabindex="-1"\n      message-id="{{messageMode === \'view\' ? message.id : \'\'}}">\n    <div class="clearfix">\n      <div ng-if="::messageControl.isUserCardShown()" class="element-card discussion-item nocontent">\n        <div class="element-details message-avatar-container"></div>\n        <div class="user-info {{::\'message_user\'+message.user.id}}">\n          <div class="username-wrapper">\n            <span class="user-role-label" bb-translate course-org-token-resolver>course.engagement.conversationView.instructorLabel</span>\n            <h3 ng-class="{ inactive: !messageControl.isAvailable() }">\n              <bb-username user="message.user" show-pronouns="true" show-pronunciation="true"></bb-username>\n            </h3>\n            <span ng-if="messageControl.isMessageDrafted()" class="is-draft-label" bb-translate>components.directives.discussion.message.draftLabel</span>\n          </div>\n          <bb-duration date="message.postDate" auto-update="true" has-ago="true"></bb-duration>\n          <i ng-if="messageControl.scope.showDueDate" class="overdue-tip" bb-translate>components.directives.discussion.message.overdue</i>\n          <span ng-if="::messageControl.shouldShowUnreadInfo() && !message.states.readStateInd" class="is-new-label" bb-translate>components.directives.discussion.message.newLabel</span>\n        </div>\n      </div>\n    </div>\n    <div ng-if="::messageControl.isAvatarShown()">\n      <bb-avatar user="::loginUser"></bb-avatar>\n    </div>\n\n    <form name="editorForm">\n      <bb-rich-text-editor\n        ng-if="message.id"\n        name="responseEditor"\n        ng-model="messageControl.messageBody.rawText"\n        editor-placeholder-key="{{placeholderKey}}"\n        is-toolbar-hidden="!isEditorActive"\n        is-disabled="messageMode === \'new\' && isDiscussionEdit && !messageControl.isEditing"\n        is-read-only="messageMode !== \'new\' && !isEditorActive"\n        ng-click="messageControl.onEditorClick()"\n        ng-change="messageControl.onMessageChange()"\n        on-blur="messageControl.onEditorBlur()"\n        on-focus="messageControl.setEditorActive()"\n        content-market-is-read-only="messageControl.hideContentMarketInEditor()"\n        show-word-count="showWordCount"\n        plugin-options="{attachment: true, contentMarket: true, math: true}"\n        analytics-id="components.directives.discussion.message.onEditorClick">\n      </bb-rich-text-editor>\n    </form>\n    <div class="error-message" role="alert" ng-if="messageControl.inputTooLong">\n      <bb-svg-icon icon="attention" size="small" status="alert"></bb-svg-icon>\n      <span bb-translate>components.directives.message.tooLargeMessage</span>\n    </div>\n    <div\n      class="panel-editor-controls"\n      ng-show="isEditorActive"\n    >\n      <button class="button button--text draft-button"\n          ng-click="messageControl.onSave(true)"\n          ng-blur="messageControl.onEditorBlur()"\n          ng-if="messageControl.isMessageDrafted()"\n          ng-disabled="messageControl.disableSaveDraftButton"\n          bb-translate\n          analytics-id="components.directives.discussion.saveDraftLabel">\n          components.directives.discussion.saveDraftLabel\n      </button>\n      <button class="button button--secondary js-secondary-button js-text-editor-cancel"\n          ng-click="messageControl.onCancel()"\n          ng-blur="messageControl.onEditorBlur()"\n          bb-translate\n          analytics-id="components.directives.discussion.cancelLabel">\n        components.directives.discussion.cancelLabel\n      </button>\n      <button class="button js-primary-button js-text-editor-save"\n          ng-click="messageControl.onSave()"\n          ng-blur="messageControl.onEditorBlur()"\n          ng-disabled="messageControl.disableSaveButton"\n          bb-translate\n          analytics-id="{{ messageControl.saveButtonLabelKey }}">\n        {{ messageControl.saveButtonLabelKey }}\n      </button>\n    </div>\n\n    <div ng-show="messageControl.shouldShowOverflowMenu()" class="content-item-controls overflow-menu-container" bb-foundation-defer>\n      <bb-overflow-menu ng-if="messageControl.overflowMenus"\n                        ng-hide="messageControl.isReadOnly()"\n                        element-id="{{\'comment-field\' + message.id}}"\n                        menu-items="messageControl.overflowMenus"\n                        element-name="{{messageControl.getMoreOptionsLabel(message.user.givenName, message.user.familyName, message.postDate)}}"\n                        analytics-id-tag-prefix="{{analyticsIdTagPrefix}}.message">\n      </bb-overflow-menu>\n    </div>\n\n    <div ng-if="messageControl.isContentFixed()" class="content">\n      <div class="controls">\n        <button class="button icon medium super-clear text-editor-delete" ng-if="messageControl.showDeleteButton()"\n                type="button"\n                ng-click="messageControl.onDelete()"\n                bb-confirmation-needed="{{ deleteConfirmHandler }}"\n                choices="{{ messageControl.getChoices() }}"\n                show-type="{{modalShowType}}"\n                aria-label="{{messageControl.getDeleteLabel()}}"\n                analytics-id="components.directives.discussion.message.delete.button">\n          <bb-svg-icon icon="trash" size="medium"></bb-svg-icon>\n        </button>\n      </div>\n    </div>\n    <div class="edited-by" ng-if="!messageControl.isMessageDrafted() && (message.lastUpdateUser && message.editDate && messageMode !== \'new\')"\n         ng-switch="message.lifecycle.toString() !== \'DELETED\'">\n      <div ng-switch-when="true" class="edit-info" bb-translate translate-values="{user: messageControl.lastUpdateUsername, editDate: message.editDate}">\n        components.directives.discussion.message.lastUpdateInfo\n      </div>\n      <div ng-switch-when="false" class="edit-info" bb-translate translate-values="{user: messageControl.lastUpdateUsername, editDate: message.editDate}">\n        components.directives.discussion.message.lastDeleteInfo\n      </div>\n    </div>\n  </div>\n</div>\n'},tka7:function(e,s,t){"use strict";t.d(s,"a",(function(){return o}));var i=t("nbDY"),n=t.n(i);class o extends n.a{}o.Assign=new o("assign"),o.Unassign=new o("unassign"),o.Delete=new o("delete"),o.Retain=new o("retain")},tmbA:function(e,s){e.exports='<bb-modal class="notification automatic-zero-setting-confirmation"\n          modal-translate-options="modalTranslateOptions"\n          modal-aria-type="alertdialog"\n          analytics-id-tag-prefix="components.directives.pastDueZeroSettings">\n  <div name="modal-contents">\n    \x3c!-- Instructions --\x3e\n    <p bb-translate>{{ modalTranslateOptions.instructions.key }}</p>\n    \x3c!-- Past due zero: Unassign zero --\x3e\n    <div ng-if="!pastDueZero.isPastZeroAssigned">\n      <fieldset ng-if="modalTranslateOptions.choices && modalTranslateOptions.choices.length > 0"\n                class="fieldset-options">\n        <legend class="sr-only" bb-translate="{{ modalTranslateOptions.title.key }}"></legend>\n        <div class="option-item" ng-repeat="option in modalTranslateOptions.choices">\n          <input type="radio" \n                 name="{{ ::option.name }}" \n                 id="{{ ::option.id }}"\n                 ng-model="modalTranslateOptions.choiceModal"\n                 ng-value="option.value"\n                 analytics-id="components.directives.grade.pastDueZero.option.input.radio">\n          <label for="{{ ::option.id }}" bb-translate>{{ ::option.localizedKey }}</label>\n          <p ng-if="!!option.descriptionKey"\n             class="past-due-unassign-description"\n             bb-translate>\n            {{ ::option.descriptionKey }}\n          </p>\n        </div>\n      </fieldset>\n    </div>\n  </div>\n  <button name="modal-footer-button-primary" \n          type="button" \n          class="button confirm-ok js-primary-button" \n          ng-click="okAction()" \n          analytics-id="{{modalTranslateOptions.confirm.key}}"\n          bb-translate>\n    {{modalTranslateOptions.confirm.key}}\n  </button>\n  <button name="modal-footer-button-secondary" \n          type="button" \n          class="button button--secondary confirm-cancel js-secondary-button" \n          ng-click="cancelAction()" \n          analytics-id="{{modalTranslateOptions.cancel.key}}"\n          bb-translate>\n    {{modalTranslateOptions.cancel.key}}\n  </button>\n</bb-modal>'},uypo:function(e,s,t){"use strict";t.r(s),t.d(s,"moduleName",(function(){return p})),t.d(s,"controllerName",(function(){return m}));t("P2BA"),t("1NX5"),t("GkCm"),t("d3l/"),t("8sWK"),t("lGua");var i=t("nYZ0"),n=t("Fvsw"),o=t("Cxi4"),a=t("8MQy"),r=t("OvxF"),c=t("HdfQ"),l=t("IjED"),d=t("g7Mf"),u=t("ftvW"),h=t("cnCq");t.d(s,"template",(function(){return h}));const p="ultra.course.engagement.view",m=a.b;angular.module(p,["angular-inview",i.d,n.a,o.a,r.a,c.a,l.a,d.b,u.a]).controller(a.b,a.a)},"w/V/":function(e,s,t){"use strict";t("HApu"),t("dV61");var i=t("Llzl"),n=t("Sa5G"),o=t("jhBu"),a=t("8W6D"),r=t("X6r5"),c=t("lEL+"),l=t("TnpK"),d=t("MYrX"),u=t("zGdY");t.d(s,"d",(function(){return h})),t.d(s,"a",(function(){return p})),t.d(s,"c",(function(){return m})),t.d(s,"b",(function(){return b}));const h="ultra.components.directives.rubric.rubricSettings",p="associated-rubric-updated",m="bb-rubric-settings-save",b="bb-rubric-settings-gradecolumn-refresh";class g{constructor(e,s,t,i,n,o){this.scope=e,this.element=s,this.attrs=t,this.ultraState=i,this.timeout=n,this.entitlement=o,this.contextArea="rubrics",this.hasRubricPermissions=!0,this.setAssociatedRubric=(e,s)=>{this.rubric=null!=e?e:null,this.saveRubricAssociations(s),this.broadcastRubricChanges(),this.scope.$emit("rubric-settings-rubric-updated",this.originalRubric&&this.rubric&&this.originalRubric.id===this.rubric.id)},e.rubricSettings=this,this.setGradeColumn(e.gradeColumnId()),e.$watch(e.gradeColumnId,e=>{null===this.gradeColumn&&this.gradeColumn.id===e||this.setGradeColumn(e)}),e.$on(m,(e,s)=>{s&&(this.gradeColumn=s),this.saveRubricAssociations()}),e.$on("associate-rubric",(e,s,t)=>{this.setAssociatedRubric(s,t),this.timeout(()=>{this.element.find(".rubric-title a").focus()},this.scope)}),e.$on("rubric-save",(e,s)=>{this.rubric&&this.rubric.id===s.id&&(this.rubric=s)}),e.$on("$stateChangeStart",(e,s,t,n,o)=>{n.name.indexOf("rubric.mode")>1&&a.a.CREATE.isEqualTo(a.a.parse(i.params.mode))&&(s.name.indexOf("assignment.peek.rubric-list")>1||s.name.indexOf("assignment-create.peek.rubric-list")>1)&&null!=this.rubric&&(e.preventDefault(),i.leavePeekState(s.name))})}saveRubricAssociations(e){if(this.gradeColumn){if(this.originalRubric&&this.rubric&&this.originalRubric.id===this.rubric.id)this.scope.$root.$broadcast(b,this.gradeColumn,this.rubric);else{this.rubric?(this.gradeColumn.setRubricAssociation(this.rubric.id),this.rubric.associated=!0,Number.isFinite(e)&&!this.ultraState.includes("**.discussion.**")&&this.gradeColumn.setMaxPossiblePoints(e)):this.gradeColumn.setRubricAssociation(null);const s={expand:"associatedRubrics"};this.originalRubric&&this.originalRubric.readOnly&&(s.cascade=this.originalRubric.readOnly),this.gradeColumn.withParams(s).$patch().$then(e=>{this.gradeColumn.rubricAssociations=e.rubricAssociations,this.scope.$root.$broadcast(b,this.gradeColumn,this.rubric)})}this.originalRubric=this.rubric}}broadcastRubricChanges(){this.shouldBroadcastRubricChanges()&&this.scope.$root.$broadcast(p,this.gradeColumn,this.rubric)}toggleRubricList(){this.scope.$root.$broadcast("open-rubric-list-panel")}removeActiveRubric(e){e&&e.stopPropagation(),this.rubric=null,this.saveRubricAssociations(),this.scope.$emit("rubric-settings-rubric-updated",this.originalRubric&&this.rubric&&this.originalRubric.id===this.rubric.id),this.broadcastRubricChanges()}setGradeColumn(e){e&&(this.gradeColumn?this.gradeColumn.$then(this.doSetGradeColumn.bind(this)):this.doSetGradeColumn())}doSetGradeColumn(){this.scope.course.gradebook.columns.$find(this.scope.gradeColumnId(),{expand:"associatedRubrics",_:(new Date).getTime()}).$then(e=>{this.gradeColumn=e,this.gradeColumn&&this.gradeColumn.hasRubricAssociation()?this.scope.course.rubrics.$find(this.gradeColumn.getAssociatedRubricId()).$allow(["403"]).$asPromise().then(e=>{403!==e.$response.status?(this.originalRubric=e,this.rubric=e,this.hasRubricPermissions=!0):this.hasRubricPermissions=!1}):(this.originalRubric=null,this.rubric=null),this.entitlement.hasCourseEntitlement(n.n.ModifyGradebook,this.gradeColumn.courseId).then(e=>{e&&this.hasEvaluations()})})}hasEvaluations(){this.gradeColumn.hasEvaluations().then(e=>{this.hasRubricEvals=e})}shouldBroadcastRubricChanges(){return this.scope.broadcastRubricChanges&&this.scope.broadcastRubricChanges()}columnIsAssignmentCategory(){var e,s;return(null===(s=null===(e=this.gradeColumn)||void 0===e?void 0:e.gradebookCategory)||void 0===s?void 0:s.title)===u.KnownGradebookCategoryTitle.Assignment}getPeerGradingInfo(){return this.scope.peerGradingEnabled?"peerGrading":null}}g.$inject=["scope","element","attrs",l.d,c.b,o.b];class v{constructor(e,s){this.$compile=e,this.$injector=s,this.restrict="E",this.template=d,this.scope={course:"=",gradeColumnId:"&",contentHasQuestions:"&?",peerGradingEnabled:"<",broadcastRubricChanges:"&?",isDisabled:"&?"},this.link=(e,s,t)=>{e.rubricSettings=this.$injector.instantiate(g,{scope:e,element:s,attrs:t})}}}v.$inject=["$compile","$injector"],i.module(h,[r.a,l.b]).directive("bbRubricSettings",["$injector",e=>e.instantiate(v)])},x8kk:function(e,s,t){"use strict";(function(e){t.d(s,"f",(function(){return O})),t.d(s,"e",(function(){return I})),t.d(s,"a",(function(){return M})),t.d(s,"b",(function(){return L})),t.d(s,"c",(function(){return x})),t.d(s,"d",(function(){return A}));var i=t("D57K"),n=(t("k6nO"),t("nsO7")),o=t("Llzl"),a=t("oVrE"),r=t("nbDY"),c=t.n(r),l=t("jbaE"),d=t("Fvsw"),u=t("Sgjf"),h=t("lmMM"),p=t("r133"),m=t("0JpG"),b=t("pjml"),g=t("JNtI"),v=t("lEL+"),S=t("gCXj"),f=t("jmkQ"),C=t("OsJo"),w=t("ZzYr"),D=t("kBJj"),y=t("TnpK"),k=t("Qbdf"),$=t("tZxt"),P=t("pSe1"),T=t("ZzR9"),E=t("aHpC");const O="ultra.directives.discussion.message",I="update-discussion-message",M="add-discussion-message",L="delete-discussion-message",x="update-grade-status",A="update-indicator-status";class R extends c.a{}R.NewMode=new R("new"),R.ViewMode=new R("view");let G=class{constructor(e,s,t,i,o,a,r,c,l,d,u){var p;this.scope=e,this.$q=t,this.element=i,this.bbContext=o,this.bbLocalize=a,this.timeout=r,this.UserModel=c,this.$sce=u,this.isEditing=!1,this.requestIsLoading=!1,this.inputTooLong=!1,this.groupIdParam={},this.readOnlyState=!0,this.keepEditorActive=!1,this.hideContentMarketInEditor=()=>!1,this.getMoreOptionsLabel=n.memoize((e,s,t)=>this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.discussion.moreOptionsLabel",params:{postDate:t,user:{givenName:e,familyName:s}},noWrap:!0,noEscape:!0}),(e,s,t)=>String(e)+String(s)+String(t)),this.scope.courseId=null!==(p=d.courseId)&&void 0!==p?p:l.params.courseId,this.originalText="",e.inputText&&(this.originalText=e.inputText,this.inputTextSafe=u.trustAsHtml(e.inputText.replace(/(.|\s*)(<a )(.|\s*)/g,'$1<a target="_blank" rel="noopener noreferrer" $3'))),R.NewMode.isEqualTo(this.scope.messageMode)?this.messageBody={rawText:"",displayText:""}:this.messageBody=this.scope.message&&this.scope.message.body||{rawText:"",displayText:""},this.choices=[],!this.scope.message.lastUpdateUser&&this.isAnonymousContentEdited()&&(this.scope.message.lastUpdateUser=this.scope.message.user),this.updateLocalizedLastUpdateUserName(),this.overflowMenus=this.getOverflowMenus(),e.$watch("isDeleteAllDisabled",()=>{e.showDeleteAll&&(this.choices.splice(0),this.choices.push({key:"delete-all-replies",value:e.isDeleteAllDisabled,localizedKey:h.c(e.deleteConfirmHandler.replace(/^resource\//,""),"delete-all-replies"),isDisable:e.isDeleteAllDisabled}))}),e.$watch("message.lastUpdateUser",()=>{this.updateLocalizedLastUpdateUserName()}),e.$on(T.b.$stateChangeStart,(e,s)=>{this.keepEditorActive&&(this.keepEditorActive=!1),s.name.includes("peek.content-market")&&(this.keepEditorActive=!0)}),e.$watch("message.body.rawText",e=>{e&&(R.ViewMode.isEqualTo(this.scope.messageMode)&&(this.messageBody={rawText:e,displayText:""}),this.inputTextSafe=this.$sce.trustAsHtml(this.scope.message.body.rawText.replace(/(.|\s*)(<a )(.|\s*)/g,'$1<a target="_blank" rel="noopener noreferrer" $3')))}),e.$on("SET_MESSAGE_ACTIVE",(e,s)=>{this.scope.message.id===s&&this.edit()})}isUserCardShown(){return R.ViewMode.isEqualTo(this.scope.messageMode)}canSendMessageInUserCard(){return!a.g(this.scope.message.user)&&this.isCourseActive()&&this.isAvailable()}isAvatarShown(){return R.NewMode.isEqualTo(this.scope.messageMode)&&this.scope.showAvatarOnNew&&this.scope.showAvatarOnNew()}isEditingAreaShown(){return this.isEditing}isDeleteButtonShown(){return this.scope.message&&this.scope.message.permissions&&!b.v.MessageLifeCycleEnum.Deleted.isEqualTo(this.scope.message.lifecycle)&&(this.scope.message.permissions.delete||this.scope.message.permissions.edit)&&!this.isEditing&&!this.scope.isDiscussionEdit}isEditButtonShown(){return!(this.scope.isEditDisabled&&this.scope.isEditDisabled())&&this.scope.message&&this.scope.message.permissions&&!b.v.MessageLifeCycleEnum.Deleted.isEqualTo(this.scope.message.lifecycle)&&this.scope.message.permissions.edit&&(!this.scope.isDiscussionEdit||this.isEditing)}isMessageDrafted(){return!(!this.scope.enableDraft||"new"!==this.scope.messageMode)||this.scope.enableDraft&&this.scope.message&&this.scope.message.id&&!this.scope.message.permissions.reply&&b.v.MessageLifeCycleEnum.Drafted.isEqualTo(this.scope.message.lifecycle)}onMessageChange(){this.scope.enforceLengthLimit&&(this.inputTooLong=Object(D.isMessageTooLong)(this.messageBody.rawText))}get saveButtonLabelKey(){return this.isMessageDrafted()&&this.scope.saveButtonDraftLabelKey?this.scope.saveButtonDraftLabelKey:this.scope.saveButtonLabelKey}get disableSaveButton(){var e;return!(this.isMessageDrafted()&&!R.NewMode.isEqualTo(this.scope.messageMode)&&!this.inputTooLong)&&(R.NewMode.isEqualTo(this.scope.messageMode)&&(null===(e=this.scope.editorForm.responseEditor)||void 0===e?void 0:e.$pristine)||this.inputTooLong)}get disableSaveDraftButton(){var e;return(null===(e=this.scope.editorForm.responseEditor)||void 0===e?void 0:e.$pristine)||this.inputTooLong}isView(){return R.ViewMode.isEqualTo(this.scope.messageMode)}showEditButton(){return!this.scope.hideButtons&&(this.isView()&&this.isEditButtonShown())}showDeleteButton(){return!this.requestIsLoading&&(!this.scope.hideButtons&&(this.isView()&&this.isDeleteButtonShown()))}setEditorActive(){this.scope.isDiscussionEdit||this.scope.isEditorActive||(this.scope.$emit("isCurrentDiscussionEditingChanged",!0),this.isEditing=!0,this.scope.isEditorActive=!0,this.scope.editorForm.responseEditor.$setPristine())}onEditorBlur(){const e=this.element.find("button:focus").length>0;!this.disableSaveButton||e||this.inputTooLong||this.keepEditorActive||this.setEditorInactive()}setEditorInactive(){this.scope.$emit("isCurrentDiscussionEditingChanged",!1),this.isEditing=!1,this.scope.isEditorActive=!1}onCancel(){this.resetEditingFlag(),this.inputTooLong=!1,this.messageBody={rawText:this.originalText,displayText:this.originalText},this.scope.onCancelFunc&&this.scope.onCancelFunc(),this.scope.inputText=this.originalText}resetEditingFlag(){this.setEditorInactive(),this.disableEditState()}onSave(e){this.resetEditingFlag(),this.scope.onSaveFunc&&this.scope.onSaveFunc({value:this.messageBody.rawText}),R.NewMode.isEqualTo(this.scope.messageMode)?(this.onSaveNew(e),this.timeout(()=>{this.messageBody={rawText:"",displayText:""},this.scope.inputText=""},this.scope,0)):this.onSaveEdit(e),this.scope.editorForm.responseEditor.$setPristine()}onSaveNew(e){const s=this.scope.message.replies.$build();return s.parentId=this.scope.message.id,s.courseId=this.scope.message.courseId,s.forumId=this.scope.message.forumId,s.userId=this.scope.loginUser.id,s.lifecycle=e?b.v.MessageLifeCycleEnum.Drafted:b.v.MessageLifeCycleEnum.Published,s.postedName=this.scope.loginUser.givenName+" "+this.scope.loginUser.familyName,s.subject=null,s.body=this.messageBody,s.isDeleted=!1,s.postDate=this.bbContext.getServerTime(),s.editDate=this.bbContext.getServerTime(),this.scope.message.ui.showAllReplies=!0,this.groupIdParam=this.scope.getGroupId&&this.scope.getGroupId()?{groupId:this.scope.getGroupId()}:{},this.scope.message.saveReply(s,this.groupIdParam).$then(s=>{let t;if(s.states.readStateInd=!0,this.scope.message.ui.replies||(this.scope.message.ui.replies=[]),s.user=this.scope.loginUser,s.parent=this.scope.message,s.ui.replies=s.replies,b.v.MessageType.ClassConversation.isEqualTo(this.scope.message.type)?s.type=b.v.MessageType.Comment:s.type=this.scope.message.type.next(),this.scope.isRepliesOrderByDesc){const s=n.findIndex(this.scope.message.ui.replies,e=>!b.v.MessageLifeCycleEnum.Drafted.isEqualTo(e.lifecycle));t=e?0:s>-1?s:this.scope.message.ui.replies.length}else{let s=n.findLastIndex(this.scope.message.ui.replies,e=>!b.v.MessageLifeCycleEnum.Drafted.isEqualTo(e.lifecycle));t=e?this.scope.message.ui.replies.length:s>-1?s+=1:0}this.scope.message.ui.replies.splice(t,0,s),this.scope.message.ui.count++,this.scope.message.messageStatus.numberOfChildren++,this.scope.message.messageStatus.numberOfReadChildren++,this.scope.message.parent&&(this.scope.message.parent.messageStatus.numberOfChildren++,this.scope.message.parent.messageStatus.numberOfReadChildren++),this.scope.$emit(M,b.v.MessageType.Discussion.isEqualTo(this.scope.message.type),s.id,e),this.scope.$root.$broadcast(x)})}onSaveEdit(e){this.groupIdParam=this.scope.getGroupId&&this.scope.getGroupId()?{groupId:this.scope.getGroupId()}:{},this.scope.message.body=this.messageBody;const s=!e&&b.v.MessageLifeCycleEnum.Drafted.isEqualTo(this.scope.message.lifecycle);b.v.MessageLifeCycleEnum.Published.isEqualTo(this.scope.message.lifecycle)&&!e||(this.scope.message.lifecycle=e?b.v.MessageLifeCycleEnum.Drafted:b.v.MessageLifeCycleEnum.Published),this.scope.message.withParams(this.groupIdParam).$patch().$then(()=>{this.scope.inputText=this.scope.message.body.rawText,this.messageBody=this.scope.message.body,this.originalText=this.scope.inputText,this.scope.message.editDate=this.bbContext.getServerTime(),this.scope.message.postAsAnonymous?this.scope.message.lastUpdateUser=this.getAnonymousUpdateUser():this.scope.message.lastUpdateUser=s?null:this.scope.loginUser,this.scope.$emit(I,b.v.MessageType.Comment.isEqualTo(this.scope.message.type),this.scope.message.id,this.scope.message,!1,s)}),this.isEditing=!1}isCascadeDelete(){return this.scope.shouldDeleteAll||this.scope.isDeleteAllDisabled}onDelete(){if(this.requestIsLoading=!0,this.scope.onDeleteFunc)return this.scope.onDeleteFunc();this.groupIdParam=this.scope.getGroupId&&this.scope.getGroupId()?{groupId:this.scope.getGroupId()}:{};const e=b.v.MessageType.Comment.isEqualTo(this.scope.message.type);if(this.isCascadeDelete())return this.scope.message.withParams({cascade:!0,...this.groupIdParam}).$destroy().$asPromise().then(()=>{this.scope.message.parent&&(n.remove(this.scope.message.parent.ui.replies,{id:this.scope.message.id}),this.scope.message.parent.parent&&(this.scope.message.parent.parent.messageStatus.numberOfChildren-=1),this.scope.message.parent.messageStatus.numberOfChildren-=this.scope.message.messageStatus.numberOfChildren+1),this.scope.$root.$broadcast(L,e,this.scope.message.id,this.scope.message),this.scope.$root.$broadcast(x)});const s=this.scope.message.parent?n.findIndex(this.scope.message.parent.ui.replies,{id:this.scope.message.id}):void 0;return this.scope.message.withParams({cascade:!1,...this.groupIdParam}).$destroy().$asPromise().then(()=>{this.scope.message.lifecycle=b.v.MessageLifeCycleEnum.Deleted,this.scope.message.editDate=new Date,this.scope.message.permissions.edit=!1,this.scope.message.lastUpdateUser=this.getAnonymousUpdateUser(),this.updateLocalizedLastUpdateUserName(),this.scope.message.parent&&-1===n.findIndex(this.scope.message.parent.ui.replies,["id",this.scope.message.id])&&this.scope.message.parent.ui.replies.splice(s,0,this.scope.message),this.scope.$emit(I,e,this.scope.message.id,this.scope.message,!0),this.scope.$root.$broadcast(x)})}getAnonymousUpdateUser(){return this.scope.message.lastUpdateUserId===this.scope.loginUser.id?this.scope.loginUser:this.scope.message.user}getDeleteLabel(){const e=this.element.find(".js-bbml-block").find(" .element-list-row").text().trim();return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.discussion.message.delete",params:{msg:e},noWrap:!0,noEscape:!0})}generateStringByMessage(){if(this.scope.message)return this.scope.message.id+"-commit-edit"}generateFocusStringByMessage(){if(this.scope.message)return b.v.MessageType.Reply.isEqualTo(this.scope.message.type)?this.scope.message.parent.id+"-commit-edit":this.scope.message.id+"-commit-edit"}isCourseActive(){return!(this.scope.isCourseComplete||this.scope.isCoursePrivate)}getLastUpdateUserName(){if(this.scope.message&&this.scope.message.lastUpdateUser)return this.scope.message.lastUpdateUser.userName}getLastUpdateDate(){if(this.scope.message)return this.scope.message.editDate}isReadOnly(){return this.scope.isEditDisabled&&this.scope.isEditDisabled()||this.scope.hideButtons||!((R.NewMode.isEqualTo(this.scope.messageMode)||R.ViewMode.isEqualTo(this.scope.messageMode)&&this.scope.message&&this.scope.message.permissions&&this.scope.message.permissions.edit)&&(!this.scope.isDiscussionEdit||this.isEditing))}updateLocalizedLastUpdateUserName(){this.scope.message&&this.scope.message.lastUpdateUser&&this.bbLocalize.formatUsername(this.scope.message.lastUpdateUser,m.ILocaleUsernameFormat.Short,this.scope,{noWrap:!0,noEscape:!0}).then(e=>{this.lastUpdateUsername=e})}isAnonymousContentEdited(){return this.scope.message.postAsAnonymous&&null==this.scope.message.lastUpdateUserId&&this.scope.message.postDate&&this.scope.message.editDate&&this.scope.message.postDate.getTime()!==this.scope.message.editDate.getTime()}isContentFixed(){return!!this.requestIsLoading||(!(!this.scope.isEditDisabled||!this.scope.isEditDisabled())||(this.scope.message&&this.scope.message.permissions?R.ViewMode.isEqualTo(this.scope.messageMode)?!1===this.scope.message.permissions.edit:R.NewMode.isEqualTo(this.scope.messageMode)?!1===this.scope.message.permissions.reply:void 0:void 0))}isAvailable(){return!this.scope.isCourseAvailable||this.scope.isCourseAvailable()}shouldShowUnreadInfo(){return!(!this.scope.showUnread||!this.scope.showUnread())}updateMessageStatus(e,s){if(this.shouldShowUnreadInfo()&&e&&s&&!s.states.readStateInd){s.states.readStateInd=!0,this.groupIdParam=this.scope.getGroupId&&this.scope.getGroupId()?{groupId:this.scope.getGroupId()}:{},s.updateMessageStatus(s.states,this.groupIdParam),this.scope.$emit(A);const e=s=>{s&&s.parent!==s&&(s.parent.messageStatus.numberOfReadChildren++,e(s.parent))};e(s)}}getOverflowMenus(){const e=[];e.push({labelKey:"global.edit",icon:"draw",show:()=>this.showEditButton(),onClick:this.edit.bind(this)});const s={labelKey:"global.delete",icon:"trash",show:()=>this.showDeleteButton(),onClick:this.onDelete.bind(this)};return this.scope.deleteConfirmHandler&&(s.confirmationOptions={},s.confirmationOptions.lazyLoadTitleKeyAndInstructionsKey=()=>(this.isMessageDrafted()&&(this.scope.deleteConfirmHandler="resource/x-bb-draft"),this.$q.when(g.a(this.scope.deleteConfirmHandler.replace(/^resource\//,"")))),s.confirmationOptions.choices=this.choices),e.push(s),e}shouldShowOverflowMenu(){return this.showEditButton()||this.showDeleteButton()}clickMessageText(s){if(this.isContentFixed()||!this.readOnlyState||R.NewMode.isEqualTo(this.scope.messageMode))return;const t=e(s.target);t.is("button")||t.parent().is("button")||t.is("a")||t.parent().is("a")||this.edit()}onEditorClick(){R.NewMode.isEqualTo(this.scope.messageMode)&&!this.scope.isEditorActive&&this.edit()}edit(){this.isReadOnly()||(this.readOnlyState=!1,this.setEditorActive(),this._focusTextEditor())}isLoginUserOwnedMessage(){return this.scope.message.user&&this.scope.message.user.id===this.scope.loginUser.id}_focusTextEditor(){this.timeout(()=>{this.element.find(".editor-element").first().focus(),this.element.find(".bb-editor").first().focus()},this.scope,0,!0)}disableEditState(){this.readOnlyState=!0}};G=Object(i.__decorate)([Object(i.__param)(0,Object(E.b)("scope")),Object(i.__param)(1,Object(E.b)("attrs")),Object(i.__param)(2,Object(E.b)("$q")),Object(i.__param)(3,Object(E.b)("element")),Object(i.__param)(4,Object(E.b)(d.b)),Object(i.__param)(5,Object(E.b)(m.serviceName)),Object(i.__param)(6,Object(E.b)(v.b)),Object(i.__param)(7,Object(E.b)(b.Jb.serviceName)),Object(i.__param)(8,Object(E.b)(y.d)),Object(i.__param)(9,Object(E.b)(k.e)),Object(i.__param)(10,Object(E.b)("$sce"))],G);class j{constructor(e,s){this.$compile=e,this.$injector=s,this.restrict="E",this.template=$,this.scope={placeholderKey:"@",cancelButtonLabelKey:"@?",saveButtonLabelKey:"@?",saveButtonDraftLabelKey:"@?",isLoginUserStudent:"=?",deleteConfirmHandler:"@?",cancelConfirmHandler:"@?",modalShowType:"@?",inputText:"=",loginUser:"=?",messageMode:"@",message:"=",showDeleteAll:"=?",shouldDeleteAll:"=?",isDeleteAllDisabled:"=?",enforceLengthLimit:"<?",focusOn:"@?",focusId:"@?",courseId:"@?",isRepliesOrderByDesc:"@?",isDiscussionEdit:"=?",isCourseComplete:"=?",isCoursePrivate:"=?",isEditDisabled:"&?disableEdit",isConversation:"=?",onDeleteFunc:"&?",onCancelFunc:"&?",onSaveFunc:"&?",plainText:"=?",showAvatarOnNew:"&?",showDueDate:"=?",showUnread:"&?",courseRole:"=?",hideButtons:"=?",getGroupId:"&?groupId",isCourseAvailable:"&?courseAvailable",hideContentMarketButton:"=?",allowEmptyBlock:"=?",enableDraft:"=?",showWordCount:"=?",analyticsIdTagPrefix:"@?"},this.link=(e,s,t)=>{e.messageControl=this.$injector.instantiate(G,{scope:e,element:s,attrs:t}),e.$on("delete-all-replies",(s,t)=>{e.shouldDeleteAll=t}),e.$on("focus",(s,t,i)=>{t.startsWith("comment-reply")&&i===(e.getGroupId&&e.getGroupId())&&R.NewMode.isEqualTo(e.messageMode)&&e.messageControl.edit()});const[i]=["message_avatar"];e.inCallback=()=>{C.a.insertElement(e,i,this.messageAvatarLinkFn,s.find(".message-avatar-container"))},e.outCallback=()=>{C.a.removeElement(e,i)}},this.messageAvatarLinkFn=this.$compile(P)}}j.$inject=["$compile","$injector"],o.module(O,["angular-inview",d.a,u.a,p.a,m.moduleName,b.N,g.b,v.a,l.a,S.a,f.a,w.a,y.b,k.b]).config([S.b+"Provider",function(e){e.onStyleRefresh((function(e,s){e.selector(`bb-message .message_user${s.userId} .overdue-tip`).rule("display",s.isDueDateExcepted()?"none":"inline")}))}]).directive("bbMessage",["$injector",e=>e.instantiate(j)])}).call(this,t("5iHu"))},yMoE:function(e,s,t){"use strict";t.d(s,"a",(function(){return a}));var i=t("oi1r"),n=t("o5Lu"),o=t("zGdY");class a{constructor(e,s,t,i,n){this.grade=e,this.$q=s,this.gradeDetail=t,this.scope=i,this.schemaService=n,this.wasValueErased=!1}init(e,s){this.column=e;const t=e=>{this.schema=e,this.scaleType=null==e?void 0:e.scaleType};return s?this.$q.when(t(s)):this.schemaService.loadGradeSchema(e).then(e=>{t(e)})}shouldShowTotalPoints(){var e;return null!=this._displayValue&&((null===(e=this.schema)||void 0===e?void 0:e.scaleType)===o.SchemaScaleType.Score&&!this.isDisplayValueTooLargeForTotalPoints())}isDisplayValueTooLargeForTotalPoints(){return this._displayValue&&this._displayValue.toString().length>n.g.DEFAULT_GRADEBOOK_SETTINGS_BEFORE_DECIMAL}set displayGrade(e){var s,t;if(e){if(this.displayValue=this.grade.getGradeToDisplay(e,this.scope,null===(s=this.schema)||void 0===s?void 0:s.scaleType),this._nonFormattedScore=e.score,this._perfCode=e.perfCode,this._perfCode)return this.perfCodeDesc=this._perfCode.description,void(this._parsedValue=this.grade.getGradeToDisplay({perfCode:this._perfCode},this.scope,o.SchemaScaleType.Score));switch(this.perfCodeDesc="",null===(t=this.schema)||void 0===t?void 0:t.scaleType){case o.SchemaScaleType.Tabular:{let e=null;if(this.column.externalGrade&&this.gradeDetail&&this.gradeDetail.isOverrideGrade()){const s=this.gradeDetail.pointsPossible||this.column.possible||100;e={score:this._nonFormattedScore&&this._nonFormattedScore*s/100}}else e={score:this._nonFormattedScore};this._parsedValue=this.grade.getGradeToDisplay(e,this.scope,o.SchemaScaleType.Score);break}case o.SchemaScaleType.Percent:{let e=null;if(this.column.externalGrade)e={score:this._nonFormattedScore};else{e={score:this._nonFormattedScore&&this._nonFormattedScore/100*this.column.possible}}this._parsedValue=this.grade.getGradeToDisplay(e,this.scope,o.SchemaScaleType.Score);break}case o.SchemaScaleType.Score:this._parsedValue=this.displayValue;break;case o.SchemaScaleType.Complete:this._parsedValue=this.grade.getGradeToDisplay({...e,grade:null},this.scope,this.schema.scaleType);break;case o.SchemaScaleType.Text:this._parsedValue=e.grade}}}get displayValue(){return this._displayValue}set displayValue(e){this.wasValueErased=this.grade.wasGradeCleared(this.displayValue,e),this._displayValue=e}get parsedValue(){return this._parsedValue}set parsedValue(e){this._parsedValue=e}hasPerfCode(){return!!this._perfCode}getGradeColor(){var e,s;return(null===(s=null===(e=this.gradeDetail)||void 0===e?void 0:e.displayGrade)||void 0===s?void 0:s.isOverride)&&this.column.externalGrade||this.scaleType===o.SchemaScaleType.Text?"gray":this.displayValue?this.scaleType!==o.SchemaScaleType.Percent?this.getGradeColorScoreSchema():this.grade.getPercentileColor(this._nonFormattedScore):void 0}getGradeColorScoreSchema(){const e=this.gradeDetail?this.gradeDetail.pointsPossible:this.column.possible;if(e>0){const s=this._nonFormattedScore/e*100;return this.grade.getPercentileColor(s)}return"na"}}a.$inject=[n.i,"$q","gradeDetail","scope",i.b]},zdqs:function(e,s,t){"use strict";t.d(s,"a",(function(){return r}));var i=t("nsO7"),n=t("VdDF"),o=t("pjml"),a=t("zGdY");class r{constructor(e){this.termUtil=e,this.membershipTermMapper=new c(this.termUtil)}getMembershipMapper(){return this.membershipTermMapper}map(e,s){return e.map(e=>({membership:e,term:this.membershipTermMapper.adjustTerm(e,s)}))}}class c{constructor(e){this.termUtil=e}adjustTerm(e,s){const t=this.getCourseDateRange(e);return t.start>s?e.course.ui.term=this.termUtil.upcomingTerm:n.a.isWithinDateRange(s,t)?e.course.ui.term=this.termUtil.currentTerm:e.course.term?e.course.ui.term=e.course.term:e.course.ui.term=this.getTermMappingBasedOnCourseDates(e,t,s),e.course.ui.term}getCourseDateRange(e){let s,t;if(a.CourseDuration.DateRange===e.course.durationType)s=e.course.startDate,t=e.course.endDate;else if(a.CourseDuration.FixedNumDays===e.course.durationType)s=e.enrollmentDate,(t=new Date(e.enrollmentDate.getTime())).setDate(t.getDate()+e.course.numDaysOfUse);else if(a.CourseDuration.UseTerm===e.course.durationType){const i=e.course.term?this.termUtil.getTerm(e.course.term.id):null;i&&(o.Gb.TermDuration.DateRange.isEqualTo(i.durationType)?(s=i.startDate,t=i.endDate):o.Gb.TermDuration.FixedNumDays.isEqualTo(i.durationType)&&(s=e.enrollmentDate,(t=new Date(e.enrollmentDate.getTime())).setDate(t.getDate()+i.daysOfUse)))}return{end:t,start:s}}getTermMappingBasedOnCourseDates(e,s,t){let n=s.start||e.course.term&&e.course.term.startDate;if(!n){if(!(s.end&&t>s.end))return this.termUtil.currentTerm;n=s.end}const o=this.termUtil.filterTerm(n);if(0===o.length)return this.termUtil.createYearTerm(n);if(1===o.length)return o[0];if(o.length>1){const e=i.sortBy(o,["startDate","id"]);return e[e.length-1]}}}}}]);